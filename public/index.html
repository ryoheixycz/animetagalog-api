<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Tagalog Admin Panel</title>
    
    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Phosphor Icons - Using the exact CDN provided -->
    <script src="https://cdn.jsdelivr.net/npm/phosphor-icons@1.4.2/src/index.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/phosphor-icons@1.4.2/src/css/icons.min.css" rel="stylesheet">
    
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#eef2ff',
                            100: '#e0e7ff',
                            200: '#c7d2fe',
                            300: '#a5b4fc',
                            400: '#818cf8',
                            500: '#6366f1',
                            600: '#4f46e5',
                            700: '#4338ca',
                            800: '#3730a3',
                            900: '#312e81',
                            950: '#1e1b4b',
                        },
                        secondary: {
                            50: '#f5f3ff',
                            100: '#ede9fe',
                            200: '#ddd6fe',
                            300: '#c4b5fd',
                            400: '#a78bfa',
                            500: '#8b5cf6',
                            600: '#7c3aed',
                            700: '#6d28d9',
                            800: '#5b21b6',
                            900: '#4c1d95',
                            950: '#2e1065',
                        },
                        dark: {
                            100: '#4b5563',
                            200: '#374151',
                            300: '#333333',
                            400: '#2a2a2a',
                            500: '#222222',
                            600: '#1c1c1c',
                            700: '#171717',
                            800: '#121212',
                            900: '#0a0a0a',
                        }
                    },
                    boxShadow: {
                        'smooth': '0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24)',
                        'smooth-md': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                        'smooth-lg': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
                        'dark': '0 1px 3px rgba(0, 0, 0, 0.5), 0 1px 2px rgba(0, 0, 0, 0.7)',
                        'dark-lg': '0 10px 25px -5px rgba(0, 0, 0, 0.3)',
                    },
                }
            }
        }
    </script>
    <style>
        /* Base styles */
        * {
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background-color: #0f0f0f;
            color: #e5e7eb;
        }
        
        /* Loading spinner & overlay */
        #loadingSpinner {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(3px);
        }
        
        /* Search dropdown styling */
        .search-results {
            position: absolute;
            width: 100%;
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            background-color: #1c1c1c;
            border: 1px solid #2a2a2a;
            border-radius: 0.5rem;
        }
        
        /* Animation keyframes */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out forwards;
        }
        
        @keyframes pulse {
            0% { opacity: 0.6; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.1); }
            100% { opacity: 0.6; transform: scale(0.8); }
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1c1c1c;
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
        
        /* Card hover effects */
        .hover-card {
            transition: all 0.25s ease-in-out;
        }
        
        .hover-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
        }
        
        /* Glass effect for status indicator */
        .glass-effect {
            background: rgba(18, 18, 18, 0.8);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Dark Mode Styles */
        .dark input, .dark select, .dark textarea {
            background-color: #1c1c1c;
            border-color: #333333;
            color: #e5e7eb;
        }
        
        .dark input::placeholder, .dark textarea::placeholder {
            color: #6b7280;
        }
        
        .dark input:focus, .dark select:focus, .dark textarea:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
        }
    </style>
</head>
<body class="antialiased dark bg-dark-800 text-gray-200">
    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="fixed inset-0 bg-black/85 backdrop-blur-sm z-50 flex items-center justify-center">
        <div class="flex flex-col items-center text-white">
            <div class="w-16 h-16 border-4 border-t-primary-500 border-white/20 rounded-full animate-spin mb-4"></div>
            <p class="text-lg font-medium">Loading...</p>
        </div>
    </div>

    <!-- Server Status Indicator -->
    <div id="serverStatus" class="fixed bottom-4 right-4 py-1.5 px-3 rounded-full text-sm font-medium z-40 flex items-center gap-2 shadow-dark bg-red-600 text-white transition-all glass-effect">
        <span class="w-2 h-2 rounded-full bg-current pulse-animation"></span>
        <span>Connecting...</span>
    </div>

    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside id="sidebar" class="fixed lg:relative inset-y-0 left-0 w-64 bg-gradient-to-br from-dark-600 to-black text-white shadow-dark-lg z-40 transform -translate-x-full lg:translate-x-0 transition-transform duration-300">
            <div class="flex flex-col h-full">
                <div class="p-5 border-b border-white/10">
                    <div class="flex items-center gap-3">
                        <i class="ph-film-slate text-2xl"></i>
                        <h1 class="text-xl font-bold tracking-tight">Anime Tagalog</h1>
                    </div>
                </div>
                
                <nav class="flex-1 p-4 space-y-1 mt-2">
                    <a href="#" class="flex items-center gap-3 px-4 py-3 rounded-lg text-white hover:bg-white/5 active-nav-link transition-all" id="dashboard-link">
                        <i class="ph-chart-pie"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="#" class="flex items-center gap-3 px-4 py-3 rounded-lg text-white/80 hover:text-white hover:bg-white/5 transition-all" id="anime-link">
                        <i class="ph-film-slate"></i>
                        <span>Anime Library</span>
                    </a>
                    <a href="#" class="flex items-center gap-3 px-4 py-3 rounded-lg text-white/80 hover:text-white hover:bg-white/5 transition-all" id="add-anime-link">
                        <i class="ph-plus-circle"></i>
                        <span>Add Anime</span>
                    </a>
                    <a href="#" class="flex items-center gap-3 px-4 py-3 rounded-lg text-white/80 hover:text-white hover:bg-white/5 transition-all" id="episodes-link">
                        <i class="ph-play-circle"></i>
                        <span>Episodes</span>
                    </a>
                    <a href="#" class="flex items-center gap-3 px-4 py-3 rounded-lg text-white/80 hover:text-white hover:bg-white/5 transition-all" id="scheduled-link">
                        <i class="ph-calendar"></i>
                        <span>Schedule Releases</span>
                    </a>
                </nav>
                
                <div class="p-4 border-t border-white/10 mt-auto">
                    <div class="flex items-center justify-between text-white/80">
                        <span class="text-sm">Â© 2025 Anime Tagalog</span>
                        <a href="#" class="p-1 rounded-full hover:bg-white/10 transition-colors">
                            <i class="ph-gear text-lg"></i>
                        </a>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Mobile Sidebar Toggle -->
        <button id="sidebarToggle" class="fixed top-4 left-4 z-50 lg:hidden w-10 h-10 flex items-center justify-center rounded-md bg-primary-600 text-white shadow-dark">
            <i class="ph-list"></i>
        </button>

        <!-- Main Content -->
        <main class="flex-1 overflow-x-hidden overflow-y-auto bg-dark-800 lg:ml-0 transition-all">
            <div class="container p-4 sm:p-6 mx-auto max-w-7xl">
                <!-- Dashboard View -->
                <div id="dashboard-view" class="space-y-6">
                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
                        <h1 class="text-2xl font-bold text-white">Dashboard</h1>
                        <button type="button" class="inline-flex items-center gap-2 px-4 py-2 bg-dark-600 border border-dark-400 rounded-lg text-sm font-medium hover:bg-dark-500 transition-colors shadow-dark" id="refresh-dashboard">
                            <i class="ph-arrows-clockwise"></i>
                            <span>Refresh</span>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6">
                        <!-- Total Anime Card -->
                        <div class="bg-dark-600 rounded-xl shadow-dark border border-dark-500 overflow-hidden hover-card">
                            <div class="p-6">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Total Anime</p>
                                        <h2 class="mt-2 text-3xl font-bold text-white" id="total-anime">0</h2>
                                    </div>
                                    <div class="w-12 h-12 flex items-center justify-center rounded-xl bg-primary-900/60 text-primary-400">
                                        <i class="ph-film-slate text-xl"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="h-1 w-full bg-primary-600"></div>
                        </div>
                        
                        <!-- Total Episodes Card -->
                        <div class="bg-dark-600 rounded-xl shadow-dark border border-dark-500 overflow-hidden hover-card">
                            <div class="p-6">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Total Episodes</p>
                                        <h2 class="mt-2 text-3xl font-bold text-white" id="total-episodes">0</h2>
                                    </div>
                                    <div class="w-12 h-12 flex items-center justify-center rounded-xl bg-green-900/60 text-green-400">
                                        <i class="ph-play-circle text-xl"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="h-1 w-full bg-green-600"></div>
                        </div>
                        
                        <!-- Tagalog Dubbed Card -->
                        <div class="bg-dark-600 rounded-xl shadow-dark border border-dark-500 overflow-hidden hover-card">
                            <div class="p-6">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Tagalog Dubbed</p>
                                        <h2 class="mt-2 text-3xl font-bold text-white" id="tagalog-count">0</h2>
                                    </div>
                                    <div class="w-12 h-12 flex items-center justify-center rounded-xl bg-secondary-900/60 text-secondary-400">
                                        <i class="ph-translate text-xl"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="h-1 w-full bg-secondary-600"></div>
                        </div>
                        
                        <!-- Scheduled Card -->
                        <div class="bg-dark-600 rounded-xl shadow-dark border border-dark-500 overflow-hidden hover-card">
                            <div class="p-6">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Scheduled</p>
                                        <h2 class="mt-2 text-3xl font-bold text-white" id="scheduled-count">0</h2>
                                    </div>
                                    <div class="w-12 h-12 flex items-center justify-center rounded-xl bg-amber-900/60 text-amber-400">
                                        <i class="ph-calendar text-xl"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="h-1 w-full bg-amber-600"></div>
                        </div>
                    </div>
                    
                    <div class="flex flex-col xl:flex-row gap-6">
                        <!-- Latest Updates Section -->
                        <div class="w-full xl:w-2/3">
                            <div class="bg-dark-600 rounded-xl shadow-dark border border-dark-500">
                                <div class="flex items-center justify-between px-6 py-4 border-b border-dark-500">
                                    <h2 class="font-semibold text-white flex items-center gap-2">
                                        <i class="ph-clock text-gray-400"></i>
                                        Latest Updates
                                    </h2>
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="w-full">
                                        <thead>
                                            <tr class="bg-dark-700">
                                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Type</th>
                                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Title</th>
                                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Added</th>
                                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody id="latest-updates-table" class="divide-y divide-dark-500">
                                            <tr>
                                                <td colspan="4" class="px-6 py-8 text-center text-sm text-gray-400">
                                                    <div class="flex justify-center">
                                                        <div class="w-6 h-6 border-2 border-t-primary-500 border-gray-700 rounded-full animate-spin mr-2"></div>
                                                        Loading latest updates...
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Upcoming Releases Section -->
                        <div class="w-full xl:w-1/3">
                            <div class="bg-dark-600 rounded-xl shadow-dark border border-dark-500">
                                <div class="flex items-center justify-between px-6 py-4 border-b border-dark-500">
                                    <h2 class="font-semibold text-white flex items-center gap-2">
                                        <i class="ph-calendar-check text-gray-400"></i>
                                        Upcoming Releases
                                    </h2>
                                    <a href="#" id="view-all-scheduled" class="text-sm text-primary-400 hover:text-primary-300 font-medium">View all</a>
                                </div>
                                <div class="p-4">
                                    <div id="upcoming-releases" class="space-y-3">
                                        <div class="p-6 text-center text-sm text-gray-400">
                                            <div class="flex justify-center mb-3">
                                                <div class="w-6 h-6 border-2 border-t-primary-500 border-gray-700 rounded-full animate-spin"></div>
                                            </div>
                                            Loading upcoming releases...
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Anime Library View -->
                <div id="anime-view" class="space-y-6 hidden">
                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
                        <h1 class="text-2xl font-bold text-white">Anime Library</h1>
                        <div class="flex flex-wrap items-center gap-3">
                            <div class="relative">
                                <input type="text" id="librarySearch" placeholder="Search anime..." class="w-full px-4 py-2 pr-10 rounded-lg border border-dark-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-dark-600 text-white shadow-dark">
                                <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400">
                                    <i class="ph-magnifying-glass"></i>
                                </span>
                            </div>
                            <select id="tagalogFilter" class="px-4 py-2 rounded-lg border border-dark-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-dark-600 text-white shadow-dark">
                                <option value="all">All Anime</option>
                                <option value="tagalog">Tagalog Dubbed</option>
                                <option value="non-tagalog">Not Dubbed</option>
                            </select>
                            <button type="button" id="add-anime-btn" class="inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg text-sm font-medium hover:bg-primary-700 transition-colors shadow-dark">
                                <i class="ph-plus"></i>
                                <span>Add New Anime</span>
                            </button>
                        </div>
                    </div>
                    
                    <div id="anime-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 lg:gap-6">
                        <div class="col-span-full flex justify-center py-12">
                            <div class="flex flex-col items-center">
                                <div class="w-12 h-12 border-4 border-t-primary-500 border-gray-700 rounded-full animate-spin mb-4"></div>
                                <p class="text-gray-400">Loading anime library...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Add Anime View -->
                <div id="add-anime-view" class="space-y-6 hidden">
                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
                        <h1 class="text-2xl font-bold text-white">Add New Anime</h1>
                        <button type="button" id="back-to-library" class="inline-flex items-center gap-2 px-4 py-2 bg-dark-600 border border-dark-400 rounded-lg text-sm font-medium hover:bg-dark-500 transition-colors shadow-dark">
                            <i class="ph-arrow-left"></i>
                            <span>Back to Library</span>
                        </button>
                    </div>
                    
                    <div class="bg-dark-600 rounded-xl shadow-dark border border-dark-500">
                        <div class="flex items-center px-6 py-4 border-b border-dark-500">
                            <i class="ph-magnifying-glass mr-2 text-gray-400"></i>
                            <h2 class="font-semibold text-white">Search Anime on AniList</h2>
                        </div>
                        <div class="p-6">
                            <div class="mb-6">
                                <label for="animeSearch" class="block text-sm font-medium text-gray-300 mb-2">Search by Title</label>
                                <div class="relative">
                                    <input type="text" class="w-full px-4 py-3 pr-10 rounded-lg border border-dark-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-dark-600 text-white shadow-dark" id="animeSearch" placeholder="Enter anime title and press enter...">
                                    <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400">
                                        <i class="ph-magnifying-glass"></i>
                                    </span>
                                    <div class="search-results bg-dark-600 mt-2 rounded-lg border border-dark-400 shadow-dark-lg" id="searchResults">
                                        <!-- Search results will be populated here -->
                                    </div>
                                </div>
                            </div>
                            
                            <div id="selectedAnimeDetails" class="hidden mt-8">
                                <div class="bg-dark-700 rounded-xl overflow-hidden border border-dark-500 shadow-dark">
                                    <div class="p-6">
                                        <div class="flex flex-col md:flex-row gap-6">
                                            <div class="w-full md:w-1/4">
                                                <img id="selectedAnimeThumbnail" src="" alt="Anime Cover" class="w-full object-cover rounded-lg shadow-dark">
                                            </div>
                                            <div class="w-full md:w-3/4">
                                                <h3 id="selectedAnimeTitle" class="text-xl font-bold text-white mb-3"></h3>
                                                <p id="selectedAnimeDescription" class="text-gray-300 mb-4 text-sm"></p>
                                                
                                                <div class="flex flex-wrap gap-2 mb-4" id="selectedAnimeGenres">
                                                    <!-- Genres will be populated here -->
                                                </div>
                                                
                                                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                                                    <div class="bg-dark-600 p-3 rounded-lg shadow-dark">
                                                        <p class="text-xs text-gray-400 uppercase">Episodes</p>
                                                        <p id="selectedAnimeEpisodes" class="font-semibold text-white">-</p>
                                                    </div>
                                                    <div class="bg-dark-600 p-3 rounded-lg shadow-dark">
                                                        <p class="text-xs text-gray-400 uppercase">Status</p>
                                                        <p id="selectedAnimeStatus" class="font-semibold text-white">-</p>
                                                    </div>
                                                    <div class="bg-dark-600 p-3 rounded-lg shadow-dark">
                                                        <p class="text-xs text-gray-400 uppercase">Season</p>
                                                        <p id="selectedAnimeSeason" class="font-semibold text-white">-</p>
                                                    </div>
                                                    <div class="bg-dark-600 p-3 rounded-lg shadow-dark">
                                                        <p class="text-xs text-gray-400 uppercase">Rating</p>
                                                        <p id="selectedAnimeRating" class="font-semibold text-white">-</p>
                                                    </div>
                                                </div>
                                                
                                                <div class="flex flex-wrap items-center gap-3">
                                                    <div class="relative inline-flex items-center cursor-pointer">
                                                        <input type="checkbox" id="hasTagalogDub" class="sr-only peer">
                                                        <div class="w-11 h-6 bg-dark-400 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-secondary-900 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-secondary-600"></div>
                                                        <span class="ml-3 text-sm font-medium text-gray-300">Has Tagalog Dub</span>
                                                    </div>
                                                    <button class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors shadow-dark flex items-center gap-2" id="addSelectedAnime">
                                                        <i class="ph-plus-circle"></i>
                                                        Add to Library
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Episodes View -->
                <div id="episodes-view" class="space-y-6 hidden">
                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
                        <h1 class="text-2xl font-bold text-white">Manage Episodes</h1>
                    </div>
                    
                    <div class="bg-dark-600 rounded-xl shadow-dark border border-dark-500">
                        <div class="flex items-center px-6 py-4 border-b border-dark-500">
                            <i class="ph-film-slate mr-2 text-gray-400"></i>
                            <h2 class="font-semibold text-white">Select Anime</h2>
                        </div>
                        <div class="p-6">
                            <select class="w-full px-4 py-3 rounded-lg border border-dark-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-dark-600 text-white shadow-dark" id="episodeAnimeSelector">
                                <option value="">Choose an anime...</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="episodeManagementArea" class="hidden">
                        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                            <div class="lg:col-span-1 space-y-6">
                                <div class="bg-dark-600 rounded-xl shadow-dark border border-dark-500 overflow-hidden">
                                    <img id="episodeAnimeThumbnail" src="" class="w-full object-cover h-64 lg:h-80" alt="Anime Cover">
                                    <div class="p-4">
                                        <h3 id="episodeAnimeTitle" class="font-bold text-white mb-1"></h3>
                                        <p id="episodeAnimeEpisodeCount" class="text-sm text-gray-400"></p>
                                        <div class="mt-3 flex items-center">
                                            <span id="tagalogStatusBadge" class="px-2.5 py-1 rounded-full text-xs font-medium bg-dark-400 text-gray-300 flex items-center gap-1">
                                                <i class="ph-question"></i> 
                                                Dub status unknown
                                            </span>
                                            <button id="toggleTagalogDub" class="ml-2 p-1.5 text-gray-400 hover:text-primary-400 rounded-full hover:bg-dark-500">
                                                <i class="ph-pencil-simple text-sm"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-dark-600 rounded-xl shadow-dark border border-dark-500">
                                    <div class="flex items-center px-6 py-4 border-b border-dark-500">
                                        <i class="ph-plus-circle mr-2 text-gray-400"></i>
                                        <h2 class="font-semibold text-white">Add New Episode</h2>
                                    </div>
                                    <div class="p-6">
                                        <form id="addEpisodeForm" class="space-y-4">
                                            <div>
                                                <label for="iframeSrc" class="block text-sm font-medium text-gray-300 mb-1">iFrame Source (optional)</label>
                                                <input type="text" class="w-full px-4 py-2 rounded-lg border border-dark-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-dark-600 text-white shadow-dark" id="iframeSrc" placeholder="Enter iframe embed URL">
                                            </div>
                                            <div>
                                                <label for="server2Url" class="block text-sm font-medium text-gray-300 mb-1">Server 2 URL</label>
                                                <input type="text" class="w-full px-4 py-2 rounded-lg border border-dark-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-dark-600 text-white shadow-dark" id="server2Url" required placeholder="Enter direct video URL">
                                            </div>
                                            <div class="relative inline-flex items-center cursor-pointer">
                                                <input type="checkbox" id="episodeHasTagalogDub" class="sr-only peer">
                                                <div class="w-11 h-6 bg-dark-400 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-secondary-900 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-secondary-600"></div>
                                                <span class="ml-3 text-sm font-medium text-gray-300">Has Tagalog Dub</span>
                                            </div>
                                            <button type="submit" class="w-full px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors shadow-dark flex items-center justify-center gap-2">
                                                <i class="ph-plus"></i> Add Episode
                                            </button>
                                        </form>
                                    </div>
                                </div>
                                
                                <div class="bg-dark-600 rounded-xl shadow-dark border border-dark-500">
                                    <div class="flex items-center px-6 py-4 border-b border-dark-500">
                                        <i class="ph-cloud-arrow-up mr-2 text-gray-400"></i>
                                        <h2 class="font-semibold text-white">Bulk Add Episodes</h2>
                                    </div>
                                    <div class="p-6">
                                        <div class="space-y-4">
                                            <div>
                                                <label for="bulkEpisodeHtml" class="block text-sm font-medium text-gray-300 mb-1">Paste HTML Select with Episodes</label>
                                                <textarea class="w-full px-4 py-2 rounded-lg border border-dark-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-dark-600 text-white shadow-dark" id="bulkEpisodeHtml" rows="5" placeholder="<select id='episode-select'>...</select>"></textarea>
                                                <p class="mt-1 text-xs text-gray-400">Paste the HTML select element containing episode options with server2Url attributes.</p>
                                            </div>
                                            <div>
                                                <label for="server1DefaultValue" class="block text-sm font-medium text-gray-300 mb-1">Default Server 1 Value (optional)</label>
                                                <input type="text" class="w-full px-4 py-2 rounded-lg border border-dark-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-dark-600 text-white shadow-dark" id="server1DefaultValue" placeholder="Default value for data-server1">
                                            </div>
                                            <div class="flex items-center mt-3">
                                                <div class="relative inline-flex items-center cursor-pointer mr-4">
                                                    <input type="checkbox" id="replaceExisting" class="sr-only peer">
                                                    <div class="w-11 h-6 bg-dark-400 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-900 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                                    <span class="ml-3 text-sm font-medium text-gray-300">Replace existing</span>
                                                </div>
                                                <div class="relative inline-flex items-center cursor-pointer">
                                                    <input type="checkbox" id="bulkHasTagalogDub" class="sr-only peer">
                                                    <div class="w-11 h-6 bg-dark-400 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-secondary-900 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-secondary-600"></div>
                                                    <span class="ml-3 text-sm font-medium text-gray-300">Set all as Tagalog</span>
                                                </div>
                                            </div>
                                            <div class="flex gap-2 mt-4">
                                                <button type="button" class="flex-1 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors shadow-dark flex items-center justify-center gap-2" id="parseBulkEpisodesBtn">
                                                    <i class="ph-code"></i> Parse 
                                                    <span class="ml-1 px-1.5 py-0.5 text-xs bg-white/20 rounded-full" id="episodeCount">0</span>
                                                </button>
                                                <button type="button" class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors shadow-dark flex items-center justify-center gap-2" id="uploadBulkEpisodesBtn" disabled>
                                                    <i class="ph-cloud-arrow-up"></i> Upload
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="lg:col-span-3">
                                <div class="bg-dark-600 rounded-xl shadow-dark border border-dark-500">
                                    <div class="flex items-center justify-between px-6 py-4 border-b border-dark-500">
                                        <div class="flex items-center">
                                            <i class="ph-play-circle mr-2 text-gray-400"></i>
                                            <h2 class="font-semibold text-white">Episodes List</h2>
                                        </div>
                                        <div class="text-sm text-gray-400" id="episodes-count-display"></div>
                                    </div>
                                    <div id="episodesList" class="p-6">
                                        <!-- Episodes will be populated here -->
                                        <div class="text-center py-8">
                                            <i class="ph-video text-dark-400 text-5xl mb-3"></i>
                                            <p class="text-gray-400">Select an anime to manage episodes</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Scheduled Anime View -->
                <div id="scheduled-view" class="space-y-6 hidden">
                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
                        <h1 class="text-2xl font-bold text-white">Scheduled Releases</h1>
                        <button type="button" id="add-scheduled-btn" class="inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg text-sm font-medium hover:bg-primary-700 transition-colors shadow-dark">
                            <i class="ph-plus"></i>
                            <span>Schedule New Release</span>
                        </button>
                    </div>
                    
                    <div class="bg-dark-600 rounded-xl shadow-dark border border-dark-500">
                        <div class="flex items-center justify-between px-6 py-4 border-b border-dark-500">
                            <h2 class="font-semibold text-white flex items-center gap-2">
                                <i class="ph-calendar-check text-gray-400"></i>
                                Upcoming Releases
                            </h2>
                            <div class="flex items-center gap-2">
                                <select id="scheduleFilter" class="px-3 py-1.5 text-sm rounded-lg border border-dark-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-dark-600 text-white shadow-dark">
                                    <option value="all">All</option>
                                    <option value="upcoming">Upcoming</option>
                                    <option value="past">Past Releases</option>
                                    <option value="tagalog">Tagalog Dub</option>
                                </select>
                            </div>
                        </div>
                        <div id="scheduledList" class="divide-y divide-dark-500">
                            <div class="text-center py-12">
                                <div class="flex flex-col items-center">
                                    <div class="w-12 h-12 border-4 border-t-primary-500 border-gray-700 rounded-full animate-spin mb-4"></div>
                                    <p class="text-gray-400">Loading scheduled releases...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Edit Episode Modal -->
    <div class="fixed inset-0 z-50 overflow-y-auto hidden" id="editEpisodeModal">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="fixed inset-0 bg-black/85 backdrop-blur-sm transition-opacity" id="editEpisodeOverlay"></div>
            <div class="relative bg-dark-600 rounded-xl shadow-dark-lg max-w-lg w-full mx-auto transform transition-all">
                <div class="flex items-center justify-between px-6 py-4 border-b border-dark-500">
                    <h3 class="text-lg font-semibold text-white" id="editEpisodeModalTitle">Edit Episode</h3>
                    <button type="button" class="text-gray-400 hover:text-gray-300" id="closeEditEpisodeModal">
                        <i class="ph-x text-xl"></i>
                    </button>
                </div>
                <div class="p-6">
                    <form id="editEpisodeForm" class="space-y-4">
                        <input type="hidden" id="editEpisodeId">
                        <div>
                            <label for="editIframeSrc" class="block text-sm font-medium text-gray-300 mb-1">iFrame Source (optional)</label>
                            <input type="text" class="w-full px-4 py-2 rounded-lg border border-dark-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-dark-600 text-white shadow-dark" id="editIframeSrc">
                        </div>
                        <div>
                            <label for="editServer2Url" class="block text-sm font-medium text-gray-300 mb-1">Server 2 URL</label>
                            <input type="text" class="w-full px-4 py-2 rounded-lg border border-dark-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-dark-600 text-white shadow-dark" id="editServer2Url" required>
                        </div>
                        <div class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="editEpisodeHasTagalogDub" class="sr-only peer">
                            <div class="w-11 h-6 bg-dark-400 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-secondary-900 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-secondary-600"></div>
                            <span class="ml-3 text-sm font-medium text-gray-300">Has Tagalog Dub</span>
                        </div>
                    </form>
                </div>
                <div class="px-6 py-4 border-t border-dark-500 flex justify-end gap-2">
                    <button type="button" class="px-4 py-2 bg-dark-500 border border-dark-400 text-gray-300 rounded-lg hover:bg-dark-400 transition-colors shadow-dark" id="cancelEditEpisodeBtn">
                        Cancel
                    </button>
                    <button type="button" class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors shadow-dark flex items-center gap-2" id="saveEditEpisodeBtn">
                        <i class="ph-check"></i> Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Episode Modal -->
    <div class="fixed inset-0 z-50 overflow-y-auto hidden" id="deleteEpisodeModal">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="fixed inset-0 bg-black/85 backdrop-blur-sm transition-opacity" id="deleteEpisodeOverlay"></div>
            <div class="relative bg-dark-600 rounded-xl shadow-dark-lg max-w-lg w-full mx-auto transform transition-all">
                <div class="flex items-center justify-between px-6 py-4 border-b border-dark-500">
                    <h3 class="text-lg font-semibold text-white">Confirm Delete</h3>
                    <button type="button" class="text-gray-400 hover:text-gray-300" id="closeDeleteEpisodeModal">
                        <i class="ph-x text-xl"></i>
                    </button>
                </div>
                <div class="p-6">
                    <div class="flex items-center p-4 mb-4 bg-amber-900/40 text-amber-400 rounded-lg">
                        <i class="ph-warning mr-2 text-amber-500 text-xl"></i>
                        <div>Are you sure you want to delete this episode?</div>
                    </div>
                    <p class="font-medium text-gray-300" id="deleteEpisodeInfo"></p>
                </div>
                <div class="px-6 py-4 border-t border-dark-500 flex justify-end gap-2">
                    <button type="button" class="px-4 py-2 bg-dark-500 border border-dark-400 text-gray-300 rounded-lg hover:bg-dark-400 transition-colors shadow-dark" id="cancelDeleteEpisodeBtn">
                        Cancel
                    </button>
                    <button type="button" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors shadow-dark flex items-center gap-2" id="confirmDeleteEpisodeBtn">
                        <i class="ph-trash"></i> Delete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Upload Preview Modal -->
    <div class="fixed inset-0 z-50 overflow-y-auto hidden" id="bulkUploadPreviewModal">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="fixed inset-0 bg-black/85 backdrop-blur-sm transition-opacity" id="bulkUploadPreviewOverlay"></div>
            <div class="relative bg-dark-600 rounded-xl shadow-dark-lg max-w-5xl w-full mx-auto transform transition-all">
                <div class="flex items-center justify-between px-6 py-4 border-b border-dark-500">
                    <h3 class="text-lg font-semibold text-white">Episode Upload Preview</h3>
                    <button type="button" class="text-gray-400 hover:text-gray-300" id="closeBulkUploadPreviewModal">
                        <i class="ph-x text-xl"></i>
                    </button>
                </div>
                <div class="p-6">
                    <div class="flex items-center p-4 mb-4 bg-blue-900/40 text-blue-400 rounded-lg">
                        <i class="ph-info mr-2 text-blue-500 text-xl"></i>
                        <div>Review the episodes below before confirming upload.</div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="bg-dark-700">
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Episode #</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Title</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Server 1</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Server 2</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Tagalog Dub</th>
                                </tr>
                            </thead>
                            <tbody id="bulkEpisodePreviewTable" class="divide-y divide-dark-500">
                                <!-- Episodes will be listed here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="px-6 py-4 border-t border-dark-500 flex justify-end gap-2">
                    <button type="button" class="px-4 py-2 bg-dark-500 border border-dark-400 text-gray-300 rounded-lg hover:bg-dark-400 transition-colors shadow-dark" id="cancelBulkUploadBtn">
                        Cancel
                    </button>
                    <button type="button" class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors shadow-dark flex items-center gap-2" id="confirmBulkUploadBtn">
                        <i class="ph-cloud-arrow-up"></i> Confirm Upload
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Schedule Modal -->
    <div class="fixed inset-0 z-50 overflow-y-auto hidden" id="addScheduleModal">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="fixed inset-0 bg-black/85 backdrop-blur-sm transition-opacity" id="addScheduleOverlay"></div>
            <div class="relative bg-dark-600 rounded-xl shadow-dark-lg max-w-xl w-full mx-auto transform transition-all">
                <div class="flex items-center justify-between px-6 py-4 border-b border-dark-500">
                    <h3 class="text-lg font-semibold text-white">Schedule New Release</h3>
                    <button type="button" class="text-gray-400 hover:text-gray-300" id="closeAddScheduleModal">
                        <i class="ph-x text-xl"></i>
                    </button>
                </div>
                <div class="p-6">
                    <form id="addScheduleForm" class="space-y-4">
                        <div>
                            <label for="scheduleAnimeSearch" class="block text-sm font-medium text-gray-300 mb-1">Search Anime</label>
                            <div class="relative">
                                <input type="text" class="w-full px-4 py-2 rounded-lg border border-dark-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-dark-600 text-white shadow-dark" id="scheduleAnimeSearch" placeholder="Search for anime to schedule...">
                                <div class="search-results bg-dark-600 mt-2 rounded-lg border border-dark-400 shadow-dark-lg" id="scheduleSearchResults">
                                    <!-- Search results will be populated here -->
                                </div>
                            </div>
                        </div>
                        
                        <div id="selectedScheduleAnime" class="hidden p-4 bg-dark-700 rounded-lg border border-dark-500 shadow-dark">
                            <div class="flex items-center gap-3">
                                <img src="" id="scheduleAnimeThumbnail" class="w-16 h-16 object-cover rounded-lg" alt="Anime thumbnail">
                                <div>
                                    <h4 id="scheduleAnimeTitle" class="font-medium text-white"></h4>
                                    <p id="scheduleAnimeInfo" class="text-sm text-gray-400"></p>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label for="scheduleReleaseDate" class="block text-sm font-medium text-gray-300 mb-1">Release Date</label>
                            <input type="datetime-local" class="w-full px-4 py-2 rounded-lg border border-dark-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-dark-600 text-white shadow-dark" id="scheduleReleaseDate" required>
                        </div>
                        
                        <div>
                            <label for="scheduleNotes" class="block text-sm font-medium text-gray-300 mb-1">Release Notes (optional)</label>
                            <textarea class="w-full px-4 py-2 rounded-lg border border-dark-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-dark-600 text-white shadow-dark" id="scheduleNotes" rows="3" placeholder="Any additional information about this release..."></textarea>
                        </div>
                        
                        <div class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="scheduleHasTagalogDub" class="sr-only peer">
                            <div class="w-11 h-6 bg-dark-400 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-secondary-900 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-secondary-600"></div>
                            <span class="ml-3 text-sm font-medium text-gray-300">Will have Tagalog Dub</span>
                        </div>
                    </form>
                </div>
                <div class="px-6 py-4 border-t border-dark-500 flex justify-end gap-2">
                    <button type="button" class="px-4 py-2 bg-dark-500 border border-dark-400 text-gray-300 rounded-lg hover:bg-dark-400 transition-colors shadow-dark" id="cancelAddScheduleBtn">
                        Cancel
                    </button>
                    <button type="button" class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors shadow-dark flex items-center gap-2" id="saveScheduleBtn">
                        <i class="ph-calendar-plus"></i> Schedule Release
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Schedule Modal -->
    <div class="fixed inset-0 z-50 overflow-y-auto hidden" id="editScheduleModal">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="fixed inset-0 bg-black/85 backdrop-blur-sm transition-opacity" id="editScheduleOverlay"></div>
            <div class="relative bg-dark-600 rounded-xl shadow-dark-lg max-w-xl w-full mx-auto transform transition-all">
                <div class="flex items-center justify-between px-6 py-4 border-b border-dark-500">
                    <h3 class="text-lg font-semibold text-white">Edit Scheduled Release</h3>
                    <button type="button" class="text-gray-400 hover:text-gray-300" id="closeEditScheduleModal">
                        <i class="ph-x text-xl"></i>
                    </button>
                </div>
                <div class="p-6">
                    <form id="editScheduleForm" class="space-y-4">
                        <input type="hidden" id="editScheduleId">
                        
                        <div class="p-4 bg-dark-700 rounded-lg border border-dark-500 shadow-dark">
                            <div class="flex items-center gap-3">
                                <img src="" id="editScheduleAnimeThumbnail" class="w-16 h-16 object-cover rounded-lg" alt="Anime thumbnail">
                                <div>
                                    <h4 id="editScheduleAnimeTitle" class="font-medium text-white"></h4>
                                    <p id="editScheduleAnimeInfo" class="text-sm text-gray-400"></p>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label for="editScheduleReleaseDate" class="block text-sm font-medium text-gray-300 mb-1">Release Date</label>
                            <input type="datetime-local" class="w-full px-4 py-2 rounded-lg border border-dark-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-dark-600 text-white shadow-dark" id="editScheduleReleaseDate" required>
                        </div>
                        
                        <div>
                            <label for="editScheduleNotes" class="block text-sm font-medium text-gray-300 mb-1">Release Notes (optional)</label>
                            <textarea class="w-full px-4 py-2 rounded-lg border border-dark-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-dark-600 text-white shadow-dark" id="editScheduleNotes" rows="3" placeholder="Any additional information about this release..."></textarea>
                        </div>
                        
                        <div class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="editScheduleHasTagalogDub" class="sr-only peer">
                            <div class="w-11 h-6 bg-dark-400 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-secondary-900 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-secondary-600"></div>
                            <span class="ml-3 text-sm font-medium text-gray-300">Will have Tagalog Dub</span>
                        </div>
                    </form>
                </div>
                <div class="px-6 py-4 border-t border-dark-500 flex justify-between">
                    <button type="button" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors shadow-dark flex items-center gap-2" id="deleteScheduleBtn">
                        <i class="ph-trash"></i> Delete
                    </button>
                    
                    <div class="flex gap-2">
                        <button type="button" class="px-4 py-2 bg-dark-500 border border-dark-400 text-gray-300 rounded-lg hover:bg-dark-400 transition-colors shadow-dark" id="cancelEditScheduleBtn">
                            Cancel
                        </button>
                        <button type="button" class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors shadow-dark flex items-center gap-2" id="updateScheduleBtn">
                            <i class="ph-check"></i> Update
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toggle Tagalog Dub Modal -->
    <div class="fixed inset-0 z-50 overflow-y-auto hidden" id="toggleTagalogDubModal">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="fixed inset-0 bg-black/85 backdrop-blur-sm transition-opacity" id="toggleTagalogDubOverlay"></div>
            <div class="relative bg-dark-600 rounded-xl shadow-dark-lg max-w-md w-full mx-auto transform transition-all">
                <div class="flex items-center justify-between px-6 py-4 border-b border-dark-500">
                    <h3 class="text-lg font-semibold text-white">Tagalog Dub Status</h3>
                    <button type="button" class="text-gray-400 hover:text-gray-300" id="closeToggleTagalogDubModal">
                        <i class="ph-x text-xl"></i>
                    </button>
                </div>
                <div class="p-6">
                    <div class="flex flex-col items-center gap-4 text-center mb-4">
                        <div>
                            <img src="" id="dubStatusAnimeThumbnail" class="w-24 h-24 object-cover rounded-lg mx-auto" alt="Anime thumbnail">
                            <h4 id="dubStatusAnimeTitle" class="font-medium mt-2 text-white"></h4>
                        </div>
                        
                        <div class="w-full">
                            <span class="block text-sm text-gray-400 mb-3">Does this anime have Tagalog dub?</span>
                            <div class="flex gap-3 justify-center">
                                <button type="button" class="flex-1 px-4 py-3 bg-secondary-600 text-white rounded-lg hover:bg-secondary-700 transition-colors disabled:opacity-50 shadow-dark flex items-center justify-center gap-2" id="setHasTagalogDubBtn">
                                    <i class="ph-translate"></i> Yes, Has Tagalog Dub
                                </button>
                                <button type="button" class="flex-1 px-4 py-3 bg-dark-500 text-gray-300 rounded-lg hover:bg-dark-400 transition-colors disabled:opacity-50 shadow-dark flex items-center justify-center gap-2" id="setNoTagalogDubBtn">
                                    <i class="ph-x"></i> No Tagalog Dub
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="fixed bottom-4 left-1/2 transform -translate-x-1/2 z-50 flex flex-col gap-2 w-full max-w-xs">
        <!-- Error Toast -->
        <div class="hidden bg-dark-600 rounded-lg shadow-dark-lg border-l-4 border-red-500 w-full fade-in" id="errorToast">
            <div class="flex items-start p-4">
                <i class="ph-x-circle text-red-500 text-xl mr-3 mt-0.5"></i>
                <div class="flex-1">
                    <h3 class="font-medium text-white">Error</h3>
                    <p class="text-sm text-gray-300" id="errorToastMessage">Something went wrong.</p>
                </div>
                <button class="text-gray-400 hover:text-gray-300 ml-2" id="closeErrorToast">
                    <i class="ph-x"></i>
                </button>
            </div>
        </div>
        
        <!-- Success Toast -->
        <div class="hidden bg-dark-600 rounded-lg shadow-dark-lg border-l-4 border-green-500 w-full fade-in" id="successToast">
            <div class="flex items-start p-4">
                <i class="ph-check-circle text-green-500 text-xl mr-3 mt-0.5"></i>
                <div class="flex-1">
                    <h3 class="font-medium text-white">Success</h3>
                    <p class="text-sm text-gray-300" id="successToastMessage">Operation successful.</p>
                </div>
                <button class="text-gray-400 hover:text-gray-300 ml-2" id="closeSuccessToast">
                    <i class="ph-x"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Backend API URL - automatically detect whether we're on localhost or deployed
        const API_URL = window.location.hostname === 'localhost' ? 'http://localhost:3000/api' : '/api';
        
        // Initialize UI elements and event handlers
        document.addEventListener('DOMContentLoaded', function() {
            // UI Initialization
            initSidebar();
            initToasts();
            initModals();
            
            // Load initial data
            loadDashboardData();
            checkServerStatus();
            
            // Navigation events
            initNavigation();
            
            // Features initialization
            initEpisodesManagement();
            initAnimeLibrary();
            initAddAnime();
            initScheduleFeature();
            
            // Add event listeners
            document.getElementById('refresh-dashboard').addEventListener('click', loadDashboardData);
            document.getElementById('view-all-scheduled').addEventListener('click', function(e) {
                e.preventDefault();
                showView('scheduled-view');
                activateNavLink(document.getElementById('scheduled-link'));
            });
        });
        
        // Sidebar Initialization
        function initSidebar() {
            const sidebarToggle = document.getElementById('sidebarToggle');
            const sidebar = document.getElementById('sidebar');
            
            sidebarToggle.addEventListener('click', function() {
                sidebar.classList.toggle('-translate-x-full');
            });
            
            // Close sidebar when clicking outside on mobile
            document.addEventListener('click', function(e) {
                const isMobile = window.innerWidth < 1024;
                if (isMobile && !sidebar.contains(e.target) && e.target !== sidebarToggle) {
                    sidebar.classList.add('-translate-x-full');
                }
            });
        }
        
        // Toast Notifications
        function initToasts() {
            // Error toast
            const errorToast = document.getElementById('errorToast');
            const closeErrorToast = document.getElementById('closeErrorToast');
            
            // Success toast
            const successToast = document.getElementById('successToast');
            const closeSuccessToast = document.getElementById('closeSuccessToast');
            
            // Close toast handlers
            closeErrorToast.addEventListener('click', () => {
                errorToast.classList.add('hidden');
                errorToast.classList.remove('flex');
            });
            
            closeSuccessToast.addEventListener('click', () => {
                successToast.classList.add('hidden');
                successToast.classList.remove('flex');
            });
        }
        
        // Show error toast
        function showError(message) {
            const errorToast = document.getElementById('errorToast');
            const errorToastMessage = document.getElementById('errorToastMessage');
            
            errorToastMessage.textContent = message;
            errorToast.classList.remove('hidden');
            errorToast.classList.add('flex', 'fade-in');
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                errorToast.classList.add('hidden');
                errorToast.classList.remove('flex', 'fade-in');
            }, 5000);
        }
        
        // Show success toast
        function showSuccess(message) {
            const successToast = document.getElementById('successToast');
            const successToastMessage = document.getElementById('successToastMessage');
            
            successToastMessage.textContent = message;
            successToast.classList.remove('hidden');
            successToast.classList.add('flex', 'fade-in');
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                successToast.classList.add('hidden');
                successToast.classList.remove('flex', 'fade-in');
            }, 5000);
        }
        
        // Loading spinner
        function showLoading() {
            document.getElementById('loadingSpinner').style.display = 'flex';
        }
        
        function hideLoading() {
            document.getElementById('loadingSpinner').style.display = 'none';
        }
       
       // Modal initialization
        function initModals() {
            // Edit Episode Modal
            const editEpisodeModal = document.getElementById('editEpisodeModal');
            const closeEditEpisodeModal = document.getElementById('closeEditEpisodeModal');
            const cancelEditEpisodeBtn = document.getElementById('cancelEditEpisodeBtn');
            const editEpisodeOverlay = document.getElementById('editEpisodeOverlay');
            
            // Delete Episode Modal
            const deleteEpisodeModal = document.getElementById('deleteEpisodeModal');
            const closeDeleteEpisodeModal = document.getElementById('closeDeleteEpisodeModal');
            const cancelDeleteEpisodeBtn = document.getElementById('cancelDeleteEpisodeBtn');
            const deleteEpisodeOverlay = document.getElementById('deleteEpisodeOverlay');
            
            // Bulk Upload Preview Modal
            const bulkUploadPreviewModal = document.getElementById('bulkUploadPreviewModal');
            const closeBulkUploadPreviewModal = document.getElementById('closeBulkUploadPreviewModal');
            const cancelBulkUploadBtn = document.getElementById('cancelBulkUploadBtn');
            const bulkUploadPreviewOverlay = document.getElementById('bulkUploadPreviewOverlay');
            
            // Add Schedule Modal
            const addScheduleModal = document.getElementById('addScheduleModal');
            const closeAddScheduleModal = document.getElementById('closeAddScheduleModal');
            const cancelAddScheduleBtn = document.getElementById('cancelAddScheduleBtn');
            const addScheduleOverlay = document.getElementById('addScheduleOverlay');
            
            // Edit Schedule Modal
            const editScheduleModal = document.getElementById('editScheduleModal');
            const closeEditScheduleModal = document.getElementById('closeEditScheduleModal');
            const cancelEditScheduleBtn = document.getElementById('cancelEditScheduleBtn');
            const editScheduleOverlay = document.getElementById('editScheduleOverlay');
            
            // Tagalog Dub Toggle Modal
            const toggleTagalogDubModal = document.getElementById('toggleTagalogDubModal');
            const closeToggleTagalogDubModal = document.getElementById('closeToggleTagalogDubModal');
            const toggleTagalogDubOverlay = document.getElementById('toggleTagalogDubOverlay');
            
            // Close modal event handlers
            [
                [closeEditEpisodeModal, cancelEditEpisodeBtn, editEpisodeOverlay, editEpisodeModal],
                [closeDeleteEpisodeModal, cancelDeleteEpisodeBtn, deleteEpisodeOverlay, deleteEpisodeModal],
                [closeBulkUploadPreviewModal, cancelBulkUploadBtn, bulkUploadPreviewOverlay, bulkUploadPreviewModal],
                [closeAddScheduleModal, cancelAddScheduleBtn, addScheduleOverlay, addScheduleModal],
                [closeEditScheduleModal, cancelEditScheduleBtn, editScheduleOverlay, editScheduleModal],
                [closeToggleTagalogDubModal, null, toggleTagalogDubOverlay, toggleTagalogDubModal]
            ].forEach(([closeBtn, cancelBtn, overlay, modal]) => {
                if (closeBtn) {
                    closeBtn.addEventListener('click', () => {
                        modal.classList.add('hidden');
                    });
                }
                
                if (cancelBtn) {
                    cancelBtn.addEventListener('click', () => {
                        modal.classList.add('hidden');
                    });
                }
                
                if (overlay) {
                    overlay.addEventListener('click', (e) => {
                        if (e.target === overlay) {
                            modal.classList.add('hidden');
                        }
                    });
                }
            });
        }
        
        // Show modal helper
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('hidden');
        }
        
        // Navigation
        function initNavigation() {
            document.getElementById('dashboard-link').addEventListener('click', function(e) {
                e.preventDefault();
                showView('dashboard-view');
                activateNavLink(this);
                loadDashboardData();
            });
            
            document.getElementById('anime-link').addEventListener('click', function(e) {
                e.preventDefault();
                showView('anime-view');
                activateNavLink(this);
                loadAnimeList();
            });
            
            document.getElementById('add-anime-link').addEventListener('click', function(e) {
                e.preventDefault();
                showView('add-anime-view');
                activateNavLink(this);
            });
            
            document.getElementById('episodes-link').addEventListener('click', function(e) {
                e.preventDefault();
                showView('episodes-view');
                activateNavLink(this);
                loadAnimeForEpisodes();
            });
            
            document.getElementById('scheduled-link').addEventListener('click', function(e) {
                e.preventDefault();
                showView('scheduled-view');
                activateNavLink(this);
                loadScheduledAnime();
            });
            
            document.getElementById('add-anime-btn').addEventListener('click', function() {
                showView('add-anime-view');
                activateNavLink(document.getElementById('add-anime-link'));
            });
            
            document.getElementById('back-to-library').addEventListener('click', function() {
                showView('anime-view');
                activateNavLink(document.getElementById('anime-link'));
                loadAnimeList();
            });
        }
        
        // Helper function to activate the correct nav link
        function activateNavLink(link) {
            // Remove active class and styling from all links
            document.querySelectorAll('nav a').forEach(el => {
                el.classList.remove('active-nav-link', 'bg-white/5');
                el.classList.add('text-white/80');
            });
            
            // Add active class to the clicked link
            link.classList.add('active-nav-link', 'bg-white/5');
            link.classList.remove('text-white/80');
            link.classList.add('text-white');
        }
        
        // Function to show a specific view and hide others
        function showView(viewId) {
            document.getElementById('dashboard-view').classList.add('hidden');
            document.getElementById('anime-view').classList.add('hidden');
            document.getElementById('add-anime-view').classList.add('hidden');
            document.getElementById('episodes-view').classList.add('hidden');
            document.getElementById('scheduled-view').classList.add('hidden');
            
            document.getElementById(viewId).classList.remove('hidden');
        }
        
        // Server status check
        function checkServerStatus() {
            const statusElement = document.getElementById('serverStatus');
            
            fetch(`${window.location.origin}/health`)
                .then(response => {
                    if (response.ok) {
                        statusElement.className = 'fixed bottom-4 right-4 py-1.5 px-3 rounded-full text-sm font-medium z-40 flex items-center gap-2 shadow-dark bg-green-600 text-white transition-all glass-effect';
                        statusElement.innerHTML = '<span class="w-2 h-2 rounded-full bg-current animate-pulse-subtle"></span><span>Server Online</span>';
                        return response.json();
                    } else {
                        throw new Error('Server Error');
                    }
                })
                .catch(error => {
                    statusElement.className = 'fixed bottom-4 right-4 py-1.5 px-3 rounded-full text-sm font-medium z-40 flex items-center gap-2 shadow-dark bg-red-600 text-white transition-all glass-effect';
                    statusElement.innerHTML = '<span class="w-2 h-2 rounded-full bg-current animate-pulse-subtle"></span><span>Server Offline</span>';
                });
        }
        
        // Load dashboard data
        function loadDashboardData() {
            showLoading();
            
            // Fetch anime list
            fetch(`${API_URL}/anime`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch anime list');
                    }
                    return response.json();
                })
                .then(animeList => {
                    document.getElementById('total-anime').textContent = animeList.length;
                    
                    // Count Tagalog dubbed anime
                    const tagalogCount = animeList.filter(anime => anime.hasTagalogDub === true).length;
                    document.getElementById('tagalog-count').textContent = tagalogCount;
                    
                    // Fetch episodes
                    return fetch(`${API_URL}/episodes`)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Failed to fetch episodes');
                            }
                            return response.json();
                        });
                })
                .then(episodes => {
                    // Ensure episodes are unique by ID
                    const uniqueEpisodes = Array.from(new Map(episodes.map(item => 
                        [item.id, item])).values());
                        
                    document.getElementById('total-episodes').textContent = uniqueEpisodes.length;
                    
                    // Sort episodes by date added (descending)
                    uniqueEpisodes.sort((a, b) => new Date(b.dateAdded) - new Date(a.dateAdded));
                    
                    // Display latest updates table
                    displayLatestUpdates(uniqueEpisodes.slice(0, 5));
                    
                    // Fetch scheduled anime
                    return fetch(`${API_URL}/scheduled`)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Failed to fetch scheduled releases');
                            }
                            return response.json();
                        });
                })
                .then(scheduledAnime => {
                    document.getElementById('scheduled-count').textContent = scheduledAnime.length;
                    
                    // Display upcoming releases in dashboard
                    displayUpcomingReleases(scheduledAnime);
                    
                    hideLoading();
                })
                .catch(error => {
                    console.error('Error loading dashboard data:', error);
                    showError('Failed to load dashboard data: ' + error.message);
                    hideLoading();
                });
        }
        
        // Display latest updates in dashboard
        function displayLatestUpdates(episodes) {
            const updatesTableBody = document.getElementById('latest-updates-table');
            updatesTableBody.innerHTML = '';
            
            if (episodes.length === 0) {
                updatesTableBody.innerHTML = `
                    <tr>
                        <td colspan="4" class="px-6 py-8 text-center text-sm text-gray-400">
                            <i class="ph-info text-gray-500 text-xl mb-2"></i>
                            <p>No updates found</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Process each episode
            const animePromises = episodes.map(episode => 
                fetch(`${API_URL}/anime/${episode.animeId}`)
                    .then(response => {
                        if (!response.ok) {
                            return null;
                        }
                        return response.json();
                    })
                    .then(anime => {
                        if (!anime) {
                            return {
                                episode: episode,
                                anime: { title: 'Unknown Anime' }
                            };
                        }
                        return {
                            episode: episode,
                            anime: anime
                        };
                    })
            );
            
            Promise.all(animePromises)
                .then(results => {
                    results.forEach(result => {
                        const dateAdded = new Date(result.episode.dateAdded);
                        const formattedDate = dateAdded.toLocaleDateString(undefined, {
                            year: 'numeric',
                            month: 'short',
                            day: 'numeric'
                        });
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td class="px-6 py-4">
                                <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-primary-900/60 text-primary-300">
                                    <i class="ph-play mr-1"></i> Episode
                                </span>
                                ${result.episode.hasTagalogDub ? `
                                <span class="inline-flex items-center ml-1 px-2.5 py-1 rounded-full text-xs font-medium bg-secondary-900/60 text-secondary-300">
                                    <i class="ph-translate mr-1"></i> Tagalog
                                </span>` : ''}
                            </td>
                            <td class="px-6 py-4">
                                <div class="font-medium text-white">${result.anime.title}</div>
                                <div class="text-sm text-gray-400">Ep ${result.episode.number}: ${result.episode.title || 'Episode ' + result.episode.number}</div>
                            </td>
                            <td class="px-6 py-4 text-sm text-gray-400">${formattedDate}</td>
                            <td class="px-6 py-4">
                                <button class="p-2 text-primary-400 hover:text-primary-300 hover:bg-primary-900/40 rounded-lg transition-colors view-episode-btn" 
                                    data-anime-id="${result.episode.animeId}" 
                                    data-episode-id="${result.episode.id}">
                                    <i class="ph-eye"></i>
                                </button>
                            </td>
                        `;
                        updatesTableBody.appendChild(row);
                    });
                    
                    // Add event listeners to view buttons
                    document.querySelectorAll('.view-episode-btn').forEach(button => {
                        button.addEventListener('click', function() {
                            const animeId = this.getAttribute('data-anime-id');
                            
                            // Switch to episodes view
                            showView('episodes-view');
                            activateNavLink(document.getElementById('episodes-link'));
                            
                            // Load anime for episodes
                            loadAnimeForEpisodes(animeId);
                        });
                    });
                })
                .catch(error => {
                    console.error('Error loading episode details:', error);
                    updatesTableBody.innerHTML = `
                        <tr>
                            <td colspan="4" class="px-6 py-8 text-center text-sm text-red-400">
                                <i class="ph-warning-circle mb-2 text-xl"></i>
                                <p>Error loading episode details</p>
                            </td>
                        </tr>
                    `;
                });
        }
        
        // Display upcoming releases in dashboard
        function displayUpcomingReleases(scheduledAnime) {
            const upcomingContainer = document.getElementById('upcoming-releases');
            upcomingContainer.innerHTML = '';
            
            // Filter for upcoming releases only and sort by date
            const now = new Date();
            const upcomingReleases = scheduledAnime
                .filter(item => new Date(item.releaseDate) > now)
                .sort((a, b) => new Date(a.releaseDate) - new Date(b.releaseDate))
                .slice(0, 3); // Show only the next 3 releases
            
            if (upcomingReleases.length === 0) {
                upcomingContainer.innerHTML = `
                    <div class="p-6 text-center">
                        <i class="ph-calendar-x text-dark-400 text-3xl mb-2"></i>
                        <p class="text-gray-400">No upcoming releases scheduled</p>
                    </div>
                `;
                return;
            }
            
            upcomingReleases.forEach(release => {
                const releaseDate = new Date(release.releaseDate);
                const now = new Date();
                const daysUntil = Math.ceil((releaseDate - now) / (1000 * 60 * 60 * 24));
                
                let timeDisplay;
                if (daysUntil === 0) {
                    timeDisplay = 'Today';
                } else if (daysUntil === 1) {
                    timeDisplay = 'Tomorrow';
                } else {
                    timeDisplay = `In ${daysUntil} days`;
                }
                
                const formattedDate = releaseDate.toLocaleDateString(undefined, {
                    weekday: 'short',
                    month: 'short',
                    day: 'numeric'
                });
                
                const releaseItem = document.createElement('div');
                releaseItem.className = 'flex items-center p-3 bg-dark-700 rounded-lg hover:bg-dark-600 transition-colors';
                releaseItem.innerHTML = `
                    <img src="${release.thumbnail}" alt="${release.title}" class="w-14 h-14 object-cover rounded-lg mr-3">
                    <div class="flex-1">
                        <h3 class="font-medium text-white line-clamp-1">${release.title}</h3>
                        <div class="flex items-center text-sm text-gray-400">
                            <i class="ph-calendar-check mr-1"></i> ${formattedDate}
                            ${release.hasTagalogDub ? `
                            <span class="ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-secondary-900/60 text-secondary-300">
                                <i class="ph-translate mr-1"></i> Tagalog
                            </span>` : ''}
                        </div>
                    </div>
                    <span class="px-2 py-1 text-xs font-medium ${daysUntil <= 1 ? 'bg-amber-900/40 text-amber-300' : 'bg-blue-900/40 text-blue-300'} rounded-full">${timeDisplay}</span>
                `;
                upcomingContainer.appendChild(releaseItem);
                
                // Add click event to navigate to schedule view
                releaseItem.addEventListener('click', function() {
                    showView('scheduled-view');
                    activateNavLink(document.getElementById('scheduled-link'));
                    loadScheduledAnime();
                    
                    // Highlight this schedule item after loading
                    setTimeout(() => {
                        const scheduleItem = document.querySelector(`[data-schedule-id="${release.id}"]`);
                        if (scheduleItem) {
                            scheduleItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            scheduleItem.classList.add('bg-dark-500');
                            setTimeout(() => {
                                scheduleItem.classList.remove('bg-dark-500');
                            }, 2000);
                        }
                    }, 500);
                });
            });
        }

        // Initialize Anime Library functions
        function initAnimeLibrary() {
            // Search and filter functionality
            const librarySearch = document.getElementById('librarySearch');
            const tagalogFilter = document.getElementById('tagalogFilter');
            
            librarySearch.addEventListener('input', function() {
                applyLibraryFilters();
            });
            
            tagalogFilter.addEventListener('change', function() {
                applyLibraryFilters();
            });
        }
        
        // Apply filters to anime library
        function applyLibraryFilters() {
            const searchTerm = document.getElementById('librarySearch').value.toLowerCase();
            const tagalogFilter = document.getElementById('tagalogFilter').value;
            const animeCards = document.querySelectorAll('#anime-list .anime-card-container');
            
            animeCards.forEach(card => {
                const title = card.getAttribute('data-title').toLowerCase();
                const hasTagalogDub = card.getAttribute('data-has-tagalog-dub') === 'true';
                
                let showBySearch = title.includes(searchTerm);
                let showByFilter = true;
                
                if (tagalogFilter === 'tagalog') {
                    showByFilter = hasTagalogDub;
                } else if (tagalogFilter === 'non-tagalog') {
                    showByFilter = !hasTagalogDub;
                }
                
                if (showBySearch && showByFilter) {
                    card.classList.remove('hidden');
                } else {
                    card.classList.add('hidden');
                }
            });
            
            // Show message if no results
            const visibleCards = document.querySelectorAll('#anime-list .anime-card-container:not(.hidden)');
            const noResultsMessage = document.getElementById('no-anime-results');
            
            if (visibleCards.length === 0) {
                if (!noResultsMessage) {
                    const message = document.createElement('div');
                    message.id = 'no-anime-results';
                    message.className = 'col-span-full py-10 text-center';
                    message.innerHTML = `
                        <i class="ph-magnifying-glass text-dark-400 text-5xl mb-3"></i>
                        <p class="text-gray-400">No anime found matching your filters</p>
                    `;
                    document.getElementById('anime-list').appendChild(message);
                }
            } else if (noResultsMessage) {
                noResultsMessage.remove();
            }
        }
        
        // Load anime list for the library view
        function loadAnimeList() {
            showLoading();
            
            fetch(`${API_URL}/anime`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch anime list');
                    }
                    return response.json();
                })
                .then(animeList => {
                    const animeListContainer = document.getElementById('anime-list');
                    animeListContainer.innerHTML = '';
                    
                    if (animeList.length === 0) {
                        animeListContainer.innerHTML = `
                            <div class="col-span-full flex flex-col items-center justify-center py-12">
                                <i class="ph-film-strip text-dark-400 text-5xl mb-3"></i>
                                <p class="text-gray-400 mb-4">No anime found. Add some to get started!</p>
                                <button class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors shadow-dark" id="no-anime-add-btn">
                                    <i class="ph-plus mr-1"></i> Add Anime
                                </button>
                            </div>
                        `;
                        
                        document.getElementById('no-anime-add-btn').addEventListener('click', function() {
                            showView('add-anime-view');
                            activateNavLink(document.getElementById('add-anime-link'));
                        });
                    } else {
                        animeList.forEach(anime => {
                            const card = document.createElement('div');
                            card.className = 'anime-card-container';
                            card.setAttribute('data-title', anime.title);
                            card.setAttribute('data-has-tagalog-dub', anime.hasTagalogDub === true);
                            
                            card.innerHTML = `
                                <div class="bg-dark-600 rounded-xl shadow-dark border border-dark-500 overflow-hidden h-full hover:shadow-dark-lg transition-shadow anime-card hover-card" data-anime-id="${anime.id}">
                                    <div class="relative">
                                        <img src="${anime.thumbnail}" class="w-full h-56 object-cover" alt="${anime.title}" onerror="this.src='https://via.placeholder.com/400x560?text=No+Image'">
                                        ${anime.hasTagalogDub ? `
                                        <div class="absolute top-2 right-2 px-2.5 py-1 rounded-full text-xs font-medium bg-secondary-600 text-white">
                                            <i class="ph-translate mr-1"></i> Tagalog Dub
                                        </div>` : ''}
                                    </div>
                                    <div class="p-4">
                                        <h3 class="font-semibold text-white line-clamp-1 mb-1">${anime.title}</h3>
                                        <div class="flex flex-wrap gap-1 mb-2">
                                            ${anime.genres.slice(0, 3).map(genre => 
                                                `<span class="px-2 py-0.5 rounded text-xs font-medium bg-dark-500 text-gray-300">${genre}</span>`
                                            ).join('')}
                                            ${anime.genres.length > 3 ? `<span class="px-2 py-0.5 rounded text-xs font-medium bg-dark-500 text-gray-300">+${anime.genres.length - 3}</span>` : ''}
                                        </div>
                                        <p class="text-sm text-gray-400 line-clamp-2 mb-4">${anime.description || 'No description available'}</p>
                                        <div class="flex items-center justify-between mt-auto">
                                            <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-dark-500 text-gray-300">
                                                <i class="ph-play mr-1"></i> ${anime.episodeCount} ep
                                            </span>
                                            <button class="inline-flex items-center px-2.5 py-1.5 rounded-lg text-sm font-medium bg-primary-900/60 text-primary-300 hover:bg-primary-900/80 transition-colors manage-episodes-btn" data-anime-id="${anime.id}">
                                                <i class="ph-pencil mr-1"></i> Manage
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `;
                            animeListContainer.appendChild(card);
                        });
                        
                        // Add event listeners to manage episodes buttons
                        document.querySelectorAll('.manage-episodes-btn').forEach(button => {
                            button.addEventListener('click', function(e) {
                                e.stopPropagation();
                                const animeId = this.getAttribute('data-anime-id');
                                
                                // Switch to episodes view
                                showView('episodes-view');
                                activateNavLink(document.getElementById('episodes-link'));
                                
                                // Load anime for episodes
                                loadAnimeForEpisodes(animeId);
                            });
                        });
                        
                        // Make the entire card clickable to go to episode management
                        document.querySelectorAll('.anime-card').forEach(card => {
                            card.addEventListener('click', function() {
                                const animeId = this.getAttribute('data-anime-id');
                                
                                // Switch to episodes view
                                showView('episodes-view');
                                activateNavLink(document.getElementById('episodes-link'));
                                
                                // Load anime for episodes
                                loadAnimeForEpisodes(animeId);
                            });
                        });
                    }
                    
                    hideLoading();
                })
                .catch(error => {
                    console.error('Error loading anime list:', error);
                    showError('Failed to load anime list: ' + error.message);
                    hideLoading();
                });
        }
        
        // Initialize Add Anime view
        function initAddAnime() {
            const animeSearchInput = document.getElementById('animeSearch');
            const searchResultsContainer = document.getElementById('searchResults');
            
            animeSearchInput.addEventListener('input', function() {
                const searchTerm = this.value.trim();
                
                if (searchTerm.length < 3) {
                    searchResultsContainer.style.display = 'none';
                    return;
                }
                
                showLoading();
                // Search AniList API
                fetch(`${API_URL}/search?query=${encodeURIComponent(searchTerm)}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Search failed');
                        }
                        return response.json();
                    })
                    .then(results => {
                        searchResultsContainer.innerHTML = '';
                        
                        if (results.length === 0) {
                            searchResultsContainer.innerHTML = `
                                <div class="p-4 text-center text-gray-400">
                                    <i class="ph-magnifying-glass mb-2 text-xl"></i>
                                    <p>No results found for "${searchTerm}"</p>
                                </div>
                            `;
                        } else {
                            results.forEach(anime => {
                                const resultItem = document.createElement('div');
                                resultItem.className = 'p-3 hover:bg-dark-500 cursor-pointer border-b border-dark-500 last:border-b-0';
                                resultItem.setAttribute('data-anime-id', anime.id);
                                resultItem.innerHTML = `
                                    <div class="flex items-center">
                                        <img src="${anime.thumbnail}" alt="${anime.title}" class="w-12 h-16 object-cover rounded mr-3" onerror="this.src='https://via.placeholder.com/96x128?text=No+Image'">
                                        <div>
                                            <div class="font-medium text-white">${anime.title}</div>
                                            <div class="flex items-center text-xs text-gray-400 mt-1">
                                                <span class="mr-2">${anime.episodeCount} episodes</span>
                                                <span class="px-2 py-0.5 rounded-full ${getStatusBadgeClass(anime.status)}">${anime.status}</span>
                                            </div>
                                        </div>
                                    </div>
                                `;
                                searchResultsContainer.appendChild(resultItem);
                                
                                resultItem.addEventListener('click', function() {
                                    displaySelectedAnime(anime);
                                    searchResultsContainer.style.display = 'none';
                                    animeSearchInput.value = anime.title;
                                });
                            });
                        }
                        
                        searchResultsContainer.style.display = 'block';
                        hideLoading();
                    })
                    .catch(error => {
                        console.error('Error searching anime:', error);
                        searchResultsContainer.innerHTML = `
                            <div class="p-4 text-center text-red-400">
                                <i class="ph-warning-circle mb-2 text-xl"></i>
                                <p>Error searching. Please try again.</p>
                            </div>
                        `;
                        searchResultsContainer.style.display = 'block';
                        hideLoading();
                    });
            });
            
            // Hide search results when clicking outside
            document.addEventListener('click', function(e) {
                if (!animeSearchInput.contains(e.target) && !searchResultsContainer.contains(e.target)) {
                    searchResultsContainer.style.display = 'none';
                }
            });
            
            // Set up add anime button event
            document.getElementById('addSelectedAnime').addEventListener('click', function() {
                const animeId = this.getAttribute('data-anime-id');
                const hasTagalogDub = document.getElementById('hasTagalogDub').checked;
                
                if (!animeId) {
                    showError('No anime selected');
                    return;
                }
                
                showLoading();
                fetch(`${API_URL}/anime`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        anilistId: animeId,
                        hasTagalogDub: hasTagalogDub
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(error => Promise.reject(error));
                    }
                    return response.json();
                })
                .then(newAnime => {
                    showSuccess(`Successfully added "${newAnime.title}" to your library`);
                    
                    // Switch to episodes view to add episodes
                    showView('episodes-view');
                    activateNavLink(document.getElementById('episodes-link'));
                    
                    // Load anime for episodes and select the newly added one
                    loadAnimeForEpisodes(animeId);
                    
                    // Clear search
                    document.getElementById('animeSearch').value = '';
                    document.getElementById('selectedAnimeDetails').classList.add('hidden');
                    hideLoading();
                })
                .catch(error => {
                    console.error('Error adding anime:', error);
                    showError(error.error || 'Failed to add anime');
                    hideLoading();
                });
            });
        }
        
        // Helper function to get status badge class
        function getStatusBadgeClass(status) {
            status = status.toUpperCase();
            switch(status) {
                case 'FINISHED':
                case 'COMPLETED':
                    return 'bg-green-900/40 text-green-300';
                case 'RELEASING':
                case 'AIRING':
                    return 'bg-blue-900/40 text-blue-300';
                case 'NOT_YET_RELEASED':
                case 'UPCOMING':
                    return 'bg-amber-900/40 text-amber-300';
                case 'CANCELLED':
                    return 'bg-red-900/40 text-red-300';
                default:
                    return 'bg-dark-400 text-gray-300';
            }
        }
        
        // Display selected anime details
        function displaySelectedAnime(anime) {
            const detailsContainer = document.getElementById('selectedAnimeDetails');
            const thumbnailElement = document.getElementById('selectedAnimeThumbnail');
            const titleElement = document.getElementById('selectedAnimeTitle');
            const descriptionElement = document.getElementById('selectedAnimeDescription');
            const genresContainer = document.getElementById('selectedAnimeGenres');
            const episodesElement = document.getElementById('selectedAnimeEpisodes');
            const statusElement = document.getElementById('selectedAnimeStatus');
            const seasonElement = document.getElementById('selectedAnimeSeason');
            const ratingElement = document.getElementById('selectedAnimeRating');
            
            thumbnailElement.src = anime.thumbnail;
            thumbnailElement.onerror = function() {
                this.src = 'https://via.placeholder.com/350x500?text=No+Image';
            };
            
            titleElement.textContent = anime.title;
            descriptionElement.textContent = anime.description || 'No description available';
            
            genresContainer.innerHTML = '';
            anime.genres.forEach(genre => {
                const badge = document.createElement('span');
                badge.className = 'px-2 py-1 rounded text-xs font-medium bg-dark-500 text-gray-300';
                badge.textContent = genre;
                genresContainer.appendChild(badge);
            });
            
            episodesElement.textContent = anime.episodeCount || 'Unknown';
            
            statusElement.innerHTML = `<span class="px-2 py-1 rounded-full text-xs font-medium ${getStatusBadgeClass(anime.status)}">${anime.status || 'Unknown'}</span>`;
            
            seasonElement.textContent = anime.season ? `${anime.season} ${anime.startDate?.split('-')[0] || ''}` : 'Unknown';
            
            if (anime.rating) {
                const rating = parseFloat(anime.rating);
                ratingElement.innerHTML = `<div class="flex items-center">
                    ${rating.toFixed(1)} 
                    <i class="ph-star ml-1 text-amber-400"></i>
                </div>`;
            } else {
                ratingElement.textContent = 'N/A';
            }
            
            // Reset the Tagalog dub checkbox
            document.getElementById('hasTagalogDub').checked = false;
            
            // Show the details container
            detailsContainer.classList.remove('hidden');
            
            // Add anime ID to add button
            document.getElementById('addSelectedAnime').setAttribute('data-anime-id', anime.id);
        }
        
        // Initialize Episodes Management
        function initEpisodesManagement() {
            // Episode Anime Selection
            document.getElementById('episodeAnimeSelector').addEventListener('change', function() {
                const animeId = this.value;
                const episodeManagementArea = document.getElementById('episodeManagementArea');
                
                if (!animeId) {
                    episodeManagementArea.classList.add('hidden');
                    return;
                }
                
                showLoading();
                fetch(`${API_URL}/anime/${animeId}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to fetch anime details');
                        }
                        return response.json();
                    })
                    .then(anime => {
                        // Display anime details
                        const thumbnailElement = document.getElementById('episodeAnimeThumbnail');
                        thumbnailElement.src = anime.thumbnail;
                        thumbnailElement.onerror = function() {
                            this.src = 'https://via.placeholder.com/350x500?text=No+Image';
                        };
                        
                        document.getElementById('episodeAnimeTitle').textContent = anime.title;
                        document.getElementById('episodeAnimeEpisodeCount').textContent = `${anime.episodeCount} episodes`;
                        
                        // Update Tagalog dub status
                        updateTagalogDubStatus(anime);
                        
                        // Load episodes for this anime
                        return fetch(`${API_URL}/anime/${animeId}/episodes`)
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error('Failed to fetch episodes');
                                }
                                return response.json();
                            })
                            .then(episodes => {
                                displayEpisodes(episodes, anime);
                                
                                // Update episode count in UI
                                document.getElementById('episodes-count-display').textContent = 
                                    `${episodes.length} episode${episodes.length !== 1 ? 's' : ''}`;
                                    
                                episodeManagementArea.classList.remove('hidden');
                                hideLoading();
                            });
                    })
                    .catch(error => {
                        console.error('Error loading anime details:', error);
                        showError('Failed to load anime details: ' + error.message);
                        hideLoading();
                    });
            });
            
            // Toggle Tagalog Dub Status
            document.getElementById('toggleTagalogDub').addEventListener('click', function() {
                const animeId = document.getElementById('episodeAnimeSelector').value;
                
                if (!animeId) {
                    showError('No anime selected');
                    return;
                }
                
                // Fetch current anime details
                fetch(`${API_URL}/anime/${animeId}`)
                    .then(response => response.json())
                    .then(anime => {
                        // Set up the toggle modal
                        document.getElementById('dubStatusAnimeThumbnail').src = anime.thumbnail;
                        document.getElementById('dubStatusAnimeTitle').textContent = anime.title;
                        
                        // Show the modal
                        showModal('toggleTagalogDubModal');
                        
                        // Handle toggle buttons
                        const hasTagalogBtn = document.getElementById('setHasTagalogDubBtn');
                        const noTagalogBtn = document.getElementById('setNoTagalogDubBtn');
                        
                        // Highlight current status
                        if (anime.hasTagalogDub) {
                            hasTagalogBtn.classList.add('opacity-50', 'cursor-not-allowed');
                            noTagalogBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                        } else {
                            hasTagalogBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                            noTagalogBtn.classList.add('opacity-50', 'cursor-not-allowed');
                        }
                        
                        // Set up button event handlers
                        hasTagalogBtn.onclick = function() {
                            if (!anime.hasTagalogDub) {
                                updateAnimeTagalogStatus(animeId, true);
                            }
                        };
                        
                        noTagalogBtn.onclick = function() {
                            if (anime.hasTagalogDub) {
                                updateAnimeTagalogStatus(animeId, false);
                            }
                        };
                    })
                    .catch(error => {
                        showError('Failed to load anime details');
                        console.error(error);
                    });
            });
            
            // Add episode form submission
            document.getElementById('addEpisodeForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const animeId = document.getElementById('episodeAnimeSelector').value;
                const iframeSrc = document.getElementById('iframeSrc').value;
                const server2Url = document.getElementById('server2Url').value;
                const hasTagalogDub = document.getElementById('episodeHasTagalogDub').checked;
                
                if (!animeId) {
                    showError('Please select an anime');
                    return;
                }
                
                if (!server2Url) {
                    showError('Server 2 URL is required');
                    return;
                }
                
                const episodeData = {
                    animeId: animeId,
                    iframeSrc: iframeSrc || '',
                    server2Url: server2Url,
                    hasTagalogDub: hasTagalogDub
                };
                
                showLoading();
                fetch(`${API_URL}/episodes`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(episodeData)
                })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(error => Promise.reject(error));
                    }
                    return response.json();
                })
                .then(newEpisode => {
                    // Reset form
                    document.getElementById('addEpisodeForm').reset();
                    
                    // Show success message
                    showSuccess(`Episode ${newEpisode.number} added successfully`);
                    
                    // Reload anime details to update Tagalog status if needed
                    return fetch(`${API_URL}/anime/${animeId}`)
                        .then(response => response.json())
                        .then(anime => {
                            // Update Tagalog dub status
                            updateTagalogDubStatus(anime);
                            
                            // Reload episodes
                            return fetch(`${API_URL}/anime/${animeId}/episodes`)
                                .then(response => response.json())
                                .then(episodes => {
                                    displayEpisodes(episodes, anime);
                                    
                                    // Update episode count
                                    document.getElementById('episodes-count-display').textContent = 
                                        `${episodes.length} episode${episodes.length !== 1 ? 's' : ''}`;
                                    
                                    hideLoading();
                                });
                        });
                })
                .catch(error => {
                    console.error('Error adding episode:', error);
                    showError(error.error || 'Failed to add episode');
                    hideLoading();
                });
            });
            
            // Bulk episode uploader functionality
            document.getElementById('parseBulkEpisodesBtn').addEventListener('click', function() {
                const bulkHtml = document.getElementById('bulkEpisodeHtml').value;
                const server1Default = document.getElementById('server1DefaultValue').value;
                const bulkHasTagalogDub = document.getElementById('bulkHasTagalogDub').checked;
                
                if (!bulkHtml.trim()) {
                    showError('Please paste the HTML with episode options');
                    return;
                }
                
            // Create a temporary container to parse the HTML
                const tempContainer = document.createElement('div');
                tempContainer.innerHTML = bulkHtml;
                
                // Find the select element
                const selectElement = tempContainer.querySelector('select');
                
                if (!selectElement) {
                    showError('Could not find a select element in the provided HTML');
                    return;
                }
                
                // Get all option elements
                const options = selectElement.querySelectorAll('option');
                
                if (options.length === 0) {
                    showError('No episode options found in the select element');
                    return;
                }
                
                // Parse the episodes
                const parsedEpisodes = Array.from(options).map(option => {
                    return {
                        number: parseInt(option.value, 10),
                        title: option.textContent.trim() || `Episode ${option.value}`,
                        iframeSrc: option.getAttribute('data-server1') || server1Default || "",
                        server2Url: option.getAttribute('data-server2') || "",
                        hasTagalogDub: bulkHasTagalogDub
                    };
                });
                
                // Update the episode count badge
                document.getElementById('episodeCount').textContent = parsedEpisodes.length;
                
                // Enable the upload button
                document.getElementById('uploadBulkEpisodesBtn').disabled = false;
                
                // Store parsed episodes in a global variable for later use
                window.parsedEpisodes = parsedEpisodes;
                
                // Show a success message
                showSuccess(`Successfully parsed ${parsedEpisodes.length} episodes`);
            });
            
            // Upload bulk episodes button
            document.getElementById('uploadBulkEpisodesBtn').addEventListener('click', function() {
                if (!window.parsedEpisodes || window.parsedEpisodes.length === 0) {
                    showError('No episodes to upload. Parse HTML first.');
                    return;
                }
                
                // Show preview modal
                showBulkEpisodePreview(window.parsedEpisodes);
            });
            
            // Bulk upload confirmation
            document.getElementById('confirmBulkUploadBtn').addEventListener('click', function() {
                const animeId = document.getElementById('episodeAnimeSelector').value;
                const replaceExisting = document.getElementById('replaceExisting').checked;
                
                if (!animeId) {
                    showError('Please select an anime first');
                    return;
                }
                
                // Close the modal
                document.getElementById('bulkUploadPreviewModal').classList.add('hidden');
                
                // Process the bulk upload
                processBulkUpload(animeId, window.parsedEpisodes, replaceExisting);
            });
            
            // Save edited episode
            document.getElementById('saveEditEpisodeBtn').addEventListener('click', function() {
                const episodeId = document.getElementById('editEpisodeId').value;
                const iframeSrc = document.getElementById('editIframeSrc').value;
                const server2Url = document.getElementById('editServer2Url').value;
                const hasTagalogDub = document.getElementById('editEpisodeHasTagalogDub').checked;
                
                if (!server2Url) {
                    showError('Server 2 URL is required');
                    return;
                }
                
                const episodeData = {
                    iframeSrc: iframeSrc || '',
                    server2Url: server2Url,
                    hasTagalogDub: hasTagalogDub
                };
                
                showLoading();
                fetch(`${API_URL}/episodes/${episodeId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(episodeData)
                })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(error => Promise.reject(error));
                    }
                    return response.json();
                })
                .then(updatedEpisode => {
                    // Close modal
                    document.getElementById('editEpisodeModal').classList.add('hidden');
                    
                    // Show success message
                    showSuccess(`Episode ${updatedEpisode.number} updated successfully`);
                    
                    // Reload episodes
                    const animeId = document.getElementById('episodeAnimeSelector').value;
                    return fetch(`${API_URL}/anime/${animeId}`)
                        .then(response => response.json())
                        .then(anime => {
                            // Update Tagalog dub status
                            updateTagalogDubStatus(anime);
                            
                            // Load episodes
                            fetch(`${API_URL}/anime/${animeId}/episodes`)
                                .then(response => response.json())
                                .then(episodes => {
                                    displayEpisodes(episodes, anime);
                                    hideLoading();
                                });
                        });
                })
                .catch(error => {
                    console.error('Error updating episode:', error);
                    showError(error.error || 'Failed to update episode');
                    hideLoading();
                });
            });
            
            // Delete episode
            document.getElementById('confirmDeleteEpisodeBtn').addEventListener('click', function() {
                const episodeId = this.getAttribute('data-episode-id');
                
                showLoading();
                fetch(`${API_URL}/episodes/${episodeId}`, {
                    method: 'DELETE'
                })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(error => Promise.reject(error));
                    }
                    return response.json();
                })
                .then(result => {
                    // Close modal
                    document.getElementById('deleteEpisodeModal').classList.add('hidden');
                    
                    // Show success message
                    showSuccess('Episode deleted successfully');
                    
                    // Reload episodes
                    const animeId = document.getElementById('episodeAnimeSelector').value;
                    return fetch(`${API_URL}/anime/${animeId}`)
                        .then(response => response.json())
                        .then(anime => {
                            // Update Tagalog dub status - might change if we deleted the only episode with Tagalog dub
                            updateTagalogDubStatus(anime);
                            
                            // Load episodes
                            fetch(`${API_URL}/anime/${animeId}/episodes`)
                                .then(response => response.json())
                                .then(episodes => {
                                    displayEpisodes(episodes, anime);
                                    
                                    // Update episode count
                                    document.getElementById('episodes-count-display').textContent = 
                                        `${episodes.length} episode${episodes.length !== 1 ? 's' : ''}`;
                                    
                                    hideLoading();
                                });
                        });
                })
                .catch(error => {
                    console.error('Error deleting episode:', error);
                    showError(error.error || 'Failed to delete episode');
                    hideLoading();
                });
            });
        }
        
        // Update anime's Tagalog dub status
        function updateAnimeTagalogStatus(animeId, hasTagalogDub) {
            showLoading();
            
            fetch(`${API_URL}/anime/${animeId}/tagalog`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ hasTagalogDub: hasTagalogDub })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to update Tagalog dub status');
                }
                return response.json();
            })
            .then(() => {
                // Close the modal
                document.getElementById('toggleTagalogDubModal').classList.add('hidden');
                
                // Show success message
                showSuccess(`Tagalog dub status updated to: ${hasTagalogDub ? 'Available' : 'Not Available'}`);
                
                // Refresh anime details
                return fetch(`${API_URL}/anime/${animeId}`)
                    .then(response => response.json())
                    .then(anime => {
                        updateTagalogDubStatus(anime);
                        hideLoading();
                    });
            })
            .catch(error => {
                showError('Failed to update Tagalog dub status');
                console.error(error);
                hideLoading();
            });
        }
        
        // Update Tagalog dub status UI
        function updateTagalogDubStatus(anime) {
            const statusBadge = document.getElementById('tagalogStatusBadge');
            
            if (anime.hasTagalogDub) {
                statusBadge.className = 'px-2.5 py-1 rounded-full text-xs font-medium bg-secondary-900/60 text-secondary-300 flex items-center gap-1';
                statusBadge.innerHTML = '<i class="ph-translate"></i> Tagalog Dub Available';
            } else {
                statusBadge.className = 'px-2.5 py-1 rounded-full text-xs font-medium bg-dark-400 text-gray-300 flex items-center gap-1';
                statusBadge.innerHTML = '<i class="ph-x"></i> No Tagalog Dub';
            }
        }
        
        // Show bulk episode preview
        function showBulkEpisodePreview(episodes) {
            const previewTable = document.getElementById('bulkEpisodePreviewTable');
            previewTable.innerHTML = '';
            
            // Sort episodes by number
            episodes.sort((a, b) => a.number - b.number);
            
            // Populate the preview table
            episodes.forEach(episode => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-white">${episode.number}</td>
                    <td class="px-4 py-3 text-sm text-white">${episode.title}</td>
                    <td class="px-4 py-3 text-sm text-gray-400 max-w-xs truncate">${episode.iframeSrc || '<em class="text-gray-500">None</em>'}</td>
                    <td class="px-4 py-3 text-sm text-gray-400 max-w-xs truncate">${episode.server2Url || '<em class="text-gray-500">None</em>'}</td>
                    <td class="px-4 py-3 text-sm text-center">
                        ${episode.hasTagalogDub ? 
                            '<span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-secondary-900/60 text-secondary-300"><i class="ph-check mr-1"></i> Yes</span>' : 
                            '<span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-dark-400 text-gray-300"><i class="ph-x mr-1"></i> No</span>'}
                    </td>
                `;
                previewTable.appendChild(row);
            });
            
            // Show the modal
            showModal('bulkUploadPreviewModal');
        }
        
        // Process bulk episode upload
        function processBulkUpload(animeId, episodes, replaceExisting) {
            showLoading();
            
            // If replacing existing episodes, delete them first
            const uploadEpisodes = () => {
                // Update the loading message
                document.querySelector('#loadingSpinner').innerHTML = `
                    <div class="flex flex-col items-center text-white">
                        <div class="w-16 h-16 border-4 border-t-primary-500 border-white/20 rounded-full animate-spin mb-4"></div>
                        <p class="text-lg font-medium mb-2">Uploading Episodes</p>
                        <div class="w-64 bg-dark-300 rounded-full h-2.5 mb-2">
                            <div class="bg-primary-500 h-2.5 rounded-full" style="width: 0%" id="uploadProgressBar"></div>
                        </div>
                        <p class="text-sm" id="uploadProgressText">0/${episodes.length} episodes</p>
                    </div>
                `;
                
                // Upload episodes sequentially with a small delay to prevent overwhelming the server
                let uploaded = 0;
                let failed = 0;
                
                const uploadNextEpisode = (index) => {
                    if (index >= episodes.length) {
                        // All done
                        hideLoading();
                        showSuccess(`Upload complete: ${uploaded} episodes uploaded, ${failed} failed`);
                        
                        // Reload episodes and anime
                        fetch(`${API_URL}/anime/${animeId}`)
                            .then(response => response.json())
                            .then(anime => {
                                // Update Tagalog dub status
                                updateTagalogDubStatus(anime);
                                
                                // Load episodes
                                fetch(`${API_URL}/anime/${animeId}/episodes`)
                                    .then(response => response.json())
                                    .then(freshEpisodes => {
                                        displayEpisodes(freshEpisodes, anime);
                                        
                                        // Update episode count
                                        document.getElementById('episodes-count-display').textContent = 
                                            `${freshEpisodes.length} episode${freshEpisodes.length !== 1 ? 's' : ''}`;
                                    });
                            });
                        return;
                    }
                    
                    const episode = episodes[index];
                    const episodeData = {
                        animeId: animeId,
                        number: episode.number,
                        title: episode.title,
                        iframeSrc: episode.iframeSrc || '',
                        server2Url: episode.server2Url || '',
                        hasTagalogDub: episode.hasTagalogDub
                    };
                    
                    fetch(`${API_URL}/episodes`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(episodeData)
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Episode ${episode.number} failed to upload`);
                        }
                        return response.json();
                    })
                    .then(() => {
                        uploaded++;
                        
                        // Update progress
                        const progress = ((uploaded + failed) / episodes.length) * 100;
                        document.getElementById('uploadProgressBar').style.width = `${progress}%`;
                        document.getElementById('uploadProgressText').textContent = 
                            `${uploaded + failed}/${episodes.length} episodes (${uploaded} uploaded, ${failed} failed)`;
                        
                        // Process next episode after a small delay
                        setTimeout(() => uploadNextEpisode(index + 1), 100);
                    })
                    .catch(error => {
                        console.error('Error uploading episode:', error);
                        failed++;
                        
                        // Update progress
                        const progress = ((uploaded + failed) / episodes.length) * 100;
                        document.getElementById('uploadProgressBar').style.width = `${progress}%`;
                        document.getElementById('uploadProgressText').textContent = 
                            `${uploaded + failed}/${episodes.length} episodes (${uploaded} uploaded, ${failed} failed)`;
                        
                        // Continue with next episode
                        setTimeout(() => uploadNextEpisode(index + 1), 100);
                    });
                };
                
                // Start uploading from first episode
                uploadNextEpisode(0);
            };
            
            if (replaceExisting) {
                // Update loading message for delete operation
                document.querySelector('#loadingSpinner').innerHTML = `
                    <div class="flex flex-col items-center text-white">
                        <div class="w-16 h-16 border-4 border-t-primary-500 border-white/20 rounded-full animate-spin mb-4"></div>
                        <p class="text-lg font-medium">Removing existing episodes...</p>
                    </div>
                `;
                
                // First, get all existing episodes
                fetch(`${API_URL}/anime/${animeId}/episodes`)
                    .then(response => response.json())
                    .then(existingEpisodes => {
                        if (existingEpisodes.length === 0) {
                            // No episodes to delete, proceed to upload
                            uploadEpisodes();
                            return;
                        }
                        
                        // Setup for batch deletion progress
                        document.querySelector('#loadingSpinner').innerHTML = `
                            <div class="flex flex-col items-center text-white">
                                <div class="w-16 h-16 border-4 border-t-primary-500 border-white/20 rounded-full animate-spin mb-4"></div>
                                <p class="text-lg font-medium mb-2">Removing Existing Episodes</p>
                                <div class="w-64 bg-dark-300 rounded-full h-2.5 mb-2">
                                    <div class="bg-red-500 h-2.5 rounded-full" style="width: 0%" id="deleteProgressBar"></div>
                                </div>
                                <p class="text-sm">0/${existingEpisodes.length} episodes</p>
                            </div>
                        `;
                        
                        // Delete episodes in parallel with batching
                        const batchSize = 5; // Process 5 at a time
                        let processed = 0;
                        
                        const deleteBatch = (startIndex) => {
                            const endIndex = Math.min(startIndex + batchSize, existingEpisodes.length);
                            const batch = existingEpisodes.slice(startIndex, endIndex);
                            
                            const deletePromises = batch.map(episode => 
                                fetch(`${API_URL}/episodes/${episode.id}`, { method: 'DELETE' })
                                    .catch(error => console.error(`Error deleting episode ${episode.id}:`, error))
                            );
                            
                            Promise.all(deletePromises)
                                .then(() => {
                                    processed += batch.length;
                                    
                                    // Update progress
                                    const progress = (processed / existingEpisodes.length) * 100;
                                    document.getElementById('deleteProgressBar').style.width = `${progress}%`;
                                    document.querySelector('#loadingSpinner p.text-sm').textContent = 
                                        `${processed}/${existingEpisodes.length} episodes`;
                                    
                                    if (processed < existingEpisodes.length) {
                                        // Process next batch
                                        setTimeout(() => deleteBatch(endIndex), 200);
                                    } else {
                                        // All deleted, now upload new ones
                                        uploadEpisodes();
                                    }
                                });
                        };
                        
                        // Start deleting from first batch
                        deleteBatch(0);
                    })
                    .catch(error => {
                        console.error('Error fetching episodes for deletion:', error);
                        showError('Failed to fetch existing episodes');
                        hideLoading();
                    });
            } else {
                // Just upload new episodes without deleting
                uploadEpisodes();
            }
        }
        
        // Load anime list for episodes view
        function loadAnimeForEpisodes(selectedAnimeId = null) {
            showLoading();
            fetch(`${API_URL}/anime`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch anime list');
                    }
                    return response.json();
                })
                .then(animeList => {
                    const animeSelector = document.getElementById('episodeAnimeSelector');
                    animeSelector.innerHTML = '<option value="">Choose an anime...</option>';
                    
                    // Sort anime alphabetically
                    animeList.sort((a, b) => a.title.localeCompare(b.title));
                    
                    animeList.forEach(anime => {
                        const option = document.createElement('option');
                        option.value = anime.id;
                        option.textContent = anime.title;
                        
                        if (selectedAnimeId && anime.id === selectedAnimeId) {
                            option.selected = true;
                        }
                        
                        animeSelector.appendChild(option);
                    });
                    
                    if (selectedAnimeId) {
                        // Trigger change event to load episodes
                        const event = new Event('change');
                        animeSelector.dispatchEvent(event);
                    } else {
                        hideLoading();
                    }
                })
                .catch(error => {
                    console.error('Error loading anime for episodes:', error);
                    showError('Failed to load anime list: ' + error.message);
                    hideLoading();
                });
        }
        
        // Display episodes list
        function displayEpisodes(episodes, anime) {
            const episodesContainer = document.getElementById('episodesList');
            episodesContainer.innerHTML = '';
            
            if (episodes.length === 0) {
                episodesContainer.innerHTML = `
                    <div class="text-center py-10">
                        <i class="ph-video text-dark-400 text-5xl mb-3"></i>
                        <p class="text-gray-400 mb-4">No episodes added yet.</p>
                        <p class="text-gray-400">Add your first episode using the form!</p>
                    </div>
                `;
                return;
            }
            
            // Sort episodes by number
            episodes.sort((a, b) => a.number - b.number);
            
            // Create grid for episodes
            const grid = document.createElement('div');
            grid.className = 'grid gap-3';
            episodesContainer.appendChild(grid);
            
            episodes.forEach(episode => {
                const dateAdded = new Date(episode.dateAdded);
                const formattedDate = dateAdded.toLocaleDateString(undefined, {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
                
                const episodeItem = document.createElement('div');
                episodeItem.className = 'bg-dark-700 rounded-lg p-4 hover:bg-dark-600 transition-colors';
                episodeItem.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="flex items-center">
                                <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-primary-900/60 text-primary-300 font-medium mr-3">${episode.number}</span>
                                <span class="font-medium text-white">${episode.title || 'Episode ' + episode.number}</span>
                                ${episode.hasTagalogDub ? `
                                <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-secondary-900/60 text-secondary-300">
                                    <i class="ph-translate mr-1"></i> Tagalog
                                </span>` : ''}
                            </div>
                            <div class="text-sm text-gray-400 mt-2">Added: ${formattedDate}</div>
                        </div>
                        <div class="flex gap-1">
                            <button class="p-2 text-gray-400 hover:text-primary-400 hover:bg-dark-500 rounded transition-colors edit-episode-btn" data-episode-id="${episode.id}">
                                <i class="ph-pencil"></i>
                            </button>
                            <button class="p-2 text-gray-400 hover:text-red-400 hover:bg-dark-500 rounded transition-colors delete-episode-btn" 
                                data-episode-id="${episode.id}" 
                                data-episode-number="${episode.number}" 
                                data-episode-title="${episode.title || 'Episode ' + episode.number}">
                                <i class="ph-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="mt-3 text-sm text-gray-400 grid gap-1">
                        ${episode.iframeSrc ? `
                        <div class="flex items-center">
                            <span class="inline-flex items-center justify-center w-6 h-6 rounded bg-blue-900/40 text-blue-300 mr-2">
                                <i class="ph-code text-xs"></i>
                            </span>
                            <span class="truncate">${episode.iframeSrc}</span>
                        </div>` : ''}
                        ${episode.server2Url ? `
                        <div class="flex items-center">
                            <span class="inline-flex items-center justify-center w-6 h-6 rounded bg-green-900/40 text-green-300 mr-2">
                                <i class="ph-link text-xs"></i>
                            </span>
                            <span class="truncate">${episode.server2Url}</span>
                        </div>` : ''}
                    </div>
                `;
                grid.appendChild(episodeItem);
            });
            
            // Add event listeners to edit buttons
            document.querySelectorAll('.edit-episode-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const episodeId = this.getAttribute('data-episode-id');
                    openEditEpisodeModal(episodeId);
                });
            });
            
            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-episode-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const episodeId = this.getAttribute('data-episode-id');
                    const episodeNumber = this.getAttribute('data-episode-number');
                    const episodeTitle = this.getAttribute('data-episode-title');
                    
                    // Set modal info
                    document.getElementById('deleteEpisodeInfo').textContent = 
                        `${anime.title} - Episode ${episodeNumber}: ${episodeTitle}`;
                    
                    // Set delete button data
                    document.getElementById('confirmDeleteEpisodeBtn').setAttribute('data-episode-id', episodeId);
                    
                    // Show modal
                    showModal('deleteEpisodeModal');
                });
            });
        }
        
        // Open edit episode modal
        function openEditEpisodeModal(episodeId) {
            showLoading();
            fetch(`${API_URL}/episodes/${episodeId}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch episode details');
                    }
                    return response.json();
                })
                .then(episode => {
                    // Populate form
                    document.getElementById('editEpisodeId').value = episode.id;
                    document.getElementById('editIframeSrc').value = episode.iframeSrc || '';
                    document.getElementById('editServer2Url').value = episode.server2Url || '';
                    document.getElementById('editEpisodeHasTagalogDub').checked = episode.hasTagalogDub === true;
                    
                    // Update modal title
                    document.getElementById('editEpisodeModalTitle').textContent = 
                        `Edit Episode ${episode.number}: ${episode.title || 'Untitled'}`;
                    
                    // Show modal
                    showModal('editEpisodeModal');
                    
                    hideLoading();
                })
                .catch(error => {
                    console.error('Error fetching episode details:', error);
                    showError('Failed to load episode details: ' + error.message);
                    hideLoading();
                });
        }
        
        // Initialize Schedule Feature
        function initScheduleFeature() {
            // Add scheduled anime button
            document.getElementById('add-scheduled-btn').addEventListener('click', function() {
                showModal('addScheduleModal');
                
                // Set default release date to tomorrow
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                tomorrow.setHours(12, 0, 0, 0);
                
                const formattedDate = tomorrow.toISOString().slice(0, 16);
                document.getElementById('scheduleReleaseDate').value = formattedDate;
            });
            
            // Schedule anime search
            const scheduleSearchInput = document.getElementById('scheduleAnimeSearch');
            const scheduleSearchResults = document.getElementById('scheduleSearchResults');
            
            scheduleSearchInput.addEventListener('input', function() {
                const searchTerm = this.value.trim();
                
                if (searchTerm.length < 3) {
                    scheduleSearchResults.style.display = 'none';
                    return;
                }
                
                showLoading();
                fetch(`${API_URL}/search?query=${encodeURIComponent(searchTerm)}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Search failed');
                        }
                        return response.json();
                    })
                    .then(results => {
                        scheduleSearchResults.innerHTML = '';
                        
                        if (results.length === 0) {
                            scheduleSearchResults.innerHTML = `
                                <div class="p-4 text-center text-gray-400">
                                    <i class="ph-magnifying-glass mb-2 text-xl"></i>
                                    <p>No results found for "${searchTerm}"</p>
                                </div>
                            `;
                        } else {
                            results.forEach(anime => {
                                const resultItem = document.createElement('div');
                                resultItem.className = 'p-3 hover:bg-dark-500 cursor-pointer border-b border-dark-500 last:border-b-0';
                                resultItem.setAttribute('data-anime-id', anime.id);
                                resultItem.setAttribute('data-anime-title', anime.title);
                                resultItem.setAttribute('data-anime-thumbnail', anime.thumbnail);
                                resultItem.setAttribute('data-anime-episodes', anime.episodeCount);
                                
                                resultItem.innerHTML = `
                                    <div class="flex items-center">
                                        <img src="${anime.thumbnail}" alt="${anime.title}" class="w-12 h-16 object-cover rounded mr-3" onerror="this.src='https://via.placeholder.com/96x128?text=No+Image'">
                                        <div>
                                            <div class="font-medium text-white">${anime.title}</div>
                                            <div class="flex items-center text-xs text-gray-400 mt-1">
                                                <span class="mr-2">${anime.episodeCount} episodes</span>
                                                <span class="px-2 py-0.5 rounded-full ${getStatusBadgeClass(anime.status)}">${anime.status}</span>
                                            </div>
                                        </div>
                                    </div>
                                `;
                                scheduleSearchResults.appendChild(resultItem);
                                
                                resultItem.addEventListener('click', function() {
                                    const animeId = this.getAttribute('data-anime-id');
                                    const animeTitle = this.getAttribute('data-anime-title');
                                    const animeThumbnail = this.getAttribute('data-anime-thumbnail');
                                    const animeEpisodes = this.getAttribute('data-anime-episodes');
                                    
                                    // Show selected anime
                                    document.getElementById('selectedScheduleAnime').classList.remove('hidden');
                                    document.getElementById('scheduleAnimeThumbnail').src = animeThumbnail;
                                    document.getElementById('scheduleAnimeTitle').textContent = animeTitle;
                                    document.getElementById('scheduleAnimeInfo').textContent = `${animeEpisodes} episodes`;
                                    
                                    // Store anime ID for submission
                                    document.getElementById('saveScheduleBtn').setAttribute('data-anime-id', animeId);
                                    
                                    // Clear search
                                    scheduleSearchInput.value = '';
                                    scheduleSearchResults.style.display = 'none';
                                });
                            });
                        }
                        
                        scheduleSearchResults.style.display = 'block';
                        hideLoading();
                    })
                    .catch(error => {
                        console.error('Error searching anime:', error);
                        scheduleSearchResults.innerHTML = `
                            <div class="p-4 text-center text-red-400">
                                <i class="ph-warning-circle mb-2 text-xl"></i>
                                <p>Error searching. Please try again.</p>
                            </div>
                        `;
                        scheduleSearchResults.style.display = 'block';
                        hideLoading();
                    });
            });
            
            // Hide schedule search results when clicking outside
            document.addEventListener('click', function(e) {
                if (!scheduleSearchInput?.contains(e.target) && !scheduleSearchResults?.contains(e.target)) {
                    scheduleSearchResults.style.display = 'none';
                }
            });
            
            // Save new scheduled anime
            document.getElementById('saveScheduleBtn').addEventListener('click', function() {
                const animeId = this.getAttribute('data-anime-id');
                const releaseDate = document.getElementById('scheduleReleaseDate').value;
                const notes = document.getElementById('scheduleNotes').value;
                const hasTagalogDub = document.getElementById('scheduleHasTagalogDub').checked;
                
                if (!animeId) {
                    showError('Please select an anime');
                    return;
                }
                
                if (!releaseDate) {
                    showError('Please select a release date');
                    return;
                }
                
                const scheduleData = {
                    anilistId: animeId,
                    releaseDate: releaseDate,
                    notes: notes,
                    hasTagalogDub: hasTagalogDub
                };
                
                showLoading();
                fetch(`${API_URL}/scheduled`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(scheduleData)
                })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(error => Promise.reject(error));
                    }
                    return response.json();
                })
                .then(newSchedule => {
                    // Close modal and reset form
                    document.getElementById('addScheduleModal').classList.add('hidden');
                    document.getElementById('selectedScheduleAnime').classList.add('hidden');
                    document.getElementById('addScheduleForm').reset();
                    
                    // Show success message
                    showSuccess(`"${newSchedule.title}" scheduled successfully`);
                    
                    // Reload scheduled anime list
                    loadScheduledAnime();
                    
                    hideLoading();
                })
                .catch(error => {
                    console.error('Error scheduling anime:', error);
                    showError(error.error || 'Failed to schedule anime');
                    hideLoading();
                });
            });
            
            // Schedule view filter
            document.getElementById('scheduleFilter').addEventListener('change', function() {
                applyScheduleFilter();
            });
            
            // Update scheduled anime
            document.getElementById('updateScheduleBtn').addEventListener('click', function() {
                const scheduleId = document.getElementById('editScheduleId').value;
                const releaseDate = document.getElementById('editScheduleReleaseDate').value;
                const notes = document.getElementById('editScheduleNotes').value;
                const hasTagalogDub = document.getElementById('editScheduleHasTagalogDub').checked;
                
                if (!releaseDate) {
                    showError('Please select a release date');
                    return;
                }
                
                const scheduleData = {
                    releaseDate: releaseDate,
                    notes: notes,
                    hasTagalogDub: hasTagalogDub
                };
                
                showLoading();
                fetch(`${API_URL}/scheduled/${scheduleId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(scheduleData)
                })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(error => Promise.reject(error));
                    }
                    return response.json();
                })
                .then(updatedSchedule => {
                    // Close modal
                    document.getElementById('editScheduleModal').classList.add('hidden');
                    
                    // Show success message
                    showSuccess(`Schedule updated successfully`);
                    
                    // Reload scheduled anime list
                    loadScheduledAnime();
                    
                    hideLoading();
                })
                .catch(error => {
                    console.error('Error updating schedule:', error);
                    showError(error.error || 'Failed to update schedule');
                    hideLoading();
                });
            });
            
            // Delete scheduled anime
            document.getElementById('deleteScheduleBtn').addEventListener('click', function() {
                const scheduleId = document.getElementById('editScheduleId').value;
                
                showLoading();
                fetch(`${API_URL}/scheduled/${scheduleId}`, {
                    method: 'DELETE'
                })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(error => Promise.reject(error));
                    }
                    return response.json();
                })
                .then(result => {
                    // Close modal
                    document.getElementById('editScheduleModal').classList.add('hidden');
                    
                    // Show success message
                    showSuccess('Schedule deleted successfully');
                    
                    // Reload scheduled anime list
                    loadScheduledAnime();
                    
                    hideLoading();
                })
                .catch(error => {
                    console.error('Error deleting schedule:', error);
                    showError(error.error || 'Failed to delete schedule');
                    hideLoading();
                });
            });
        }
        
        // Load scheduled anime list
        function loadScheduledAnime() {
            showLoading();
            
            fetch(`${API_URL}/scheduled`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch scheduled anime');
                    }
                    return response.json();
                })
                .then(scheduleList => {
                    const scheduleContainer = document.getElementById('scheduledList');
                    scheduleContainer.innerHTML = '';
                    
                    if (scheduleList.length === 0) {
                        scheduleContainer.innerHTML = `
                            <div class="text-center py-10">
                                <i class="ph-calendar-x text-dark-400 text-5xl mb-3"></i>
                                <p class="text-gray-400 mb-4">No scheduled releases found</p>
                                <button class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors shadow-dark" id="no-schedule-add-btn">
                                    <i class="ph-plus mr-1"></i> Schedule Release
                                </button>
                            </div>
                        `;
                        
                        document.getElementById('no-schedule-add-btn').addEventListener('click', function() {
                            showModal('addScheduleModal');
                            
                            // Set default release date to tomorrow
                            const tomorrow = new Date();
                            tomorrow.setDate(tomorrow.getDate() + 1);
                            tomorrow.setHours(12, 0, 0, 0);
                            
                            const formattedDate = tomorrow.toISOString().slice(0, 16);
                            document.getElementById('scheduleReleaseDate').value = formattedDate;
                        });
                    } else {
                        // Sort by release date (ascending)
                        scheduleList.sort((a, b) => new Date(a.releaseDate) - new Date(b.releaseDate));
                        
                        // Apply filter initially
                        const currentFilter = document.getElementById('scheduleFilter').value;
                        const now = new Date();
                        
                        let filteredItems = scheduleList;
                        if (currentFilter === 'upcoming') {
                            filteredItems = scheduleList.filter(item => new Date(item.releaseDate) > now);
                        } else if (currentFilter === 'past') {
                            filteredItems = scheduleList.filter(item => new Date(item.releaseDate) <= now);
                        } else if (currentFilter === 'tagalog') {
                            filteredItems = scheduleList.filter(item => item.hasTagalogDub === true);
                        }
                        
                        if (filteredItems.length === 0) {
                            scheduleContainer.innerHTML = `
                                <div class="text-center py-10">
                                    <i class="ph-magnifying-glass text-dark-400 text-5xl mb-3"></i>
                                    <p class="text-gray-400">No scheduled releases match your filter</p>
                                </div>
                            `;
                        } else {
                            filteredItems.forEach(schedule => {
                                const itemElement = createScheduleItem(schedule);
                                scheduleContainer.appendChild(itemElement);
                            });
                        }
                    }
                    
                    hideLoading();
                })
                .catch(error => {
                    console.error('Error loading scheduled anime:', error);
                    showError('Failed to load scheduled anime: ' + error.message);
                    hideLoading();
                });
        }
        
        // Apply filter to scheduled anime list
        function applyScheduleFilter() {
            showLoading();
            
            fetch(`${API_URL}/scheduled`)
                .then(response => response.json())
                .then(scheduleList => {
                    const scheduleContainer = document.getElementById('scheduledList');
                    scheduleContainer.innerHTML = '';
                    
                    const currentFilter = document.getElementById('scheduleFilter').value;
                    const now = new Date();
                    
                    let filteredItems = scheduleList;
                    if (currentFilter === 'upcoming') {
                        filteredItems = scheduleList.filter(item => new Date(item.releaseDate) > now);
                    } else if (currentFilter === 'past') {
                        filteredItems = scheduleList.filter(item => new Date(item.releaseDate) <= now);
                    } else if (currentFilter === 'tagalog') {
                        filteredItems = scheduleList.filter(item => item.hasTagalogDub === true);
                    }
                    
                    // Sort by release date (ascending)
                    filteredItems.sort((a, b) => new Date(a.releaseDate) - new Date(b.releaseDate));
                    
                    if (filteredItems.length === 0) {
                        scheduleContainer.innerHTML = `
                            <div class="text-center py-10">
                                <i class="ph-magnifying-glass text-dark-400 text-5xl mb-3"></i>
                                <p class="text-gray-400">No scheduled releases match your filter</p>
                            </div>
                        `;
                    } else {
                        filteredItems.forEach(schedule => {
                            const itemElement = createScheduleItem(schedule);
                            scheduleContainer.appendChild(itemElement);
                        });
                    }
                    
                    hideLoading();
                })
                .catch(error => {
                    console.error('Error applying filter:', error);
                    showError('Failed to apply filter');
                    hideLoading();
                });
        }
        
        // Create a schedule item element
        function createScheduleItem(schedule) {
            const releaseDate = new Date(schedule.releaseDate);
            const now = new Date();
            
            // Format date
            const formattedDate = releaseDate.toLocaleDateString(undefined, {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // Format time
            const formattedTime = releaseDate.toLocaleTimeString(undefined, {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // Calculate status
            let statusClass, statusText, statusIcon;
            if (releaseDate > now) {
                const daysUntil = Math.ceil((releaseDate - now) / (1000 * 60 * 60 * 24));
                if (daysUntil <= 1) {
                    statusClass = 'bg-amber-900/40 text-amber-300';
                    statusText = daysUntil === 0 ? 'Today' : 'Tomorrow';
                    statusIcon = 'ph-clock';
                } else {
                    statusClass = 'bg-blue-900/40 text-blue-300';
                    statusText = `In ${daysUntil} days`;
                    statusIcon = 'ph-calendar';
                }
            } else {
                statusClass = 'bg-green-900/40 text-green-300';
                statusText = 'Released';
                statusIcon = 'ph-check-circle';
            }
            
            const itemElement = document.createElement('div');
            itemElement.className = 'px-6 py-4 hover:bg-dark-600 transition-colors';
            itemElement.setAttribute('data-schedule-id', schedule.id);
            
            itemElement.innerHTML = `
                <div class="flex flex-col md:flex-row md:items-center gap-4">
                    <div class="flex items-center flex-grow gap-4">
                        <img src="${schedule.thumbnail}" alt="${schedule.title}" class="w-16 h-20 object-cover rounded-md shadow-dark">
                        <div class="flex-grow">
                            <h3 class="font-medium text-white">${schedule.title}</h3>
                            <div class="flex flex-wrap items-center text-sm text-gray-400 mt-1 gap-2">
                                <div class="inline-flex items-center">
                                    <i class="ph-calendar mr-1"></i> ${formattedDate}
                                </div>
                                <div class="inline-flex items-center">
                                    <i class="ph-clock mr-1"></i> ${formattedTime}
                                </div>
                                ${schedule.hasTagalogDub ? `
                                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-secondary-900/60 text-secondary-300">
                                    <i class="ph-translate mr-1"></i> Tagalog
                                </span>` : ''}
                            </div>
                            ${schedule.notes ? `<p class="text-sm text-gray-300 mt-1">${schedule.notes}</p>` : ''}
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium ${statusClass}">
                            <i class="${statusIcon} mr-1"></i> ${statusText}
                        </span>
                        <button class="p-2 text-gray-400 hover:text-primary-400 hover:bg-dark-500 rounded transition-colors edit-schedule-btn" data-schedule-id="${schedule.id}">
                            <i class="ph-pencil"></i>
                        </button>
                    </div>
                </div>
            `;
            
            // Add event listener to edit button
            itemElement.querySelector('.edit-schedule-btn').addEventListener('click', function() {
                const scheduleId = this.getAttribute('data-schedule-id');
                openEditScheduleModal(scheduleId);
            });
            
            return itemElement;
        }
        
        // Open edit schedule modal
        function openEditScheduleModal(scheduleId) {
            showLoading();
            
            fetch(`${API_URL}/scheduled/${scheduleId}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch schedule details');
                    }
                    return response.json();
                })
                .then(schedule => {
                    // Populate form
                    document.getElementById('editScheduleId').value = schedule.id;
                    document.getElementById('editScheduleReleaseDate').value = new Date(schedule.releaseDate).toISOString().slice(0, 16);
                    document.getElementById('editScheduleNotes').value = schedule.notes || '';
                    document.getElementById('editScheduleHasTagalogDub').checked = schedule.hasTagalogDub === true;
                    
                    // Set anime details
                    document.getElementById('editScheduleAnimeThumbnail').src = schedule.thumbnail;
                    document.getElementById('editScheduleAnimeTitle').textContent = schedule.title;
                    document.getElementById('editScheduleAnimeInfo').textContent = `Scheduled for ${new Date(schedule.releaseDate).toLocaleString()}`;
                    
                    // Show modal
                    showModal('editScheduleModal');
                    
                    hideLoading();
                })
                .catch(error => {
                    console.error('Error fetching schedule details:', error);
                    showError('Failed to load schedule details: ' + error.message);
                    hideLoading();
                });
        }
    </script>
</body>
</html>
