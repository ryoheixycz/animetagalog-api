<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Tagalog Admin Panel</title>
    <!-- Tailwind CSS v4 -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <!-- Outfit Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        :root {
            color-scheme: dark;
        }
        
        * {
            font-family: 'Outfit', sans-serif;
        }
        
        /* Tailwind dark mode colors */
        .dark {
            --bg-primary: #121212;
            --bg-secondary: #1e1e1e;
            --bg-tertiary: #292929;
            --text-primary: #f3f4f6;
            --text-secondary: #d1d5db;
            --text-tertiary: #9ca3af;
            --accent-primary: #8b5cf6;
            --accent-secondary: #7c3aed;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
        }
        
        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
        }
        
        /* Modern sidebar styling */
        .sidebar {
            background: linear-gradient(135deg, #7c3aed 0%, #4f46e5 100%);
            min-height: 100vh;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            position: fixed;
            top: 0;
            left: 0;
            width: 280px;
            z-index: 100;
            transition: all 0.3s;
        }
        
        /* Sidebar mobile handling */
        @media (max-width: 991.98px) {
            .sidebar {
                transform: translateX(-280px);
            }
            
            .sidebar.show {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0 !important;
                width: 100% !important;
            }
        }
        
        .main-content {
            margin-left: 280px;
            width: calc(100% - 280px);
            transition: all 0.3s;
        }
        
        .mobile-menu-toggle {
            position: fixed;
            top: 16px;
            left: 16px;
            z-index: 101;
            background-color: rgba(124, 58, 237, 0.9);
            border: none;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        @media (max-width: 991.98px) {
            .mobile-menu-toggle {
                display: flex;
            }
        }
        
        .sidebar-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            transition: all 0.3s;
            border-radius: 8px;
            margin: 0.25rem 0.75rem;
            text-decoration: none;
            font-weight: 500;
        }
        
        .sidebar-link:hover, .sidebar-link.active {
            background-color: rgba(255, 255, 255, 0.15);
            color: #fff;
            transform: translateX(5px);
        }
        
        .sidebar-link i {
            margin-right: 12px;
            font-size: 1.2rem;
        }
        
        .sidebar-brand {
            color: #fff;
            font-weight: 600;
            font-size: 1.5rem;
            padding: 1.75rem 1.5rem;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Card styling */
        .content {
            padding: 2rem 1.5rem;
        }
        
        .card {
            background-color: var(--bg-secondary);
            border: none;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            overflow: hidden;
        }
        
        .card:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .stat-card {
            border-left: none !important;
            overflow: hidden;
            position: relative;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 6px;
            border-radius: 6px 0 0 6px;
        }
        
        .stat-card.primary-card::before {
            background: linear-gradient(to bottom, #8b5cf6, #6d28d9);
        }
        
        .stat-card.success-card::before {
            background: linear-gradient(to bottom, #10b981, #059669);
        }
        
        .stat-card.info-card::before {
            background: linear-gradient(to bottom, #3b82f6, #2563eb);
        }
        
        .card-header {
            background-color: var(--bg-secondary);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-weight: 600;
            padding: 1.25rem 1.5rem;
        }
        
        /* Custom button styles */
        .btn-primary {
            background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
            border: none;
            font-weight: 500;
            border-radius: 8px;
            padding: 0.6rem 1.2rem;
            transition: all 0.3s;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
        }
        
        .btn-light {
            background-color: var(--bg-tertiary);
            border: none;
            color: var(--text-secondary);
            font-weight: 500;
            border-radius: 8px;
            padding: 0.6rem 1.2rem;
            transition: all 0.3s;
        }
        
        .btn-light:hover {
            background-color: #333333;
            color: var(--text-primary);
        }
        
        .btn-outline-primary {
            border: 1px solid #8b5cf6;
            color: #8b5cf6;
            background-color: transparent;
            font-weight: 500;
            border-radius: 8px;
            padding: 0.6rem 1.2rem;
            transition: all 0.3s;
        }
        
        .btn-outline-primary:hover {
            background-color: rgba(139, 92, 246, 0.1);
        }
        
        .btn-outline-danger {
            border: 1px solid #ef4444;
            color: #ef4444;
            background-color: transparent;
            font-weight: 500;
            border-radius: 8px;
            padding: 0.6rem 1.2rem;
            transition: all 0.3s;
        }
        
        .btn-outline-danger:hover {
            background-color: rgba(239, 68, 68, 0.1);
        }
        
        /* Anime card styling */
        .anime-card {
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            height: 100%;
            background-color: var(--bg-secondary);
            border-radius: 16px;
            overflow: hidden;
        }
        
        .anime-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }
        
        .anime-thumbnail {
            height: 360px;
            object-fit: cover;
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
            width: 100%;
            transition: opacity 0.3s, transform 0.3s;
        }
        
        .anime-card:hover .anime-thumbnail {
            transform: scale(1.05);
        }
        
        /* Episode item styling */
        .episode-item {
            background-color: var(--bg-tertiary);
            border-radius: 12px;
            margin-bottom: 0.75rem;
            padding: 1rem;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.03);
        }
        
        .episode-item:hover {
            background-color: rgba(139, 92, 246, 0.1);
            border-color: rgba(139, 92, 246, 0.2);
            transform: translateX(5px);
        }
        
        /* Loading spinner & overlay */
        #loadingSpinner {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        /* Search dropdown styling */
        .search-results {
            position: absolute;
            width: 100%;
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
            background: var(--bg-secondary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            display: none;
            padding: 0.5rem 0;
        }
        
        .search-result-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .search-result-item:last-child {
            border-bottom: none;
        }
        
        .search-result-item:hover {
            background-color: rgba(139, 92, 246, 0.1);
        }
        
        /* Status indicator styling */
        #serverStatus {
            position: fixed;
            bottom: 15px;
            right: 15px;
            padding: 6px 12px;
            border-radius: 30px;
            font-size: 13px;
            z-index: 999;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            transition: all 0.3s;
        }
        
        .status-online {
            background-color: #10b981;
            color: white;
        }
        
        .status-offline {
            background-color: #ef4444;
            color: white;
        }
        
        #serverStatus::before {
            content: '';
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
            background-color: currentColor;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                opacity: 0.5;
                transform: scale(0.8);
            }
            50% {
                opacity: 1;
                transform: scale(1.2);
            }
            100% {
                opacity: 0.5;
                transform: scale(0.8);
            }
        }
        
        /* Form controls */
        .form-control, .form-select {
            background-color: var(--bg-tertiary);
            border-radius: 8px;
            padding: 0.7rem 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.95rem;
            color: var(--text-primary);
        }
        
        .form-control:focus, .form-select:focus {
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
        }
        
        .form-control::placeholder {
            color: var(--text-tertiary);
        }
        
        /* Badges and tags */
        .badge {
            font-weight: 500;
            padding: 0.35em 0.65em;
            border-radius: 6px;
        }
        
        .badge-primary {
            background-color: rgba(139, 92, 246, 0.2);
            color: #a78bfa;
        }
        
        .badge-success {
            background-color: rgba(16, 185, 129, 0.2);
            color: #34d399;
        }
        
        .badge-warning {
            background-color: rgba(245, 158, 11, 0.2);
            color: #fbbf24;
        }
        
        .badge-danger {
            background-color: rgba(239, 68, 68, 0.2);
            color: #f87171;
        }
        
        .badge-info {
            background-color: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
        }
        
        /* Table styling */
        .table {
            color: var(--text-primary);
            border-collapse: separate;
            border-spacing: 0;
            width: 100%;
        }
        
        .table th {
            background-color: var(--bg-tertiary);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.025em;
        }
        
        .table th, .table td {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .table-responsive {
            border-radius: 12px;
            overflow: hidden;
        }
        
        /* Modal styling */
        .modal-content {
            background-color: var(--bg-secondary);
            border: none;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            padding: 1.25rem 1.5rem;
        }
        
        .modal-footer {
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            padding: 1.25rem 1.5rem;
        }
        
        /* Toast notification */
        .toast {
            border: none;
            border-radius: 12px;
            background-color: var(--bg-secondary);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        .toast-header {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .toast-body {
            padding: 1rem;
        }
        
        /* Page header section */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .page-title {
            font-weight: 600;
            font-size: 1.5rem;
            color: var(--text-primary);
            margin-bottom: 0;
        }
        
        /* Custom indicators for stats */
        .stat-icon {
            width: 52px;
            height: 52px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.35rem;
        }
        
        .stat-primary {
            background-color: rgba(139, 92, 246, 0.2);
            color: #a78bfa;
        }
        
        .stat-success {
            background-color: rgba(16, 185, 129, 0.2);
            color: #34d399;
        }
        
        .stat-info {
            background-color: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
        }
        
        .stat-warning {
            background-color: rgba(245, 158, 11, 0.2);
            color: #fbbf24;
        }
        
        /* Badge for bulk episodes count */
        .badge-count {
            position: relative;
            top: -1px;
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
            font-weight: 600;
        }
        
        /* Schedule timeline styling */
        .timeline {
            position: relative;
            padding: 20px 0;
        }
        
        .timeline-item {
            position: relative;
            padding-left: 50px;
            margin-bottom: 30px;
        }
        
        .timeline-item:before {
            content: '';
            position: absolute;
            top: 0;
            left: 15px;
            height: 100%;
            width: 2px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .timeline-item:last-child:before {
            height: 50%;
        }
        
        .timeline-point {
            position: absolute;
            left: 0;
            top: 10px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
            z-index: 2;
        }
        
        .schedule-card {
            transition: all 0.3s;
            border: none;
            overflow: hidden;
        }
        
        .schedule-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
        }
        
        .schedule-thumbnail {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 12px;
            transition: transform 0.3s;
        }
        
        .schedule-card:hover .schedule-thumbnail {
            transform: scale(1.05);
        }
        
        .countdown {
            font-weight: 600;
        }
        
        .timer-section {
            display: inline-block;
            text-align: center;
            margin: 0 5px;
            font-weight: 700;
            min-width: 40px;
        }
        
        .timer-value {
            background-color: rgba(139, 92, 246, 0.2);
            color: #a78bfa;
            padding: 8px 10px;
            border-radius: 8px;
            display: block;
            margin-bottom: 3px;
        }
        
        .timer-label {
            font-size: 0.65rem;
            text-transform: uppercase;
            color: var(--text-tertiary);
            font-weight: 500;
        }
        
        .releasing-soon {
            border-left: 5px solid #f59e0b !important;
        }
        
        .releasing-today {
            border-left: 5px solid #10b981 !important;
        }
        
        .empty-schedule {
            text-align: center;
            padding: 50px 20px;
            background-color: var(--bg-tertiary);
            border-radius: 16px;
            border: 2px dashed rgba(255, 255, 255, 0.1);
        }
        
        /* Skeleton loading animation */
        .skeleton {
            position: relative;
            overflow: hidden;
            background-color: var(--bg-tertiary);
            border-radius: 8px;
        }
        
        .skeleton::after {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            transform: translateX(-100%);
            background-image: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0) 0,
                rgba(255, 255, 255, 0.05) 20%,
                rgba(255, 255, 255, 0.1) 60%,
                rgba(255, 255, 255, 0)
            );
            animation: shimmer 2s infinite;
            content: '';
        }
        
        @keyframes shimmer {
            100% {
                transform: translateX(100%);
            }
        }
        
        /* Image loading states */
        .anime-thumbnail, .schedule-thumbnail {
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .anime-thumbnail.loaded, .schedule-thumbnail.loaded {
            opacity: 1;
        }
        
        /* Fix for anime cover display */
        .anime-cover {
            width: 100%;
            height: 450px;
            object-fit: cover;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s;
        }
        
        .anime-cover:hover {
            transform: scale(1.02);
        }
        
        /* Anime details card */
        .anime-details-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .anime-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(to right, #a78bfa, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(139, 92, 246, 0.5);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(139, 92, 246, 0.8);
        }
    </style>
</head>
<body>
    <!-- Loading Spinner -->
    <div id="loadingSpinner">
        <div class="d-flex flex-column align-items-center">
            <div class="spinner-border text-purple-500" role="status" style="width: 3rem; height: 3rem;"></div>
            <p class="text-white mt-3">Loading...</p>
        </div>
    </div>

    <!-- Mobile Menu Toggle Button -->
    <button class="mobile-menu-toggle" id="sidebarToggle">
        <i class="ph ph-list"></i>
    </button>

    <!-- Server Status Indicator -->
    <div id="serverStatus" class="status-offline">Connecting...</div>

    <div class="container-fluid p-0 d-flex">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-brand">
                <i class="ph ph-film-strip me-2"></i> Anime Tagalog
            </div>
            <div class="mt-4">
                <a href="#" class="sidebar-link active" id="dashboard-link">
                    <i class="ph ph-gauge"></i> Dashboard
                </a>
                <a href="#" class="sidebar-link" id="anime-link">
                    <i class="ph ph-film-slate"></i> Anime Library
                </a>
                <a href="#" class="sidebar-link" id="add-anime-link">
                    <i class="ph ph-plus-circle"></i> Add Anime
                </a>
                <a href="#" class="sidebar-link" id="episodes-link">
                    <i class="ph ph-play-circle"></i> Episodes
                </a>
                <a href="#" class="sidebar-link" id="schedule-link">
                    <i class="ph ph-calendar"></i> Schedule
                </a>
                <hr class="my-4 border-white/10">
                <a href="#" class="sidebar-link" id="settings-link">
                    <i class="ph ph-gear-six"></i> Settings
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="content">
                <!-- Dashboard View -->
                <div id="dashboard-view">
                    <div class="page-header">
                        <h1 class="page-title">Dashboard</h1>
                        <button type="button" class="btn btn-light" id="refresh-dashboard">
                            <i class="ph ph-arrows-clockwise me-1"></i> Refresh
                        </button>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card stat-card primary-card h-100">
                                <div class="card-body p-4">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="text-uppercase text-muted mb-2 small">Total Anime</h6>
                                            <h2 class="mb-0 fs-3 fw-semibold" id="total-anime">0</h2>
                                        </div>
                                        <div class="stat-icon stat-primary">
                                            <i class="ph ph-film-strip"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card stat-card success-card h-100">
                                <div class="card-body p-4">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="text-uppercase text-muted mb-2 small">Total Episodes</h6>
                                            <h2 class="mb-0 fs-3 fw-semibold" id="total-episodes">0</h2>
                                        </div>
                                        <div class="stat-icon stat-success">
                                            <i class="ph ph-play-circle"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card stat-card info-card h-100">
                                <div class="card-body p-4">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="text-uppercase text-muted mb-2 small">Recent Updates</h6>
                                            <h2 class="mb-0 fs-3 fw-semibold" id="recent-updates">0</h2>
                                        </div>
                                        <div class="stat-icon stat-info">
                                            <i class="ph ph-clock-clockwise"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card stat-card h-100" style="border-left: 5px solid #f59e0b;">
                                <div class="card-body p-4">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="text-uppercase text-muted mb-2 small">Upcoming Releases</h6>
                                            <h2 class="mb-0 fs-3 fw-semibold" id="upcoming-releases">0</h2>
                                        </div>
                                        <div class="stat-icon stat-warning">
                                            <i class="ph ph-calendar-check"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Upcoming Releases Card -->
                    <div class="card mb-4">
                        <div class="card-header d-flex align-items-center justify-content-between">
                            <div>
                                <i class="ph ph-calendar me-2"></i>
                                <span>Upcoming Anime Releases</span>
                            </div>
                            <a href="#" id="view-all-schedule-btn" class="btn btn-outline-primary btn-sm">
                                View Schedule
                            </a>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table mb-0">
                                    <thead>
                                        <tr>
                                            <th width="40%">Anime</th>
                                            <th width="15%">Season</th>
                                            <th width="25%">Release Date</th>
                                            <th width="20%">Countdown</th>
                                        </tr>
                                    </thead>
                                    <tbody id="upcoming-releases-table">
                                        <!-- Upcoming releases will be populated here -->
                                        <tr>
                                            <td colspan="4" class="text-center py-4">
                                                <div class="d-flex justify-content-center align-items-center">
                                                    <div class="spinner-border spinner-border-sm text-purple-500 me-2" role="status"></div>
                                                    Loading upcoming releases...
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="card mb-4">
                        <div class="card-header d-flex align-items-center">
                            <i class="ph ph-table me-2"></i>
                            <span>Latest Updates</span>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table mb-0">
                                    <thead>
                                        <tr>
                                            <th width="10%">Type</th>
                                            <th>Title</th>
                                            <th width="15%">Added</th>
                                            <th width="10%">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="latest-updates-table">
                                        <!-- Latest updates will be populated here -->
                                        <tr>
                                            <td colspan="4" class="text-center py-4">
                                                <div class="d-flex justify-content-center align-items-center">
                                                    <div class="spinner-border spinner-border-sm text-purple-500 me-2" role="status"></div>
                                                    Loading latest updates...
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Anime Library View -->
                <div id="anime-view" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">Anime Library</h1>
                        <button type="button" class="btn btn-primary" id="add-anime-btn">
                            <i class="ph ph-plus me-1"></i> Add New Anime
                        </button>
                    </div>
                    
                    <div class="row g-4" id="anime-list">
                        <!-- Anime cards will be populated here -->
                        <div class="col-12 text-center py-5">
                            <div class="spinner-border text-purple-500" role="status"></div>
                            <p class="mt-3 text-muted">Loading anime library...</p>
                        </div>
                    </div>
                </div>

                <!-- Add Anime View -->
                <div id="add-anime-view" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">Add New Anime</h1>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <i class="ph ph-magnifying-glass me-2"></i>
                            Search Anime on AniList
                        </div>
                        <div class="card-body">
                            <div class="mb-4">
                                <label for="animeSearch" class="form-label">Search by Title</label>
                                <div class="position-relative">
                                    <input type="text" class="form-control" id="animeSearch" placeholder="Enter anime title and press enter...">
                                    <div class="search-results" id="searchResults">
                                        <!-- Search results will be populated here -->
                                    </div>
                                </div>
                            </div>
                            
                            <div id="selectedAnimeDetails" style="display: none;" class="mt-4">
                                <div class="anime-details-card">
                                    <div class="row">
                                        <div class="col-lg-3 col-md-4 mb-4 mb-md-0">
                                            <img id="selectedAnimeThumbnail" src="" alt="Anime Cover" class="anime-cover">
                                        </div>
                                        <div class="col-lg-9 col-md-8">
                                            <h3 id="selectedAnimeTitle" class="anime-title"></h3>
                                            <p id="selectedAnimeDescription" class="text-muted"></p>
                                            <div class="d-flex flex-wrap gap-2 mb-3" id="selectedAnimeGenres">
                                                <!-- Genres will be populated here -->
                                            </div>
                                            <div class="row g-3 mb-3">
                                                <div class="col-sm-6 col-lg-3">
                                                    <div class="fw-medium">Episodes</div>
                                                    <span id="selectedAnimeEpisodes" class="text-purple-400">-</span>
                                                </div>
                                                <div class="col-sm-6 col-lg-3">
                                                    <div class="fw-medium">Status</div>
                                                    <span id="selectedAnimeStatus">-</span>
                                                </div>
                                                <div class="col-sm-6 col-lg-3">
                                                    <div class="fw-medium">Season</div>
                                                    <span id="selectedAnimeSeason" class="text-blue-400">-</span>
                                                </div>
                                                <div class="col-sm-6 col-lg-3">
                                                    <div class="fw-medium">Rating</div>
                                                    <span id="selectedAnimeRating" class="text-yellow-400">-</span>
                                                </div>
                                            </div>
                                            <button class="btn btn-primary" id="addSelectedAnime">
                                                <i class="ph ph-plus-circle me-1"></i> Add to Library
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Episodes View -->
                <div id="episodes-view" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">Manage Episodes</h1>
                    </div>
                    
                    <div class="card mb-4">
                        <div class="card-header">
                            <div class="row align-items-center">
                                <div class="col-md-4">
                                    <h5 class="mb-0">Select Anime</h5>
                                </div>
                                <div class="col-md-8">
                                    <select class="form-select" id="episodeAnimeSelector">
                                        <option value="">Choose an anime...</option>
                                        <!-- Anime options will be populated here -->
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="episodeManagementArea" style="display: none;">
                        <div class="row g-4">
                            <div class="col-lg-4">
                                <div class="card mb-4">
                                    <img id="episodeAnimeThumbnail" src="" class="card-img-top anime-thumbnail" alt="Anime Cover">
                                    <div class="card-body">
                                        <h5 id="episodeAnimeTitle" class="card-title fw-bold"></h5>
                                        <p id="episodeAnimeEpisodeCount" class="card-text text-muted"></p>
                                    </div>
                                </div>
                                
                                <!-- Simplified Episode Form -->
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <i class="ph ph-plus-circle me-2"></i>
                                        Add New Episode
                                    </div>
                                    <div class="card-body">
                                        <form id="addEpisodeForm">
                                            <div class="mb-3">
                                                <label for="iframeSrc" class="form-label">iFrame Source (optional)</label>
                                                <input type="text" class="form-control" id="iframeSrc" placeholder="Enter iframe embed URL">
                                            </div>
                                            <div class="mb-3">
                                                <label for="server2Url" class="form-label">Server 2 URL</label>
                                                <input type="text" class="form-control" id="server2Url" required placeholder="Enter direct video URL">
                                            </div>
                                            <button type="submit" class="btn btn-primary w-100">
                                                <i class="ph ph-plus me-1"></i> Add Episode
                                            </button>
                                        </form>
                                    </div>
                                </div>
                                
                                <!-- Bulk Episode Uploader -->
                                <div class="card">
                                    <div class="card-header">
                                        <i class="ph ph-cloud-arrow-up me-2"></i>
                                        Bulk Add Episodes
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="bulkEpisodeHtml" class="form-label">Paste HTML Select with Episodes</label>
                                            <textarea class="form-control" id="bulkEpisodeHtml" rows="5" placeholder="<select id='episode-select'>...</select>"></textarea>
                                            <div class="form-text text-muted">Paste the HTML select element containing episode options with server2Url attributes.</div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="server1DefaultValue" class="form-label">Default Server 1 Value (optional)</label>
                                            <input type="text" class="form-control" id="server1DefaultValue" placeholder="Default value for data-server1">
                                        </div>
                                        <div class="mb-3 form-check">
                                            <input type="checkbox" class="form-check-input" id="replaceExisting">
                                            <label class="form-check-label" for="replaceExisting">Replace existing episodes</label>
                                        </div>
                                        <div class="d-flex gap-2">
                                            <button type="button" class="btn btn-primary flex-grow-1" id="parseBulkEpisodesBtn">
                                                <i class="ph ph-code me-1"></i> Parse 
                                                <span class="badge badge-count ms-1" id="episodeCount">0</span>
                                            </button>
                                            <button type="button" class="btn btn-success flex-grow-1" id="uploadBulkEpisodesBtn" disabled>
                                                <i class="ph ph-cloud-arrow-up me-1"></i> Upload
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-8">
                                <div class="card">
                                    <div class="card-header">
                                        <div class="d-flex align-items-center justify-content-between">
                                            <div>
                                                <i class="ph ph-play-circle me-2"></i>
                                                Episodes List
                                            </div>
                                            <div class="text-muted small" id="episodes-count-display"></div>
                                        </div>
                                    </div>
                                    <div class="card-body p-0">
                                        <div id="episodesList" class="p-3">
                                            <!-- Episodes will be populated here -->
                                            <div class="text-center py-5">
                                                <p class="text-muted">Select an anime to manage episodes</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Schedule View -->
                <div id="schedule-view" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">Anime Release Schedule</h1>
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-primary" id="add-schedule-btn">
                                <i class="ph ph-plus me-1"></i> Add Release
                            </button>
                            <button type="button" class="btn btn-light" id="refresh-schedule-btn">
                                <i class="ph ph-arrows-clockwise me-1"></i> Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="row g-4 mb-4">
                        <div class="col-xl-3 col-md-6">
                            <div class="card stat-card primary-card h-100">
                                <div class="card-body p-4">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="text-uppercase text-muted mb-2 small">Upcoming</h6>
                                            <h2 class="mb-0 fs-3 fw-semibold" id="upcoming-count">0</h2>
                                        </div>
                                        <div class="stat-icon stat-primary">
                                            <i class="ph ph-calendar"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6">
                            <div class="card stat-card success-card h-100">
                                <div class="card-body p-4">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="text-uppercase text-muted mb-2 small">Today</h6>
                                            <h2 class="mb-0 fs-3 fw-semibold" id="today-count">0</h2>
                                        </div>
                                        <div class="stat-icon stat-success">
                                            <i class="ph ph-check-square"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6">
                            <div class="card stat-card info-card h-100">
                                <div class="card-body p-4">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="text-uppercase text-muted mb-2 small">This Week</h6>
                                            <h2 class="mb-0 fs-3 fw-semibold" id="week-count">0</h2>
                                        </div>
                                        <div class="stat-icon stat-info">
                                            <i class="ph ph-calendar-plus"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6">
                            <div class="card stat-card h-100" style="border-left: 5px solid #f59e0b;">
                                <div class="card-body p-4">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="text-uppercase text-muted mb-2 small">Total Series</h6>
                                            <h2 class="mb-0 fs-3 fw-semibold" id="series-count">0</h2>
                                        </div>
                                        <div class="stat-icon stat-warning">
                                            <i class="ph ph-television"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card mb-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span><i class="ph ph-calendar me-2"></i> Upcoming Releases</span>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="show-compact-view" checked>
                                <label class="form-check-label" for="show-compact-view">Timeline View</label>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- Timeline View for schedules -->
                            <div id="timeline-view">
                                <div class="timeline" id="schedule-timeline">
                                    <!-- Schedule items will be populated here -->
                                </div>
                            </div>
                            
                            <!-- Grid View for schedules -->
                            <div id="grid-view" style="display: none;">
                                <div class="row g-4" id="schedule-grid">
                                    <!-- Schedule cards will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Edit Episode Modal -->
    <div class="modal fade" id="editEpisodeModal" tabindex="-1" aria-labelledby="editEpisodeModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editEpisodeModalLabel">Edit Episode</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editEpisodeForm">
                        <input type="hidden" id="editEpisodeId">
                        <!-- Simplified Edit Form -->
                        <div class="mb-3">
                            <label for="editIframeSrc" class="form-label">iFrame Source (optional)</label>
                            <input type="text" class="form-control" id="editIframeSrc">
                        </div>
                        <div class="mb-3">
                            <label for="editServer2Url" class="form-label">Server 2 URL</label>
                            <input type="text" class="form-control" id="editServer2Url" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveEditEpisodeBtn">
                        <i class="ph ph-check me-1"></i> Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Episode Confirmation Modal -->
    <div class="modal fade" id="deleteEpisodeModal" tabindex="-1" aria-labelledby="deleteEpisodeModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteEpisodeModalLabel">Confirm Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning">
                        <i class="ph ph-warning me-2"></i> Are you sure you want to delete this episode?
                    </div>
                    <p class="fw-medium" id="deleteEpisodeInfo"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteEpisodeBtn">
                        <i class="ph ph-trash me-1"></i> Delete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Schedule Modal -->
    <div class="modal fade" id="addScheduleModal" tabindex="-1" aria-labelledby="addScheduleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addScheduleModalLabel">Add New Release</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addScheduleForm">
                        <div class="mb-3">
                            <label for="scheduleAnimeSelector" class="form-label">Select Anime</label>
                            <select class="form-select" id="scheduleAnimeSelector" required>
                                <option value="">Choose an anime...</option>
                                <!-- Anime options will be populated here -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="scheduleSeason" class="form-label">Season/Cour</label>
                            <input type="text" class="form-control" id="scheduleSeason" placeholder="e.g. Season 2, Fall 2025">
                        </div>
                        <div class="mb-3">
                            <label for="scheduleReleaseDate" class="form-label">Release Date</label>
                            <input type="date" class="form-control" id="scheduleReleaseDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="scheduleNotes" class="form-label">Notes (optional)</label>
                            <textarea class="form-control" id="scheduleNotes" rows="3" placeholder="Additional information about the release"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveScheduleBtn">
                        <i class="ph ph-calendar-plus me-1"></i> Add Release
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Schedule Modal -->
    <div class="modal fade" id="editScheduleModal" tabindex="-1" aria-labelledby="editScheduleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editScheduleModalLabel">Edit Release</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editScheduleForm">
                        <input type="hidden" id="editScheduleId">
                        <div class="mb-3">
                            <label for="editScheduleAnime" class="form-label">Anime</label>
                            <input type="text" class="form-control" id="editScheduleAnime" disabled>
                        </div>
                        <div class="mb-3">
                            <label for="editScheduleSeason" class="form-label">Season/Cour</label>
                            <input type="text" class="form-control" id="editScheduleSeason">
                        </div>
                        <div class="mb-3">
                            <label for="editScheduleReleaseDate" class="form-label">Release Date</label>
                            <input type="date" class="form-control" id="editScheduleReleaseDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="editScheduleNotes" class="form-label">Notes (optional)</label>
                            <textarea class="form-control" id="editScheduleNotes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveEditScheduleBtn">
                        <i class="ph ph-check me-1"></i> Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Schedule Confirmation Modal -->
    <div class="modal fade" id="deleteScheduleModal" tabindex="-1" aria-labelledby="deleteScheduleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteScheduleModalLabel">Confirm Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning">
                        <i class="ph ph-warning me-2"></i> Are you sure you want to delete this release schedule?
                    </div>
                    <p class="fw-medium" id="deleteScheduleInfo"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteScheduleBtn">
                        <i class="ph ph-trash me-1"></i> Delete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Upload Preview Modal -->
    <div class="modal fade" id="bulkUploadPreviewModal" tabindex="-1" aria-labelledby="bulkUploadPreviewModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="bulkUploadPreviewModalLabel">Episode Upload Preview</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="ph ph-info me-2"></i> Review the episodes below before confirming upload.
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped mb-0">
                            <thead>
                                <tr>
                                    <th>Episode #</th>
                                    <th>Title</th>
                                    <th>Server 1</th>
                                    <th>Server 2</th>
                                </tr>
                            </thead>
                            <tbody id="bulkEpisodePreviewTable">
                                <!-- Episodes will be listed here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmBulkUploadBtn">
                        <i class="ph ph-cloud-arrow-up me-1"></i> Confirm Upload
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Error Toast -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="errorToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header bg-danger text-white">
                <i class="ph ph-x-circle me-2"></i>
                <strong class="me-auto">Error</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="errorToastBody">
                Something went wrong.
            </div>
        </div>
    </div>

    <!-- Success Toast -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="successToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header bg-success text-white">
                <i class="ph ph-check-circle me-2"></i>
                <strong class="me-auto">Success</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="successToastBody">
                Operation successful.
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        // Backend API URL - automatically detect whether we're on localhost or deployed
        const API_URL = window.location.hostname === 'localhost' ? 'http://localhost:3000/api' : '/api';
        
        // Initialize the sidebar toggle for mobile
        document.getElementById('sidebarToggle').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('show');
        });
        
        // Toast instances
        const errorToast = new bootstrap.Toast(document.getElementById('errorToast'));
        const successToast = new bootstrap.Toast(document.getElementById('successToast'));
        
        // Utility function to show loading spinner
        function showLoading() {
            document.getElementById('loadingSpinner').style.display = 'flex';
        }
        
        // Utility function to hide loading spinner
        function hideLoading() {
            document.getElementById('loadingSpinner').style.display = 'none';
        }
        
        // Utility function to show error notification
        function showError(message) {
            document.getElementById('errorToastBody').textContent = message;
            errorToast.show();
        }

        // Utility function to show success notification
        function showSuccess(message) {
            document.getElementById('successToastBody').textContent = message;
            successToast.show();
        }

        // Utility function for optimized images
        function getOptimizedImageUrl(originalUrl) {
            if (!originalUrl) return 'https://via.placeholder.com/350x500?text=No+Image';
            
            // For external images, use our proxy
            if (originalUrl.startsWith('http')) {
                return `${API_URL}/image/${encodeURIComponent(originalUrl)}`;
            }
            
            // For local images, return as-is
            return originalUrl;
        }
        
        // Server status check
        function checkServerStatus() {
            const statusElement = document.getElementById('serverStatus');
            
            fetch(`${window.location.origin}/health`)
                .then(response => {
                    if (response.ok) {
                        statusElement.className = 'status-online';
                        statusElement.textContent = 'Server Online';
                        return response.json();
                    } else {
                        throw new Error('Server Error');
                    }
                })
                .catch(error => {
                    statusElement.className = 'status-offline';
                    statusElement.textContent = 'Server Offline';
                });
        }
        
        // Check server status every 30 seconds
        setInterval(checkServerStatus, 30000);
        
        // Navigation logic
        document.getElementById('dashboard-link').addEventListener('click', function(e) {
            e.preventDefault();
            showView('dashboard-view');
            activateNavLink(this);
            loadDashboardData();
        });
        
        document.getElementById('anime-link').addEventListener('click', function(e) {
            e.preventDefault();
            showView('anime-view');
            activateNavLink(this);
            loadAnimeList();
        });
        
        document.getElementById('add-anime-link').addEventListener('click', function(e) {
            e.preventDefault();
            showView('add-anime-view');
            activateNavLink(this);
        });
        
        document.getElementById('episodes-link').addEventListener('click', function(e) {
            e.preventDefault();
            showView('episodes-view');
            activateNavLink(this);
            loadAnimeForEpisodes();
        });

        document.getElementById('schedule-link').addEventListener('click', function(e) {
            e.preventDefault();
            showView('schedule-view');
            activateNavLink(this);
            loadScheduleData();
        });
        
        document.getElementById('add-anime-btn').addEventListener('click', function() {
            showView('add-anime-view');
            activateNavLink(document.getElementById('add-anime-link'));
        });
        
        // Helper function to activate the correct nav link
        function activateNavLink(link) {
            // Remove active class from all links
            document.querySelectorAll('.sidebar-link').forEach(el => {
                el.classList.remove('active');
            });
            
            // Add active class to the clicked link
            link.classList.add('active');
            
            // On mobile, hide the sidebar after selection
            if (window.innerWidth < 992) {
                document.getElementById('sidebar').classList.remove('show');
            }
        }
        
        // Refresh dashboard
        document.getElementById('refresh-dashboard').addEventListener('click', function() {
            loadDashboardData();
        });
        
        // Function to show a specific view and hide others
        function showView(viewId) {
            document.getElementById('dashboard-view').style.display = 'none';
            document.getElementById('anime-view').style.display = 'none';
            document.getElementById('add-anime-view').style.display = 'none';
            document.getElementById('episodes-view').style.display = 'none';
            document.getElementById('schedule-view').style.display = 'none';
            
            document.getElementById(viewId).style.display = 'block';
        }
        
        // Load dashboard data with fixed episode counting
        function loadDashboardData() {
            showLoading();
            
            // Fetch anime list
            fetch(`${API_URL}/anime`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch anime list');
                    }
                    return response.json();
                })
                .then(animeList => {
                    document.getElementById('total-anime').textContent = animeList.length;
                    
                    // Fetch episodes - use a direct call to get all episodes
                    return fetch(`${API_URL}/episodes`)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Failed to fetch episodes');
                            }
                            return response.json();
                        });
                })
                .then(episodes => {
                    // Ensure episodes are unique by ID to avoid duplication
                    const uniqueEpisodes = Array.from(new Map(episodes.map(item => 
                        [item.id, item])).values());
                        
                    document.getElementById('total-episodes').textContent = uniqueEpisodes.length;
                    
                    // Sort episodes by date added (descending)
                    uniqueEpisodes.sort((a, b) => new Date(b.dateAdded) - new Date(a.dateAdded));
                    
                    // Display recent updates - use the unique episodes
                    document.getElementById('recent-updates').textContent = uniqueEpisodes.length > 0 ? 
                        Math.min(uniqueEpisodes.length, 5) : 0;
                    
                    // Populate latest updates table
                    const updatesTableBody = document.getElementById('latest-updates-table');
                    updatesTableBody.innerHTML = '';
                    
                    if (uniqueEpisodes.length === 0) {
                        updatesTableBody.innerHTML = `
                            <tr>
                                <td colspan="4" class="text-center py-4">
                                    <i class="ph ph-info me-2 text-muted"></i>
                                    No updates found
                                </td>
                            </tr>
                        `;
                    } else {
                        // Get anime data for each episode - only show the most recent 5
                        const recentEpisodes = uniqueEpisodes.slice(0, 5);
                        const animePromises = recentEpisodes.map(episode => 
                            fetch(`${API_URL}/anime/${episode.animeId}`)
                                .then(response => {
                                    if (!response.ok) {
                                        return null;
                                    }
                                    return response.json();
                                })
                                .then(anime => {
                                    if (!anime) {
                                        return {
                                            episode: episode,
                                            anime: { title: 'Unknown Anime' }
                                        };
                                    }
                                    return {
                                        episode: episode,
                                        anime: anime
                                    };
                                })
                        );
                        
                        Promise.all(animePromises)
                            .then(results => {
                                results.forEach(result => {
                                    const dateAdded = new Date(result.episode.dateAdded);
                                    const formattedDate = dateAdded.toLocaleDateString(undefined, {
                                        year: 'numeric',
                                        month: 'short',
                                        day: 'numeric'
                                    });
                                    
                                    const row = document.createElement('tr');
                                    row.innerHTML = `
                                        <td>
                                            <span class="badge badge-primary">Episode</span>
                                        </td>
                                        <td>
                                            <div class="fw-medium">${result.anime.title}</div>
                                            <small class="text-muted">Ep ${result.episode.number}: ${result.episode.title || 'Untitled'}</small>
                                        </td>
                                        <td>${formattedDate}</td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary view-episode-btn" 
                                                data-anime-id="${result.episode.animeId}" 
                                                data-episode-id="${result.episode.id}">
                                                <i class="ph ph-eye"></i>
                                            </button>
                                        </td>
                                    `;
                                    updatesTableBody.appendChild(row);
                                });
                                
                                // Add event listeners to view buttons
                                document.querySelectorAll('.view-episode-btn').forEach(button => {
                                    button.addEventListener('click', function() {
                                        const animeId = this.getAttribute('data-anime-id');
                                        
                                        // Switch to episodes view
                                        showView('episodes-view');
                                        activateNavLink(document.getElementById('episodes-link'));
                                        
                                        // Load anime for episodes
                                        loadAnimeForEpisodes(animeId);
                                    });
                                });
                            })
                            .catch(error => {
                                console.error('Error loading episode details:', error);
                                updatesTableBody.innerHTML = `
                                    <tr>
                                        <td colspan="4" class="text-center text-danger py-4">
                                            <i class="ph ph-warning me-2"></i>
                                            Error loading episode details
                                        </td>
                                    </tr>
                                `;
                            });
                    }

                    // Load upcoming releases for dashboard
                    loadUpcomingReleases();
                    
                    hideLoading();
                })
                .catch(error => {
                    console.error('Error loading dashboard data:', error);
                    showError('Failed to load dashboard data: ' + error.message);
                    hideLoading();
                });
        }

        // Load upcoming releases in dashboard
        function loadUpcomingReleases() {
            fetch(`${API_URL}/schedule`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch schedule');
                    }
                    return response.json();
                })
                .then(scheduleList => {
                    // Update the upcomming-releases counter
                    document.getElementById('upcoming-releases').textContent = scheduleList.length;
                    
                    const tableBody = document.getElementById('upcoming-releases-table');
                    tableBody.innerHTML = '';
                    
                    if (scheduleList.length === 0) {
                        tableBody.innerHTML = `
                            <tr>
                                <td colspan="4" class="text-center py-4">
                                    <i class="ph ph-info me-2 text-muted"></i>
                                    No upcoming releases scheduled
                                </td>
                            </tr>
                        `;
                        return;
                    }
                    
                    // Sort by release date
                    scheduleList.sort((a, b) => {
                        return new Date(a.releaseDate) - new Date(b.releaseDate);
                    });
                    
                    // Only show the next 5
                    scheduleList.slice(0, 5).forEach(schedule => {
                        const releaseDate = new Date(schedule.releaseDate);
                        const now = new Date();
                        const timeUntil = releaseDate - now;
                        
                        const formattedDate = releaseDate.toLocaleDateString(undefined, {
                            weekday: 'short',
                            month: 'short',
                            day: 'numeric',
                            year: 'numeric'
                        });
                        
                        // Format countdown
                        let countdownText = '';
                        if (timeUntil < 0) {
                            countdownText = '<span class="badge badge-success">Released</span>';
                        } else {
                            const days = Math.floor(timeUntil / (1000 * 60 * 60 * 24));
                            
                            if (days > 30) {
                                const months = Math.floor(days / 30);
                                countdownText = `${months} month${months > 1 ? 's' : ''}`;
                            } else if (days > 0) {
                                countdownText = `${days} day${days > 1 ? 's' : ''}`;
                            } else {
                                const hours = Math.floor((timeUntil % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                countdownText = `${hours} hour${hours > 1 ? 's' : ''}`;
                            }
                        }
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="${getOptimizedImageUrl(schedule.thumbnail)}" alt="${schedule.animeTitle}" 
                                        class="me-2 rounded" style="width: 40px; height: 40px; object-fit: cover;" loading="lazy">
                                    <div class="fw-medium">${schedule.animeTitle}</div>
                                </div>
                            </td>
                            <td>${schedule.season || 'New'}</td>
                            <td>${formattedDate}</td>
                            <td>${countdownText}</td>
                        `;
                        tableBody.appendChild(row);
                    });
                    
                    // Add event listener to view all button
                    document.getElementById('view-all-schedule-btn').addEventListener('click', function(e) {
                        e.preventDefault();
                        showView('schedule-view');
                        activateNavLink(document.getElementById('schedule-link'));
                    });
                })
                .catch(error => {
                    console.error('Error loading upcoming releases:', error);
                    document.getElementById('upcoming-releases-table').innerHTML = `
                        <tr>
                            <td colspan="4" class="text-center text-danger py-4">
                                <i class="ph ph-warning me-2"></i>
                                Error loading upcoming releases
                            </td>
                        </tr>
                    `;
                });
        }
        
        // Load anime list for the library view
        function loadAnimeList() {
            showLoading();
            
            fetch(`${API_URL}/anime`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch anime list');
                    }
                    return response.json();
                })
                .then(animeList => {
                    const animeListContainer = document.getElementById('anime-list');
                    animeListContainer.innerHTML = '';
                    
                    if (animeList.length === 0) {
                        animeListContainer.innerHTML = `
                            <div class="col-12 text-center py-5">
                                <i class="ph ph-film-strip fs-1 text-muted mb-3"></i>
                                <p class="text-muted">No anime found. Add some to get started!</p>
                                <button class="btn btn-primary mt-3" id="no-anime-add-btn">
                                    <i class="ph ph-plus me-1"></i> Add Anime
                                </button>
                            </div>
                        `;
                        
                        document.getElementById('no-anime-add-btn').addEventListener('click', function() {
                            showView('add-anime-view');
                            activateNavLink(document.getElementById('add-anime-link'));
                        });
                    } else {
                        animeList.forEach(anime => {
                            const card = document.createElement('div');
                            card.className = 'col-xl-3 col-lg-4 col-md-6 mb-4';
                            card.innerHTML = `
                                <div class="anime-card" data-anime-id="${anime.id}">
                                    <img src="${getOptimizedImageUrl(anime.thumbnail)}" class="anime-thumbnail" alt="${anime.title}" loading="lazy">
                                    <div class="card-body d-flex flex-column p-3">
                                        <h5 class="card-title fw-bold text-truncate mb-1">${anime.title}</h5>
                                        <div class="d-flex flex-wrap gap-1 mb-2">
                                            ${anime.genres.slice(0, 3).map(genre => 
                                                `<span class="badge badge-primary">${genre}</span>`
                                            ).join('')}
                                            ${anime.genres.length > 3 ? `<span class="badge badge-primary">+${anime.genres.length - 3}</span>` : ''}
                                        </div>
                                        <p class="card-text small mb-4 text-muted">${anime.description ? anime.description.substring(0, 100) + '...' : 'No description available'}</p>
                                        <div class="mt-auto">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <span class="badge badge-info">
                                                    <i class="ph ph-play-circle me-1"></i> ${anime.episodeCount} eps
                                                </span>
                                                <button class="btn btn-sm btn-primary manage-episodes-btn" data-anime-id="${anime.id}">
                                                    <i class="ph ph-pencil me-1"></i> Manage
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                            animeListContainer.appendChild(card);
                        });
                        
                        // Add event listeners to manage episodes buttons
                        document.querySelectorAll('.manage-episodes-btn').forEach(button => {
                            button.addEventListener('click', function(e) {
                                e.stopPropagation();
                                const animeId = this.getAttribute('data-anime-id');
                                
                                // Switch to episodes view
                                showView('episodes-view');
                                activateNavLink(document.getElementById('episodes-link'));
                                
                                // Load anime for episodes
                                loadAnimeForEpisodes(animeId);
                            });
                        });

                        // Handle image loading
                        document.querySelectorAll('.anime-thumbnail').forEach(img => {
                            if (img.complete) {
                                img.classList.add('loaded');
                            } else {
                                img.addEventListener('load', function() {
                                    this.classList.add('loaded');
                                });
                            }
                            
                            img.addEventListener('error', function() {
                                this.src = 'https://via.placeholder.com/350x500?text=No+Image';
                                this.classList.add('loaded');
                            });
                        });
                    }
                    
                    hideLoading();
                })
                .catch(error => {
                    console.error('Error loading anime list:', error);
                    showError('Failed to load anime list: ' + error.message);
                    hideLoading();
                });
        }

        // Fix for the anime cover display
        function fixAnimeCoverDisplay() {
            // Select all anime cover/thumbnail images
            const animeCovers = document.querySelectorAll('.anime-cover, .anime-thumbnail');
            
            animeCovers.forEach(cover => {
                // Set error handler to use placeholder
                cover.addEventListener('error', function() {
                    this.src = 'https://via.placeholder.com/350x500?text=No+Image';
                    this.classList.add('loaded');
                });
                
                // Add loaded class when image is loaded
                if (cover.complete) {
                    cover.classList.add('loaded');
                } else {
                    cover.addEventListener('load', function() {
                        this.classList.add('loaded');
                    });
                }
                
                // Set high-quality image
                if (cover.src && !cover.src.includes('placeholder')) {
                    cover.src = getOptimizedImageUrl(cover.src);
                }
            });
        }
        
        // Search functionality for AniList
        const animeSearchInput = document.getElementById('animeSearch');
        const searchResultsContainer = document.getElementById('searchResults');
        
        animeSearchInput.addEventListener('input', function() {
            const searchTerm = this.value.trim();
            
            if (searchTerm.length < 3) {
                searchResultsContainer.style.display = 'none';
                return;
            }
            
            showLoading();
            // Search AniList API
            fetch(`${API_URL}/search?query=${encodeURIComponent(searchTerm)}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Search failed');
                    }
                    return response.json();
                })
                .then(results => {
                    searchResultsContainer.innerHTML = '';
                    
                    if (results.length === 0) {
                        searchResultsContainer.innerHTML = `
                            <div class="search-result-item text-center">
                                <i class="ph ph-magnifying-glass me-1"></i>
                                No results found for "${searchTerm}"
                            </div>
                        `;
                    } else {
                        results.forEach(anime => {
                            const resultItem = document.createElement('div');
                            resultItem.className = 'search-result-item';
                            resultItem.setAttribute('data-anime-id', anime.id);
                            resultItem.innerHTML = `
                                <div class="d-flex align-items-center">
                                    <img src="${getOptimizedImageUrl(anime.thumbnail)}" alt="${anime.title}" class="me-3 rounded" 
                                        style="width: 50px; height: 70px; object-fit: cover;" loading="lazy">
                                    <div>
                                        <div class="fw-medium">${anime.title}</div>
                                        <div class="d-flex align-items-center text-muted small">
                                            <span class="me-2">${anime.episodeCount} eps</span>
                                            <span class="badge ${getStatusBadgeClass(anime.status)}">${anime.status}</span>
                                        </div>
                                    </div>
                                </div>
                            `;
                            searchResultsContainer.appendChild(resultItem);
                            
                            resultItem.addEventListener('click', function() {
                                displaySelectedAnime(anime);
                                searchResultsContainer.style.display = 'none';
                                animeSearchInput.value = anime.title;
                            });
                        });
                    }
                    
                    searchResultsContainer.style.display = 'block';
                    hideLoading();
                })
                .catch(error => {
                    console.error('Error searching anime:', error);
                    searchResultsContainer.innerHTML = `
                        <div class="search-result-item text-center text-danger">
                            <i class="ph ph-warning-circle me-1"></i>
                            Error searching. Please try again.
                        </div>
                    `;
                    searchResultsContainer.style.display = 'block';
                    hideLoading();
                });
        });
        
        // Helper function to get status badge class
        function getStatusBadgeClass(status) {
            status = status.toUpperCase();
            switch(status) {
                case 'FINISHED':
                case 'COMPLETED':
                    return 'badge-success';
                case 'RELEASING':
                case 'AIRING':
                    return 'badge-primary';
                case 'NOT_YET_RELEASED':
                case 'UPCOMING':
                    return 'badge-info';
                case 'CANCELLED':
                    return 'badge-danger';
                default:
                    return 'badge-secondary';
            }
        }
        
        // Hide search results when clicking outside
        document.addEventListener('click', function(e) {
            if (!animeSearchInput.contains(e.target) && !searchResultsContainer.contains(e.target)) {
                searchResultsContainer.style.display = 'none';
            }
        });
        
        // Display selected anime details
        function displaySelectedAnime(anime) {
            const detailsContainer = document.getElementById('selectedAnimeDetails');
            const thumbnailElement = document.getElementById('selectedAnimeThumbnail');
            const titleElement = document.getElementById('selectedAnimeTitle');
            const descriptionElement = document.getElementById('selectedAnimeDescription');
            const genresContainer = document.getElementById('selectedAnimeGenres');
            const episodesElement = document.getElementById('selectedAnimeEpisodes');
            const statusElement = document.getElementById('selectedAnimeStatus');
            const seasonElement = document.getElementById('selectedAnimeSeason');
            const ratingElement = document.getElementById('selectedAnimeRating');
            
            thumbnailElement.src = getOptimizedImageUrl(anime.thumbnail);
            thumbnailElement.onerror = function() {
                this.src = 'https://via.placeholder.com/350x500?text=No+Image';
            };
            
            titleElement.textContent = anime.title;
            descriptionElement.textContent = anime.description || 'No description available';
            
            genresContainer.innerHTML = '';
            anime.genres.forEach(genre => {
                const badge = document.createElement('span');
                badge.className = 'badge badge-primary';
                badge.textContent = genre;
                genresContainer.appendChild(badge);
            });
            
            episodesElement.textContent = anime.episodeCount || 'Unknown';
            
            statusElement.innerHTML = `<span class="badge ${getStatusBadgeClass(anime.status)}">${anime.status || 'Unknown'}</span>`;
            
            seasonElement.textContent = anime.season ? `${anime.season} ${anime.startDate?.split('-')[0] || ''}` : 'Unknown';
            
            if (anime.rating) {
                const rating = parseFloat(anime.rating);
                ratingElement.innerHTML = `<div class="d-inline-flex align-items-center">
                    ${rating.toFixed(1)} 
                    <i class="ph ph-star-fill ms-1 text-yellow-400"></i>
                </div>`;
            } else {
                ratingElement.textContent = 'N/A';
            }
            
            detailsContainer.style.display = 'block';
            
            // Add event listener to add anime button
            document.getElementById('addSelectedAnime').setAttribute('data-anime-id', anime.id);
            
            // Fix anime cover display
            fixAnimeCoverDisplay();
        }
        
        // Load schedule data
        function loadScheduleData() {
            showLoading();
            fetch(`${API_URL}/schedule`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch schedule');
                    }
                    return response.json();
                })
                .then(scheduleList => {
                    updateScheduleStats(scheduleList);
                    displayScheduleTimeline(scheduleList);
                    displayScheduleGrid(scheduleList);
                    hideLoading();
                })
                .catch(error => {
                    console.error('Error loading schedule:', error);
                    showError('Failed to load schedule: ' + error.message);
                    hideLoading();
                });
        }
        
        // Update schedule statistics
        function updateScheduleStats(scheduleList) {
            const now = new Date();
            const todayEnd = new Date(now);
            todayEnd.setHours(23, 59, 59, 999);
            
            const weekEnd = new Date(now);
            weekEnd.setDate(now.getDate() + 7);
            
            const todayCount = scheduleList.filter(item => {
                const releaseDate = new Date(item.releaseDate);
                return releaseDate >= now && releaseDate <= todayEnd;
            }).length;
            
            const weekCount = scheduleList.filter(item => {
                const releaseDate = new Date(item.releaseDate);
                return releaseDate >= now && releaseDate <= weekEnd;
            }).length;
            
            const uniqueAnime = new Set(scheduleList.map(item => item.animeId)).size;
            
            document.getElementById('upcoming-count').textContent = scheduleList.length;
            document.getElementById('today-count').textContent = todayCount;
            document.getElementById('week-count').textContent = weekCount;
            document.getElementById('series-count').textContent = uniqueAnime;
        }
        
        // Display schedule in timeline format
        function displayScheduleTimeline(scheduleList) {
            const timelineContainer = document.getElementById('schedule-timeline');
            timelineContainer.innerHTML = '';
            
            if (scheduleList.length === 0) {
                timelineContainer.innerHTML = `
                    <div class="empty-schedule">
                        <i class="ph ph-calendar-x fs-1 text-muted mb-3"></i>
                        <h5>No Upcoming Releases</h5>
                        <p class="text-muted">No scheduled releases found. Add some or refresh from AniList.</p>
                    </div>
                `;
                return;
            }
            
            // Group by day
            const schedulesByDay = {};
            const now = new Date();
            
            scheduleList.forEach(schedule => {
                const releaseDate = new Date(schedule.releaseDate);
                const dateStr = releaseDate.toDateString();
                
                if (!schedulesByDay[dateStr]) {
                    schedulesByDay[dateStr] = [];
                }
                
                schedulesByDay[dateStr].push(schedule);
            });
            
            // Sort days
            const sortedDays = Object.keys(schedulesByDay).sort((a, b) => {
                return new Date(a) - new Date(b);
            });
            
            // Display each day's schedules
            sortedDays.forEach(day => {
                const dayDate = new Date(day);
                const isToday = dayDate.toDateString() === now.toDateString();
                const isTomorrow = dayDate.toDateString() === new Date(now.getTime() + 86400000).toDateString();
                
                let dayLabel = dayDate.toLocaleDateString(undefined, {
                    weekday: 'long',
                    month: 'long',
                    day: 'numeric',
                    year: 'numeric'
                });
                
                if (isToday) {
                    dayLabel = `Today - ${dayLabel}`;
                } else if (isTomorrow) {
                    dayLabel = `Tomorrow - ${dayLabel}`;
                }
                
                const dayHeader = document.createElement('div');
                dayHeader.className = 'mb-4';
                dayHeader.innerHTML = `
                    <h5 class="fw-bold">
                        <i class="ph ph-calendar-check me-2"></i>
                        ${dayLabel}
                    </h5>
                `;
                timelineContainer.appendChild(dayHeader);
                
                // Sort schedules within the day by time
                schedulesByDay[day].sort((a, b) => {
                    return new Date(a.releaseDate) - new Date(b.releaseDate);
                });
                
                // Create timeline items for each schedule
                schedulesByDay[day].forEach(schedule => {
                    const releaseDate = new Date(schedule.releaseDate);
                    const timeUntil = releaseDate - now;
                    const isReleasingSoon = timeUntil < 86400000; // 24 hours
                    
                    const formattedDate = releaseDate.toLocaleDateString(undefined, {
                        month: 'long',
                        day: 'numeric',
                        year: 'numeric'
                    });
                    
                    const timelineItem = document.createElement('div');
                    timelineItem.className = `timeline-item ${isReleasingSoon ? 'releasing-soon' : ''} ${isToday ? 'releasing-today' : ''}`;
                    timelineItem.innerHTML = `
                        <div class="timeline-point">
                            <i class="ph ph-television"></i>
                        </div>
                        <div class="card schedule-card">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-3">
                                    <div class="me-auto">
                                        <h5 class="card-title mb-1">${schedule.animeTitle}</h5>
                                        <div class="text-muted small">
                                            ${schedule.season ? `Season: ${schedule.season}` : 'New Release'}
                                            ${schedule.notes ? ` • ${schedule.notes}` : ''}
                                        </div>
                                    </div>
                                    <span class="badge badge-primary">
                                        <i class="ph ph-calendar-check me-1"></i> ${formattedDate}
                                    </span>
                                </div>
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <img src="${getOptimizedImageUrl(schedule.thumbnail)}" class="schedule-thumbnail" alt="${schedule.animeTitle}" loading="lazy">
                                    </div>
                                    <div class="col-md-8">
                                        <div class="mb-3 countdown" data-release-date="${schedule.releaseDate}">
                                            <div class="mb-2">Releases in:</div>
                                            <div class="d-flex align-items-center countdown-timer">
                                                <div class="timer-section">
                                                    <span class="timer-value days">00</span>
                                                    <span class="timer-label">days</span>
                                                </div>
                                                <div class="timer-section">
                                                    <span class="timer-value hours">00</span>
                                                    <span class="timer-label">hours</span>
                                                </div>
                                                <div class="timer-section">
                                                    <span class="timer-value minutes">00</span>
                                                    <span class="timer-label">mins</span>
                                                </div>
                                                <div class="timer-section">
                                                    <span class="timer-value seconds">00</span>
                                                    <span class="timer-label">secs</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="d-flex justify-content-end gap-2">
                                            <button class="btn btn-sm btn-outline-primary edit-schedule-btn" data-schedule-id="${schedule.id}">
                                                <i class="ph ph-pencil"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline-danger delete-schedule-btn" 
                                                data-schedule-id="${schedule.id}" 
                                                data-anime-title="${schedule.animeTitle}" 
                                                data-season="${schedule.season || 'New Release'}">
                                                <i class="ph ph-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    timelineContainer.appendChild(timelineItem);
                });
            });
            
            // Start countdown timers
            startCountdowns();
            
            // Add event listeners to edit and delete buttons
            addScheduleEventListeners();

            // Handle image loading
            document.querySelectorAll('.schedule-thumbnail').forEach(img => {
                if (img.complete) {
                    img.classList.add('loaded');
                } else {
                    img.addEventListener('load', function() {
                        this.classList.add('loaded');
                    });
                }
                
                img.addEventListener('error', function() {
                    this.src = 'https://via.placeholder.com/350x500?text=No+Image';
                    this.classList.add('loaded');
                });
            });
        }
        
        // Display schedule in grid format
        function displayScheduleGrid(scheduleList) {
            const gridContainer = document.getElementById('schedule-grid');
            gridContainer.innerHTML = '';
            
            if (scheduleList.length === 0) {
                gridContainer.innerHTML = `
                    <div class="col-12">
                        <div class="empty-schedule">
                            <i class="ph ph-calendar-x fs-1 text-muted mb-3"></i>
                            <h5>No Upcoming Releases</h5>
                            <p class="text-muted">No scheduled releases found. Add some or refresh from AniList.</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            // Sort schedules by release date
            scheduleList.sort((a, b) => {
                return new Date(a.releaseDate) - new Date(b.releaseDate);
            });
            
            const now = new Date();
            
            scheduleList.forEach(schedule => {
                const releaseDate = new Date(schedule.releaseDate);
                const timeUntil = releaseDate - now;
                const isReleasingSoon = timeUntil < 86400000; // 24 hours
                const isToday = releaseDate.toDateString() === now.toDateString();
                
                const formattedDate = releaseDate.toLocaleDateString(undefined, {
                    weekday: 'short',
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric'
                });
                
                const scheduleCard = document.createElement('div');
                scheduleCard.className = 'col-xl-3 col-lg-4 col-md-6';
                scheduleCard.innerHTML = `
                    <div class="card h-100 schedule-card ${isReleasingSoon ? 'releasing-soon' : ''} ${isToday ? 'releasing-today' : ''}">
                        <img src="${getOptimizedImageUrl(schedule.thumbnail)}" class="card-img-top schedule-thumbnail" alt="${schedule.animeTitle}" 
                            style="height: 200px; object-fit: cover;" loading="lazy">
                        <div class="card-body">
                            <h5 class="card-title">${schedule.animeTitle}</h5>
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <span class="badge badge-primary">${schedule.season || 'New Release'}</span>
                                <small class="text-muted">${formattedDate}</small>
                            </div>
                            <div class="countdown mb-3" data-release-date="${schedule.releaseDate}">
                                <div class="mb-2">Releases in:</div>
                                <div class="d-flex align-items-center countdown-timer">
                                    <div class="timer-section">
                                        <span class="timer-value days">00</span>
                                        <span class="timer-label">days</span>
                                    </div>
                                    <div class="timer-section">
                                        <span class="timer-value hours">00</span>
                                        <span class="timer-label">hours</span>
                                    </div>
                                    <div class="timer-section">
                                        <span class="timer-value minutes">00</span>
                                        <span class="timer-label">mins</span>
                                    </div>
                                    <div class="timer-section">
                                        <span class="timer-value seconds">00</span>
                                        <span class="timer-label">secs</span>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex justify-content-end gap-2 mt-3">
                                <button class="btn btn-sm btn-outline-primary edit-schedule-btn" data-schedule-id="${schedule.id}">
                                    <i class="ph ph-pencil"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger delete-schedule-btn" 
                                    data-schedule-id="${schedule.id}" 
                                    data-anime-title="${schedule.animeTitle}" 
                                    data-season="${schedule.season || 'New Release'}">
                                    <i class="ph ph-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                gridContainer.appendChild(scheduleCard);
            });
            
            // Start countdown timers
            startCountdowns();
            
            // Add event listeners to edit and delete buttons
            addScheduleEventListeners();

            // Handle image loading
            document.querySelectorAll('.schedule-thumbnail').forEach(img => {
                if (img.complete) {
                    img.classList.add('loaded');
                } else {
                    img.addEventListener('load', function() {
                        this.classList.add('loaded');
                    });
                }
                
                img.addEventListener('error', function() {
                    this.src = 'https://via.placeholder.com/350x500?text=No+Image';
                    this.classList.add('loaded');
                });
            });
        }
        
        // Start countdown timers for all schedule items
        function startCountdowns() {
            const countdowns = document.querySelectorAll('.countdown');
            
            // Update all countdowns immediately
            updateCountdowns();
            
            // Then update every second
            setInterval(updateCountdowns, 1000);
            
            function updateCountdowns() {
                const now = new Date().getTime();
                
                countdowns.forEach(countdown => {
                    const releaseDate = new Date(countdown.getAttribute('data-release-date')).getTime();
                    const distance = releaseDate - now;
                    
                    if (distance < 0) {
                        countdown.innerHTML = '<div class="alert alert-success mb-0 p-2">Released!</div>';
                        return;
                    }
                    
                    // Time calculations
                    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                    
                    // Update the countdown display
                    const daysElement = countdown.querySelector('.days');
                    const hoursElement = countdown.querySelector('.hours');
                    const minutesElement = countdown.querySelector('.minutes');
                    const secondsElement = countdown.querySelector('.seconds');
                    
                    if (daysElement) daysElement.textContent = days.toString().padStart(2, '0');
                    if (hoursElement) hoursElement.textContent = hours.toString().padStart(2, '0');
                    if (minutesElement) minutesElement.textContent = minutes.toString().padStart(2, '0');
                    if (secondsElement) secondsElement.textContent = seconds.toString().padStart(2, '0');
                });
            }
        }
        
        // Add event listeners to schedule edit and delete buttons
        function addScheduleEventListeners() {
            // Edit schedule buttons
            document.querySelectorAll('.edit-schedule-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const scheduleId = this.getAttribute('data-schedule-id');
                    openEditScheduleModal(scheduleId);
                });
            });
            
            // Delete schedule buttons
            document.querySelectorAll('.delete-schedule-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const scheduleId = this.getAttribute('data-schedule-id');
                    const animeTitle = this.getAttribute('data-anime-title');
                    const season = this.getAttribute('data-season');
                    
                    // Set modal info
                    document.getElementById('deleteScheduleInfo').textContent = 
                        `${animeTitle} - ${season}`;
                    
                    // Set delete button data
                    document.getElementById('confirmDeleteScheduleBtn').setAttribute('data-schedule-id', scheduleId);
                    
                    // Show modal
                    const deleteModal = new bootstrap.Modal(document.getElementById('deleteScheduleModal'));
                    deleteModal.show();
                });
            });
        }
        
        // Toggle between timeline and grid view
        document.getElementById('show-compact-view').addEventListener('change', function() {
            if (this.checked) {
                document.getElementById('timeline-view').style.display = 'block';
                document.getElementById('grid-view').style.display = 'none';
            } else {
                document.getElementById('timeline-view').style.display = 'none';
                document.getElementById('grid-view').style.display = 'block';
            }
        });
        
        // Add Schedule button
        document.getElementById('add-schedule-btn').addEventListener('click', function() {
            // Load anime list for the selector
            loadAnimeForScheduleSelector();
            // Clear form
            document.getElementById('addScheduleForm').reset();
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('addScheduleModal'));
            modal.show();
        });
        
        // Refresh Schedule button
        document.getElementById('refresh-schedule-btn').addEventListener('click', function() {
            showLoading();
            // Call refresh endpoint
            fetch(`${API_URL}/schedule/refresh`, {
                method: 'POST'
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to refresh schedule');
                }
                return response.json();
            })
            .then(result => {
                showSuccess(`Schedule refreshed successfully. Found ${result.count} upcoming releases.`);
                loadScheduleData();
            })
            .catch(error => {
                console.error('Error refreshing schedule:', error);
                showError('Failed to refresh schedule: ' + error.message);
            })
            .finally(() => {
                hideLoading();
            });
        });
        
        // Save new schedule
        document.getElementById('saveScheduleBtn').addEventListener('click', function() {
            const animeId = document.getElementById('scheduleAnimeSelector').value;
            const season = document.getElementById('scheduleSeason').value;
            const releaseDate = document.getElementById('scheduleReleaseDate').value;
            const notes = document.getElementById('scheduleNotes').value;
            
            if (!animeId || !releaseDate) {
                showError('Please fill all required fields');
                return;
            }
            
            const scheduleData = {
                animeId,
                season,
                releaseDate: new Date(releaseDate).toISOString(),
                notes
            };
            
            showLoading();
            fetch(`${API_URL}/schedule`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(scheduleData)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to add schedule');
                }
                return response.json();
            })
            .then(newSchedule => {
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('addScheduleModal'));
                modal.hide();
                
                showSuccess('Release schedule added successfully');
                loadScheduleData();
            })
            .catch(error => {
                console.error('Error adding schedule:', error);
                showError('Failed to add schedule: ' + error.message);
            })
            .finally(() => {
                hideLoading();
            });
        });
        
        // Load anime options for schedule selector
        function loadAnimeForScheduleSelector() {
            showLoading();
            fetch(`${API_URL}/anime`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch anime list');
                    }
                    return response.json();
                })
                .then(animeList => {
                    const animeSelector = document.getElementById('scheduleAnimeSelector');
                    animeSelector.innerHTML = '<option value="">Choose an anime...</option>';
                    
                    animeList.forEach(anime => {
                        const option = document.createElement('option');
                        option.value = anime.id;
                        option.textContent = anime.title;
                        animeSelector.appendChild(option);
                    });
                    
                    hideLoading();
                })
                .catch(error => {
                    console.error('Error loading anime for schedule:', error);
                    showError('Failed to load anime list: ' + error.message);
                    hideLoading();
                });
        }
        
        // Open edit schedule modal
        function openEditScheduleModal(scheduleId) {
            showLoading();
            fetch(`${API_URL}/schedule/${scheduleId}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch schedule details');
                    }
                    return response.json();
                })
                .then(schedule => {
                    // Populate form
                    document.getElementById('editScheduleId').value = schedule.id;
                    document.getElementById('editScheduleAnime').value = schedule.animeTitle;
                    document.getElementById('editScheduleSeason').value = schedule.season || '';
                    document.getElementById('editScheduleNotes').value = schedule.notes || '';
                    
                    // Format the date for date input
                    const releaseDate = new Date(schedule.releaseDate);
                    const formattedDate = releaseDate.toISOString().split('T')[0];
                    document.getElementById('editScheduleReleaseDate').value = formattedDate;
                    
                    // Show modal
                    const editModal = new bootstrap.Modal(document.getElementById('editScheduleModal'));
                    editModal.show();
                    
                    hideLoading();
                })
                .catch(error => {
                    console.error('Error fetching schedule details:', error);
                    showError('Failed to load schedule details: ' + error.message);
                    hideLoading();
                });
        }
        
        // Save edited schedule
        document.getElementById('saveEditScheduleBtn').addEventListener('click', function() {
            const scheduleId = document.getElementById('editScheduleId').value;
            const season = document.getElementById('editScheduleSeason').value;
            const releaseDate = document.getElementById('editScheduleReleaseDate').value;
            const notes = document.getElementById('editScheduleNotes').value;
            
            if (!releaseDate) {
                showError('Please fill all required fields');
                return;
            }
            
            const scheduleData = {
                season,
                releaseDate: new Date(releaseDate).toISOString(),
                notes
            };
            
            showLoading();
            fetch(`${API_URL}/schedule/${scheduleId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(scheduleData)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to update schedule');
                }
                return response.json();
            })
            .then(updatedSchedule => {
                // Close modal
                const editModal = bootstrap.Modal.getInstance(document.getElementById('editScheduleModal'));
                editModal.hide();
                
                showSuccess('Schedule updated successfully');
                loadScheduleData();
            })
            .catch(error => {
                console.error('Error updating schedule:', error);
                showError('Failed to update schedule: ' + error.message);
            })
            .finally(() => {
                hideLoading();
            });
        });
        
        // Delete schedule
        document.getElementById('confirmDeleteScheduleBtn').addEventListener('click', function() {
            const scheduleId = this.getAttribute('data-schedule-id');
            
            showLoading();
            fetch(`${API_URL}/schedule/${scheduleId}`, {
                method: 'DELETE'
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to delete schedule');
                }
                return response.json();
            })
            .then(result => {
                // Close modal
                const deleteModal = bootstrap.Modal.getInstance(document.getElementById('deleteScheduleModal'));
                deleteModal.hide();
                
                showSuccess('Schedule deleted successfully');
                loadScheduleData();
            })
            .catch(error => {
                console.error('Error deleting schedule:', error);
                showError('Failed to delete schedule: ' + error.message);
            })
            .finally(() => {
                hideLoading();
            });
        });

        // Initialize everything on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Fix anime covers display
            fixAnimeCoverDisplay();
            
            // Load initial data
            loadDashboardData();
            checkServerStatus();
            
            // Handle image loading for all images
            const observeImages = () => {
                const images = document.querySelectorAll('.anime-thumbnail, .schedule-thumbnail, .anime-cover');
                
                images.forEach(img => {
                    if (img.complete) {
                        img.classList.add('loaded');
                    } else {
                        img.addEventListener('load', function() {
                            this.classList.add('loaded');
                        });
                    }
                    
                    img.addEventListener('error', function() {
                        this.src = 'https://via.placeholder.com/350x500?text=No+Image';
                        this.classList.add('loaded');
                    });
                });
            };
            
            // Run initially
            observeImages();
            
            // Set up a MutationObserver to watch for new images
            const observer = new MutationObserver(mutations => {
                mutations.forEach(mutation => {
                    if (mutation.addedNodes) {
                        mutation.addedNodes.forEach(node => {
                            if (node.nodeType === 1) { // Element node
                                const images = node.querySelectorAll('.anime-thumbnail, .schedule-thumbnail, .anime-cover');
                                if (images.length > 0) {
                                    images.forEach(img => {
                                        if (img.complete) {
                                            img.classList.add('loaded');
                                        } else {
                                            img.addEventListener('load', function() {
                                                this.classList.add('loaded');
                                            });
                                        }
                                        
                                        img.addEventListener('error', function() {
                                            this.src = 'https://via.placeholder.com/350x500?text=No+Image';
                                            this.classList.add('loaded');
                                        });
                                    });
                                }
                            }
                        });
                    }
                });
            });
            
            // Start observing the document
            observer.observe(document.body, { 
                childList: true,
                subtree: true
            });
        });
    </script>
</body>
</html>
