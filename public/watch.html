<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watch Anime - AnimeStream</title>
    <meta http-equiv="refresh" content="1800"> <!-- Refresh every 30 minutes to keep connection -->
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    
    <!-- Vidstack Player -->
    <script type="module" src="https://cdn.jsdelivr.net/npm/vidstack@next/cdn/with-layouts/vidstack.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vidstack@next/cdn/with-layouts/vidstack.css">
    
    <style>
        :root {
            /* Colors */
            --background: 0 0% 100%;
            --foreground: 240 10% 3.9%;
            --card: 0 0% 100%;
            --card-foreground: 240 10% 3.9%;
            --popover: 0 0% 100%;
            --popover-foreground: 240 10% 3.9%;
            --primary: 240 5.9% 10%;
            --primary-foreground: 0 0% 98%;
            --secondary: 240 4.8% 95.9%;
            --secondary-foreground: 240 5.9% 10%;
            --muted: 240 4.8% 95.9%;
            --muted-foreground: 240 3.8% 46.1%;
            --accent: 240 4.8% 95.9%;
            --accent-foreground: 240 5.9% 10%;
            --destructive: 0 84.2% 60.2%;
            --destructive-foreground: 0 0% 98%;
            --border: 240 5.9% 90%;
            --input: 240 5.9% 90%;
            --ring: 240 5.9% 10%;
            --radius: 0.5rem;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);

            /* Theme specific */
            --header-height: 4rem;
            --animation-duration: 0.2s;
            --badge-size: 24px;
        }

        .dark {
            --background: 240 10% 3.9%;
            --foreground: 0 0% 98%;
            --card: 240 10% 3.9%;
            --card-foreground: 0 0% 98%;
            --popover: 240 10% 3.9%;
            --popover-foreground: 0 0% 98%;
            --primary: 0 0% 98%;
            --primary-foreground: 240 5.9% 10%;
            --secondary: 240 3.7% 15.9%;
            --secondary-foreground: 0 0% 98%;
            --muted: 240 3.7% 15.9%;
            --muted-foreground: 240 5% 64.9%;
            --accent: 240 3.7% 15.9%;
            --accent-foreground: 0 0% 98%;
            --destructive: 0 62.8% 30.6%;
            --destructive-foreground: 0 0% 98%;
            --border: 240 3.7% 15.9%;
            --input: 240 3.7% 15.9%;
            --ring: 240 4.9% 83.9%;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        body {
            font-family: 'Outfit', sans-serif;
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
            min-height: 100vh;
            line-height: 1.5;
        }
        
        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        .dark-mode-toggle {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.5rem;
            color: hsl(var(--foreground));
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            transition: background-color var(--animation-duration) ease;
        }
        
        .dark-mode-toggle:hover {
            background-color: hsl(var(--secondary));
        }
        
        /* Header */
        .header {
            position: sticky;
            top: 0;
            background-color: hsl(var(--background));
            border-bottom: 1px solid hsl(var(--border));
            height: var(--header-height);
            z-index: 50;
            backdrop-filter: blur(8px);
        }
        
        .logo {
            font-weight: 700;
            font-size: 1.5rem;
            color: hsl(var(--foreground));
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .logo i {
            color: hsl(var(--primary));
            font-size: 1.8rem;
        }
        
        /* Search */
        .search-container {
            position: relative;
            width: 100%;
            max-width: 500px;
        }
        
        .search-input {
            width: 100%;
            padding: 0.6rem 1rem;
            padding-left: 2.5rem;
            border-radius: var(--radius);
            border: 1px solid hsl(var(--border));
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
            font-family: 'Outfit', sans-serif;
            font-size: 0.9rem;
            transition: border-color var(--animation-duration) ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: hsl(var(--ring));
            box-shadow: 0 0 0 2px hsla(var(--ring) / 0.2);
        }
        
        .search-icon {
            position: absolute;
            left: 0.8rem;
            top: 50%;
            transform: translateY(-50%);
            color: hsl(var(--muted-foreground));
        }
        
        /* Navigation */
        .nav {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }
        
        .nav-link {
            text-decoration: none;
            color: hsl(var(--foreground));
            font-weight: 500;
            font-size: 0.95rem;
            padding: 0.5rem;
            transition: color var(--animation-duration) ease;
            position: relative;
        }
        
        .nav-link:hover {
            color: hsl(var(--primary));
        }
        
        .nav-link.active {
            font-weight: 600;
            color: hsl(var(--primary));
        }
        
        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -0.5rem;
            left: 50%;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background-color: hsl(var(--primary));
            transform: translateX(-50%);
        }
        
        /* Button styles */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius);
            font-weight: 500;
            font-size: 0.95rem;
            line-height: 1;
            height: 2.5rem;
            padding: 0 1.5rem;
            transition: all var(--animation-duration) ease;
            cursor: pointer;
            text-decoration: none;
            white-space: nowrap;
            border: 1px solid transparent;
        }
        
        .btn-icon {
            margin-right: 0.5rem;
            font-size: 1.1rem;
        }
        
        .btn-primary {
            background-color: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
        }
        
        .btn-primary:hover {
            background-color: hsl(var(--primary) / 0.9);
            box-shadow: var(--shadow-sm);
        }
        
        .btn-secondary {
            background-color: hsl(var(--secondary));
            color: hsl(var(--secondary-foreground));
        }
        
        .btn-secondary:hover {
            background-color: hsl(var(--secondary) / 0.8);
            box-shadow: var(--shadow-sm);
        }
        
        .btn-outline {
            background-color: transparent;
            border: 1px solid hsl(var(--border));
            color: hsl(var(--foreground));
        }
        
        .btn-outline:hover {
            background-color: hsl(var(--secondary));
            box-shadow: var(--shadow-sm);
        }
        
        /* Footer */
        .footer {
            border-top: 1px solid hsl(var(--border));
            padding: 2rem 0;
            margin-top: 4rem;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
        }
        
        .footer-logo {
            font-weight: 700;
            font-size: 1.5rem;
            color: hsl(var(--foreground));
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .footer-logo i {
            color: hsl(var(--primary));
            font-size: 1.8rem;
        }
        
        .footer-section h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .footer-links {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .footer-link {
            color: hsl(var(--muted-foreground));
            text-decoration: none;
            font-size: 0.9rem;
            transition: color var(--animation-duration) ease;
        }
        
        .footer-link:hover {
            color: hsl(var(--foreground));
        }
        
        .footer-social {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .footer-social a {
            color: hsl(var(--muted-foreground));
            font-size: 1.2rem;
            transition: color var(--animation-duration) ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: hsl(var(--secondary));
        }
        
        .footer-social a:hover {
            color: hsl(var(--foreground));
            background-color: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
        }
        
        .footer-bottom {
            margin-top: 2rem;
            text-align: center;
            font-size: 0.8rem;
            color: hsl(var(--muted-foreground));
            padding-top: 2rem;
            border-top: 1px solid hsl(var(--border));
        }
        
        /* Mobile nav */
        .mobile-nav-toggle {
            display: none;
            background: none;
            border: none;
            color: hsl(var(--foreground));
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color var(--animation-duration) ease;
        }
        
        .mobile-nav-toggle:hover {
            background-color: hsl(var(--secondary));
        }
        
        .mobile-nav {
            position: fixed;
            top: var(--header-height);
            left: 0;
            right: 0;
            bottom: 0;
            background-color: hsl(var(--background));
            padding: 1.5rem;
            transform: translateX(100%);
            transition: transform var(--animation-duration) ease;
            z-index: 40;
            display: none;
            border-top: 1px solid hsl(var(--border));
            box-shadow: var(--shadow-lg);
        }
        
        .mobile-nav.show {
            transform: translateX(0);
        }
        
        .mobile-nav-links {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .mobile-nav-link {
            color: hsl(var(--foreground));
            text-decoration: none;
            font-size: 1.2rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0;
        }
        
        .mobile-nav-link i {
            font-size: 1.3rem;
            width: 30px;
        }
        
        .mobile-nav-link.active {
            color: hsl(var(--primary));
            font-weight: 600;
        }
        
        /* Watch page specific styles */
        .video-section {
            margin-top: 2rem;
            margin-bottom: 2rem;
        }
        
        .video-container {
            position: relative;
            width: 100%;
            border-radius: var(--radius);
            overflow: hidden;
            background-color: black;
            box-shadow: var(--shadow-md);
        }
        
        /* Vidstack player styles */
        .media-player[data-view-type="video"] {
            aspect-ratio: 16 / 9;
        }
        
        .vds-video-layout {
            --video-brand: hsl(0, 0%, 96%);
        }
        
        .dark .vds-video-layout {
            --video-brand: hsl(0, 0%, 85%);
        }
        
        /* Anime details */
        .anime-details {
            margin-top: 2rem;
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 2rem;
        }
        
        .anime-info {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .anime-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            line-height: 1.2;
        }
        
        .anime-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            color: hsl(var(--muted-foreground));
            font-size: 0.9rem;
        }
        
        .anime-meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .anime-meta-item i {
            font-size: 1.1rem;
        }
        
        .anime-description {
            line-height: 1.7;
            color: hsl(var(--foreground) / 0.9);
        }
        
        .anime-genres {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .genre-tag {
            background-color: hsl(var(--secondary));
            color: hsl(var(--secondary-foreground));
            padding: 0.3rem 0.7rem;
            border-radius: var(--radius);
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .anime-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .anime-tag {
            background-color: hsl(var(--secondary));
            color: hsl(var(--secondary-foreground));
            padding: 0.3rem 0.7rem;
            border-radius: var(--radius);
            font-size: 0.8rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .tagalog-badge {
            background-color: hsl(250, 90%, 60%);
            color: white;
        }
        
        /* Episode list */
        .episode-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 1rem;
        }
        
        .episode-list-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid hsl(var(--border));
        }
        
        .episode-list-title {
            font-size: 1.25rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .episode-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 1rem;
            border-radius: var(--radius);
            background-color: hsl(var(--card));
            border: 1px solid hsl(var(--border));
            cursor: pointer;
            transition: all var(--animation-duration) ease;
        }
        
        .episode-item:hover {
            background-color: hsl(var(--secondary));
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }
        
        .episode-item.active {
            border-color: hsl(var(--primary));
            background-color: hsl(var(--primary) / 0.1);
        }
        
        .episode-number {
            background-color: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius);
            font-weight: 600;
            flex-shrink: 0;
        }
        
        .episode-info {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .episode-title {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }
        
        .episode-date {
            font-size: 0.8rem;
            color: hsl(var(--muted-foreground));
        }
        
        .episode-actions {
            margin-left: auto;
        }
        
        .server-switch {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .server-btn {
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            font-size: 0.9rem;
            font-weight: 500;
            background-color: hsl(var(--secondary));
            color: hsl(var(--secondary-foreground));
            cursor: pointer;
            border: 1px solid hsl(var(--border));
            transition: all var(--animation-duration) ease;
        }
        
        .server-btn:hover {
            background-color: hsl(var(--secondary) / 0.8);
        }
        
        .server-btn.active {
            background-color: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
            border-color: hsl(var(--primary));
        }
        
        /* Loader */
        .loader {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid hsl(var(--secondary));
            border-radius: 50%;
            border-top-color: hsl(var(--primary));
            animation: spin 1s ease-in-out infinite;
            margin: 2rem auto;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loader-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
        }
        
        /* Hidden elements */
        .hidden {
            display: none !important;
        }
        
        /* Responsive adjustments */
        @media (max-width: 1024px) {
            .anime-details {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .header-container {
                justify-content: space-between;
            }
            
            .mobile-nav-toggle {
                display: flex;
            }
            
            .nav {
                display: none;
            }
            
            .mobile-nav {
                display: block;
            }
            
            .search-container {
                display: none;
            }
            
            .anime-details {
                gap: 1.5rem;
            }
            
            .anime-title {
                font-size: 1.5rem;
            }
        }
        
        @media (max-width: 480px) {
            .server-switch {
                flex-wrap: wrap;
            }
            
            .episode-list {
                margin-top: 0.5rem;
            }
            
            .episode-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
                padding: 0.75rem;
            }
            
            .episode-number {
                width: 2rem;
                height: 2rem;
                font-size: 0.8rem;
            }
            
            .anime-meta {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body class="dark">
    <!-- Header -->
    <header class="header">
        <div class="container flex items-center justify-between h-full header-container">
            <a href="/" class="logo">
                <i class="ph ph-play-circle"></i>
                <span>AnimeStream</span>
            </a>
            
            <div class="search-container">
                <i class="ph ph-magnifying-glass search-icon"></i>
                <input type="text" id="search-input" class="search-input" placeholder="Search anime...">
            </div>
            
            <nav class="nav">
                <a href="/" class="nav-link">Home</a>
                <a href="/#popular-section" class="nav-link">Popular</a>
                <a href="/#latest-section" class="nav-link">Latest</a>
                <a href="/#tagalog-section" class="nav-link">Tagalog Dub</a>
                <a href="/#upcoming-section" class="nav-link">Upcoming</a>
            </nav>
            
            <button class="dark-mode-toggle" id="theme-toggle">
                <i class="ph ph-sun"></i>
            </button>
            
            <button class="mobile-nav-toggle" id="mobile-nav-toggle">
                <i class="ph ph-list"></i>
            </button>
        </div>
    </header>
    
    <!-- Mobile Navigation -->
    <div class="mobile-nav" id="mobile-nav">
        <div class="mobile-search">
            <div class="search-container" style="max-width: 100%;">
                <i class="ph ph-magnifying-glass search-icon"></i>
                <input type="text" id="mobile-search-input" class="search-input" placeholder="Search anime...">
            </div>
        </div>
        <div class="mobile-nav-links">
            <a href="/" class="mobile-nav-link">
                <i class="ph ph-house"></i>
                <span>Home</span>
            </a>
            <a href="/#popular-section" class="mobile-nav-link">
                <i class="ph ph-star"></i>
                <span>Popular</span>
            </a>
            <a href="/#latest-section" class="mobile-nav-link">
                <i class="ph ph-clock"></i>
                <span>Latest</span>
            </a>
            <a href="/#tagalog-section" class="mobile-nav-link">
                <i class="ph ph-microphone"></i>
                <span>Tagalog Dub</span>
            </a>
            <a href="/#upcoming-section" class="mobile-nav-link">
                <i class="ph ph-calendar"></i>
                <span>Upcoming</span>
            </a>
        </div>
    </div>
    
    <main class="container">
        <!-- Video Player Section -->
        <section class="video-section">
            <div class="loader-container" id="video-loader">
                <div class="loader"></div>
            </div>
            
            <div class="video-container hidden" id="video-container">
                <div class="server-switch" id="server-switch">
                    <button class="server-btn active" id="server1-btn">Server 1</button>
                    <button class="server-btn" id="server2-btn">Server 2</button>
                </div>
                
                <!-- Vidstack Player -->
                <div id="player-container">
                    <media-player
                        id="media-player"
                        view-type="video"
                        stream-type="on-demand"
                        log-level="warn"
                        crossorigin
                        playsinline
                        autoplay
                    >
                        <media-provider>
                            <media-poster class="vds-poster" id="media-poster"></media-poster>
                            <source src="" type="video/mp4" id="video-source" />
                        </media-provider>
                        <media-video-layout thumbnails=""></media-video-layout>
                    </media-player>
                </div>
                
                <!-- Fallback iframe for embedded player if needed -->
                <iframe 
                    id="embed-iframe" 
                    class="hidden" 
                    width="100%" 
                    height="480" 
                    frameborder="0" 
                    allowfullscreen
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                ></iframe>
            </div>
        </section>
        
        <!-- Anime Details Section -->
        <section class="anime-details">
            <div class="anime-info">
                <div class="loader-container" id="anime-info-loader">
                    <div class="loader"></div>
                </div>
                
                <div class="hidden" id="anime-info-content">
                    <h1 class="anime-title" id="anime-title"></h1>
                    
                    <div class="anime-meta">
                        <div class="anime-meta-item">
                            <i class="ph ph-film-strip"></i>
                            <span id="episode-count"></span>
                        </div>
                        <div class="anime-meta-item">
                            <i class="ph ph-star"></i>
                            <span id="anime-rating"></span>
                        </div>
                        <div class="anime-meta-item">
                            <i class="ph ph-clock"></i>
                            <span id="episode-duration"></span>
                        </div>
                        <div class="anime-meta-item">
                            <i class="ph ph-calendar"></i>
                            <span id="anime-year"></span>
                        </div>
                        <div class="anime-meta-item">
                            <i class="ph ph-flag"></i>
                            <span id="anime-status"></span>
                        </div>
                    </div>
                    
                    <div class="anime-genres" id="anime-genres">
                        <!-- Genres will be added here -->
                    </div>
                    
                    <div class="anime-tags">
                        <div class="anime-tag tagalog-badge hidden" id="tagalog-badge">
                            <i class="ph ph-microphone"></i>
                            <span>Tagalog Dub</span>
                        </div>
                    </div>
                    
                    <p class="anime-description" id="anime-description"></p>
                </div>
            </div>
            
            <div class="episode-sidebar">
                <div class="episode-list-header">
                    <h2 class="episode-list-title">
                        <i class="ph ph-list-numbers"></i>
                        <span>Episodes</span>
                    </h2>
                </div>
                
                <div class="loader-container" id="episode-list-loader">
                    <div class="loader"></div>
                </div>
                
                <div class="episode-list" id="episode-list">
                    <!-- Episodes will be added here -->
                </div>
            </div>
        </section>
    </main>
    
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-logo">
                        <i class="ph ph-play-circle"></i>
                        <span>AnimeStream</span>
                    </div>
                    <p class="text-sm text-muted-foreground mb-4">Your ultimate destination for anime streaming with Tagalog dubbed content.</p>
                    <div class="footer-social">
                        <a href="#"><i class="ph ph-facebook-logo"></i></a>
                        <a href="#"><i class="ph ph-twitter-logo"></i></a>
                        <a href="#"><i class="ph ph-instagram-logo"></i></a>
                        <a href="#"><i class="ph ph-discord-logo"></i></a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <div class="footer-links">
                        <a href="/" class="footer-link">Home</a>
                        <a href="/#popular-section" class="footer-link">Popular Anime</a>
                        <a href="/#latest-section" class="footer-link">Latest Episodes</a>
                        <a href="/#tagalog-section" class="footer-link">Tagalog Dub</a>
                        <a href="/#upcoming-section" class="footer-link">Upcoming Releases</a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h3>Genres</h3>
                    <div class="footer-links">
                        <a href="#" class="footer-link">Action</a>
                        <a href="#" class="footer-link">Romance</a>
                        <a href="#" class="footer-link">Comedy</a>
                        <a href="#" class="footer-link">Drama</a>
                        <a href="#" class="footer-link">Fantasy</a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h3>Legal</h3>
                    <div class="footer-links">
                        <a href="#" class="footer-link">Privacy Policy</a>
                        <a href="#" class="footer-link">Terms of Service</a>
                        <a href="#" class="footer-link">DMCA</a>
                        <a href="#" class="footer-link">Contact Us</a>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 AnimeStream. All rights reserved.</p>
            </div>
        </div>
    </footer>
    
    <!-- Data persistence script -->
    <script src="/js/persistence.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize persistence manager to keep data even on Render free tier restarts
            const persistenceManager = new AnimePersistenceManager('');
            persistenceManager.startKeepAlive();
            
            // Get anime ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const animeId = urlParams.get('id');
            const episodeId = urlParams.get('ep');
            
            if (!animeId) {
                window.location.href = '/'; // Redirect to home if no anime ID
                return;
            }
            
            // Setup theme toggle
            setupThemeToggle();
            
            // Setup mobile navigation
            setupMobileNav();
            
            // Setup search functionality
            setupSearch();
            
            // Fetch anime details and episodes
            fetchAnimeDetails(animeId);
            fetchAnimeEpisodes(animeId, episodeId);
        });
        
        // Fetch anime details
        function fetchAnimeDetails(animeId) {
            const animeInfoLoader = document.getElementById('anime-info-loader');
            const animeInfoContent = document.getElementById('anime-info-content');
            
            fetch(`/api/anime/${animeId}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Anime not found');
                    }
                    return response.json();
                })
                .then(anime => {
                    // Set page title
                    document.title = `${anime.title} - AnimeStream`;
                    
                    // Populate anime details
                    document.getElementById('anime-title').textContent = anime.title;
                    document.getElementById('episode-count').textContent = `${anime.episodeCount} Episodes`;
                    document.getElementById('anime-rating').textContent = `${anime.rating.toFixed(1)}/10`;
                    document.getElementById('episode-duration').textContent = `${anime.duration} min`;
                    document.getElementById('anime-year').textContent = anime.startDate ? new Date(anime.startDate).getFullYear() : 'Unknown';
                    document.getElementById('anime-status').textContent = anime.status;
                    document.getElementById('anime-description').textContent = anime.description || 'No description available.';
                    
                    // Show Tagalog badge if applicable
                    if (anime.hasTagalogDub) {
                        document.getElementById('tagalog-badge').classList.remove('hidden');
                    }
                    
                    // Add genres
                    const genresContainer = document.getElementById('anime-genres');
                    genresContainer.innerHTML = '';
                    
                    anime.genres.forEach(genre => {
                        const genreTag = document.createElement('div');
                        genreTag.className = 'genre-tag';
                        genreTag.textContent = genre;
                        genresContainer.appendChild(genreTag);
                    });
                    
                    // Set poster for media player
                    document.getElementById('media-poster').setAttribute('src', anime.thumbnail);
                    
                    // Hide loader and show content
                    animeInfoLoader.classList.add('hidden');
                    animeInfoContent.classList.remove('hidden');
                })
                .catch(error => {
                    console.error('Error fetching anime details:', error);
                    animeInfoLoader.innerHTML = `
                        <div style="text-align: center;">
                            <p>Failed to load anime details: ${error.message}</p>
                            <a href="/" class="btn btn-primary mt-4">Go Back Home</a>
                        </div>
                    `;
                });
        }
        
        // Fetch anime episodes
        function fetchAnimeEpisodes(animeId, selectedEpisodeId = null) {
            const episodeListLoader = document.getElementById('episode-list-loader');
            const episodeList = document.getElementById('episode-list');
            
            fetch(`/api/anime/${animeId}/episodes`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch episodes');
                    }
                    return response.json();
                })
                .then(episodes => {
                    // Sort episodes by number
                    episodes.sort((a, b) => a.number - b.number);
                    
                    if (episodes.length === 0) {
                        episodeList.innerHTML = `<p class="text-center">No episodes available yet.</p>`;
                        episodeListLoader.classList.add('hidden');
                        return;
                    }
                    
                    // Populate episode list
                    episodeList.innerHTML = '';
                    
                    episodes.forEach(episode => {
                        const episodeItem = document.createElement('div');
                        episodeItem.className = 'episode-item';
                        episodeItem.dataset.id = episode.id;
                        episodeItem.dataset.iframeSrc = episode.iframeSrc || '';
                        episodeItem.dataset.server2Url = episode.server2Url || '';
                        
                        // Format date
                        const date = new Date(episode.dateAdded);
                        const formattedDate = date.toLocaleDateString('en-US', {
                            month: 'short',
                            day: 'numeric',
                            year: 'numeric'
                        });
                        
                        episodeItem.innerHTML = `
                            <div class="episode-number">${episode.number}</div>
                            <div class="episode-info">
                                <div class="episode-title">${episode.title || `Episode ${episode.number}`}</div>
                                <div class="episode-date">Added on ${formattedDate}</div>
                            </div>
                            <div class="episode-actions">
                                ${episode.hasTagalogDub ? '<span class="anime-tag tagalog-badge">Tagalog</span>' : ''}
                            </div>
                        `;
                        
                        // Add click event
                        episodeItem.addEventListener('click', function() {
                            playEpisode(episode);
                            
                            // Update URL without reloading
                            const url = new URL(window.location);
                            url.searchParams.set('ep', episode.id);
                            window.history.pushState({}, '', url);
                            
                            // Mark as active
                            document.querySelectorAll('.episode-item').forEach(item => {
                                item.classList.remove('active');
                            });
                            this.classList.add('active');
                        });
                        
                        episodeList.appendChild(episodeItem);
                    });
                    
                    // Hide loader
                    episodeListLoader.classList.add('hidden');
                    
                    // Play selected episode or first episode
                    if (selectedEpisodeId) {
                        const selectedEpisode = episodes.find(ep => ep.id === selectedEpisodeId);
                        if (selectedEpisode) {
                            playEpisode(selectedEpisode);
                            const episodeItem = document.querySelector(`.episode-item[data-id="${selectedEpisodeId}"]`);
                            if (episodeItem) episodeItem.classList.add('active');
                        } else {
                            playEpisode(episodes[0]);
                            const firstEpisodeItem = document.querySelector('.episode-item');
                            if (firstEpisodeItem) firstEpisodeItem.classList.add('active');
                        }
                    } else {
                        playEpisode(episodes[0]);
                        const firstEpisodeItem = document.querySelector('.episode-item');
                        if (firstEpisodeItem) firstEpisodeItem.classList.add('active');
                    }
                })
                .catch(error => {
                    console.error('Error fetching episodes:', error);
                    episodeListLoader.innerHTML = `
                        <div style="text-align: center;">
                            <p>Failed to load episodes: ${error.message}</p>
                        </div>
                    `;
                });
        }
        
        // Play episode
        function playEpisode(episode) {
            const videoLoader = document.getElementById('video-loader');
            const videoContainer = document.getElementById('video-container');
            const mediaPlayer = document.getElementById('media-player');
            const videoSource = document.getElementById('video-source');
            const embedIframe = document.getElementById('embed-iframe');
            const server1Btn = document.getElementById('server1-btn');
            const server2Btn = document.getElementById('server2-btn');
            
            // Show loader
            videoLoader.classList.remove('hidden');
            videoContainer.classList.add('hidden');
            
            // Check which server to use
            const useServer1 = server1Btn.classList.contains('active');
            
            // Server 1 is for iFrame embed, Server 2 is for direct MP4 link
            if (useServer1 && episode.iframeSrc) {
                // Use iframe for embedded players
                mediaPlayer.classList.add('hidden');
                embedIframe.classList.remove('hidden');
                embedIframe.src = episode.iframeSrc;
                
                // Wait a bit for iframe to load
                setTimeout(() => {
                    videoLoader.classList.add('hidden');
                    videoContainer.classList.remove('hidden');
                }, 1000);
            } else if (!useServer1 && episode.server2Url) {
                // Use direct MP4 link for Server 2
                mediaPlayer.classList.remove('hidden');
                embedIframe.classList.add('hidden');
                
                videoSource.src = episode.server2Url;
                mediaPlayer.load(); // Reload the player with new source
                
                videoLoader.classList.add('hidden');
                videoContainer.classList.remove('hidden');
            } else {
                // Use a demo video if no sources available (for testing)
                mediaPlayer.classList.remove('hidden');
                embedIframe.classList.add('hidden');
                
                videoSource.src = "https://files.vidstack.io/sprite-fight/720p.mp4";
                mediaPlayer.load(); // Reload the player with new source
                
                videoLoader.classList.add('hidden');
                videoContainer.classList.remove('hidden');
                
                // Show a message
                alert('Demo video loaded. No actual video source available for this episode.');
            }
            
            // Update episode title in player
            mediaPlayer.setAttribute('title', episode.title || `Episode ${episode.number}`);
            
            // Update server buttons visibility
            if (!episode.server2Url) {
                server2Btn.disabled = true;
                server2Btn.style.opacity = '0.5';
            } else {
                server2Btn.disabled = false;
                server2Btn.style.opacity = '1';
            }
            
            if (!episode.iframeSrc) {
                server1Btn.disabled = true;
                server1Btn.style.opacity = '0.5';
            } else {
                server1Btn.disabled = false;
                server1Btn.style.opacity = '1';
            }
        }
        
        // Setup theme toggle
        function setupThemeToggle() {
            const themeToggle = document.getElementById('theme-toggle');
            const html = document.documentElement;
            
            // Check for saved theme preference
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                if (savedTheme === 'light') {
                    html.classList.remove('dark');
                    themeToggle.innerHTML = '<i class="ph ph-moon"></i>';
                } else {
                    html.classList.add('dark');
                    themeToggle.innerHTML = '<i class="ph ph-sun"></i>';
                }
            }
            
            // Toggle theme
            themeToggle.addEventListener('click', function() {
                if (html.classList.contains('dark')) {
                    html.classList.remove('dark');
                    localStorage.setItem('theme', 'light');
                    this.innerHTML = '<i class="ph ph-moon"></i>';
                } else {
                    html.classList.add('dark');
                    localStorage.setItem('theme', 'dark');
                    this.innerHTML = '<i class="ph ph-sun"></i>';
                }
            });
        }
        
        // Setup mobile navigation
        function setupMobileNav() {
            const mobileNavToggle = document.getElementById('mobile-nav-toggle');
            const mobileNav = document.getElementById('mobile-nav');
            const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');
            
            mobileNavToggle.addEventListener('click', function() {
                mobileNav.classList.toggle('show');
                
                // Toggle icon
                if (mobileNav.classList.contains('show')) {
                    this.innerHTML = '<i class="ph ph-x"></i>';
                } else {
                    this.innerHTML = '<i class="ph ph-list"></i>';
                }
            });
            
            // Close mobile nav when clicking a link
            mobileNavLinks.forEach(link => {
                link.addEventListener('click', function() {
                    mobileNav.classList.remove('show');
                    mobileNavToggle.innerHTML = '<i class="ph ph-list"></i>';
                });
            });
        }
        
        // Setup search functionality
        function setupSearch() {
            // Desktop search
            document.getElementById('search-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const searchQuery = this.value.trim();
                    if (searchQuery.length === 0) return;
                    
                    window.location.href = `/search.html?q=${encodeURIComponent(searchQuery)}`;
                }
            });
            
            // Mobile search
            document.getElementById('mobile-search-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const searchQuery = this.value.trim();
                    if (searchQuery.length === 0) return;
                    
                    window.location.href = `/search.html?q=${encodeURIComponent(searchQuery)}`;
                }
            });
        }
        
        // Server switching functionality
        document.addEventListener('DOMContentLoaded', function() {
            const server1Btn = document.getElementById('server1-btn');
            const server2Btn = document.getElementById('server2-btn');
            
            server1Btn.addEventListener('click', function() {
                if (this.classList.contains('active')) return;
                
                server1Btn.classList.add('active');
                server2Btn.classList.remove('active');
                
                // Get active episode
                const activeEpisode = document.querySelector('.episode-item.active');
                if (activeEpisode) {
                    const episodeId = activeEpisode.dataset.id;
                    
                    // Re-fetch episode details to switch server
                    fetch(`/api/episodes/${episodeId}`)
                        .then(response => response.json())
                        .then(episode => {
                            playEpisode(episode);
                        });
                }
            });
            
            server2Btn.addEventListener('click', function() {
                if (this.classList.contains('active')) return;
                
                server2Btn.classList.add('active');
                server1Btn.classList.remove('active');
                
                // Get active episode
                const activeEpisode = document.querySelector('.episode-item.active');
                if (activeEpisode) {
                    const episodeId = activeEpisode.dataset.id;
                    
                    // Re-fetch episode details to switch server
                    fetch(`/api/episodes/${episodeId}`)
                        .then(response => response.json())
                        .then(episode => {
                            playEpisode(episode);
                        });
                }
            });
        });
    </script>
</body>
</html>
